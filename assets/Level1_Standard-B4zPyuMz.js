import{r as i,T as V,G as k,g as ce,a as de,M as ue,b as v,u as Q,E as ee,j as r,c as fe,d as me}from"./index-B1BpELOr.js";import{P as xe}from"./ParticleOverlay-BxzBYbW3.js";const Ce=({csvData:b,onComplete:te,onExit:he,mode:y,levelIndex:P,onThemeChange:M,hintsEnabled:pe,timeLimit:se,onOpenSettings:L,debugMode:ge,onOpenAnimLab:we,isStressTesting:E,diagnosticSpeed:B})=>{const[c,g]=i.useState([]),[I,C]=i.useState(null),[N,S]=i.useState(!0),[f,z]=i.useState(!1),[Y,G]=i.useState(!1),[ae,X]=i.useState(""),[ve,Z]=i.useState(!1),[w,le]=i.useState(V[0]),[j,D]=i.useState(!1),[oe,re]=i.useState(""),[R,_]=i.useState(!1),[O,q]=i.useState(0),F=i.useRef(Date.now()),U=i.useRef(!1),T=i.useRef(new Map),$=i.useRef(null),ne=i.useMemo(()=>{if(c.length===0)return[];const o=new Map;return c.forEach(t=>{if(!o.has(t.categoryId)){const a=c.filter(e=>e.categoryId===t.categoryId).every(e=>e.status==="solved"||e.status==="exiting");o.set(t.categoryId,{name:t.categoryName,isSolved:a})}}),Array.from(o.values()).sort((t,s)=>t.name.localeCompare(s.name))},[c]);i.useEffect(()=>{if(U.current&&c.length>0)return;if(!b||b.length===0){S(!0);return}const o=V[Math.floor(Math.random()*V.length)];le(o),M&&M(o.solvedColors);let t=[];if(y===k.LEVEL_4_THEMED){const l=ce(20,b);t=l.categories,X(l.name)}else t=de(30,b),X("");if(t.length===0){Z(!0),S(!1);return}const s=[],a=new Set,e=[];for(const l of t){if(e.length>=7)break;const n=l.words.filter(u=>!a.has(u)&&u.length<=ue);n.length>=4&&([...n].sort(()=>.5-Math.random()).slice(0,4).forEach(m=>{a.add(m),s.push({id:Math.random().toString(36).substr(2,9),word:m,categoryId:l.id,categoryName:l.name.includes(":")?l.name.split(":")[1].trim():l.name,status:"neutral"})}),e.push(l))}if(e.length<2){Z(!0),S(!1);return}g(s.sort(()=>.5-Math.random())),z(!1),G(!1),D(!1),S(!1),_(!1),q(0),F.current=Date.now(),U.current=!0},[b,y,P,se,M]),i.useEffect(()=>{if(!E||j||N||R)return;if(f){const s=setTimeout(()=>W(),1500);return()=>clearTimeout(s)}if(B==="instant"){z(!0),v.playWin();return}const t=setTimeout(()=>{const s=Array.from(new Set(c.map(e=>e.categoryId)));let a=!1;for(let e=0;e<c.length/4;e++){const l=s[e],n=e*4,u=n+4;if(c.slice(n,u).every(x=>x.status==="solved"))continue;const p=c.findIndex((x,d)=>d>=n&&d<u&&x.categoryId!==l);if(p!==-1){const x=c.findIndex((d,h)=>h>=u&&d.categoryId===l);if(x!==-1){A(c[p].id),setTimeout(()=>{j||f||A(c[x].id)},800),a=!0;break}}}!a&&!f&&K(c)},1200);return()=>clearTimeout(t)},[E,f,N,R,B,c]),i.useEffect(()=>{if(f){const o=Date.now()-F.current;Q({levelsCompleted:1,totalTimeMs:o,totalMoves:O})}},[f,O]);const ie=(o,t)=>{if(!$.current)return;const s=me(t);o.forEach(a=>{var l;const e=T.current.get(a);if(e){const n=e.getBoundingClientRect();(l=$.current)==null||l.explode(n.left+n.width/2,n.top+n.height/2,s)}})},K=i.useCallback(o=>{if(N)return;const t=4,s=o.length/t;let a=0;const e=[...o];let l=!1;for(let n=0;n<s;n++){const u=n*t,m=e.slice(u,u+t);if(m.every(d=>d.status==="solved")){a++;continue}const p=m[0].categoryId;if(m.every(d=>d.categoryId===p)){l=!0,a++,v.playRowSolved(),Q({rowsSolved:1,solvedCategoryIds:[p]});const d=w.solvedColors[n%w.solvedColors.length];ie(m.map(h=>h.id),d);for(let h=u;h<u+t;h++)e[h]={...e[h],status:"solved",color:d}}}l&&g(e),a===s&&s>0&&!f&&(v.playWin(),z(!0))},[f,w,N]),A=o=>{if(!(f||j||R))if(I===null)v.playSelect(),C(o),g(t=>t.map(s=>s.id===o?{...s,status:"selected"}:s));else if(I===o)v.playSelect(),C(null),g(t=>t.map(s=>s.id===o?{...s,status:"neutral"}:s));else{const t=c.findIndex(a=>a.id===I),s=c.findIndex(a=>a.id===o);if(t===-1||s===-1){C(null);return}v.playSelect(),g(a=>a.map(e=>e.id===o||e.id===I?{...e,status:"selected"}:e)),setTimeout(()=>{const a=T.current.get(c[t].id),e=T.current.get(c[s].id);if(a&&e){_(!0),v.playSwap(),q(d=>d+1);const l=a.getBoundingClientRect(),n=e.getBoundingClientRect(),u=n.left-l.left,m=n.top-l.top,p=a.querySelector(".tile-text"),x=e.querySelector(".tile-text");p&&(p.style.transition="opacity 0.2s",p.style.opacity="0"),x&&(x.style.transition="opacity 0.2s",x.style.opacity="0"),a.style.transition="transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)",a.style.transform=`translate(${u}px, ${m}px) scale(1.15)`,a.style.zIndex="100",e.style.transition="transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)",e.style.transform=`translate(${-u}px, ${-m}px) scale(1.05)`,e.style.zIndex="90",setTimeout(()=>{a&&(a.style.transition="",a.style.transform="",a.style.zIndex=""),e&&(e.style.transition="",e.style.transform="",e.style.zIndex="");const d=[...c],h=d[t];d[t]={...d[s],status:"neutral"},d[s]={...h,status:"neutral"},g(d),C(null),_(!1),K(d)},400)}else C(null)},120)}},W=()=>{if(j)return;D(!0);let o=Math.floor(Math.random()*ee.length);re(ee[o]),g(t=>t.map(s=>({...s,status:"exiting"}))),setTimeout(()=>te(),500)},J=i.useMemo(()=>{if(!w.solvedColors.length)return"from-zinc-800 to-zinc-900";const o=w.solvedColors.map(t=>t.split(" ")[0].replace("bg-",""));return o.length>=3?`from-${o[0]} via-${o[1]} to-${o[2]}`:`from-${o[0]} to-${o[o.length-1]}`},[w]);let H=y===k.LEVEL_4_THEMED?ae:y.replace(/_/g," ").replace("LEVEL 1 ","").replace("LEVEL ","");return y===k.CLASSIC&&(H="CLASSIC"),y===k.LEVEL_SYNONYMS&&(H="SYNONYMS"),r.jsxs("div",{className:"flex flex-col h-full w-full max-w-4xl mx-auto px-2 relative select-none overflow-hidden",children:[r.jsx(xe,{ref:$}),r.jsxs("header",{className:"h-[12vh] flex items-center justify-between w-full shrink-0 z-[60] px-4",children:[r.jsxs("div",{className:"flex flex-col",children:[r.jsx("h2",{className:"text-xl font-black tracking-widest text-deco-gold uppercase font-oswald leading-none",children:H}),r.jsxs("span",{className:"text-[10px] opacity-70 font-oswald font-bold tracking-widest mt-1 uppercase",children:["LEVEL ",P]})]}),r.jsxs("div",{className:"flex items-center gap-4",children:[(Y||f&&E)&&r.jsx("button",{onClick:W,className:`px-4 py-1.5 bg-gradient-to-r ${J} text-white font-black font-oswald text-sm rounded-full shadow-lg border-2 border-white animate-pop`,children:"NEXT"}),r.jsx("button",{onClick:()=>L==null?void 0:L(ne),className:"p-2 rounded-full bg-zinc-800 border border-zinc-600 hover:border-white text-zinc-300 hover:text-white transition-all active:rotate-90",children:r.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})]}),r.jsx("div",{className:"flex-1 w-full flex flex-col gap-1 pb-2",children:Array.from({length:c.length/4}).map((o,t)=>{const s=c.slice(t*4,t*4+4),a=s.every(l=>(l==null?void 0:l.status)==="solved"||(l==null?void 0:l.status)==="exiting"),e=a&&s[0].color?s[0].color.split(" ")[0].replace("bg-","text-"):"text-white";return r.jsx("div",{className:"w-full relative z-10 flex-1 flex flex-col justify-center min-h-0",children:r.jsxs("div",{className:"relative w-full h-full p-1",children:[a&&r.jsx("div",{className:"absolute inset-0 z-0 animate-fade-in bg-black border-4 border-white rounded-medium"}),a&&r.jsx("div",{className:"absolute top-0 left-8 z-[100] transform",style:{transform:"translateY(calc(-100% + 4px))"},children:r.jsx("div",{className:`animate-pop px-4 py-1 rounded-t-lg text-[10px] md:text-xs font-bold uppercase tracking-widest border-x-4 border-t-4 border-white font-oswald bg-black ${e}`,children:s[0].categoryName})}),r.jsx("div",{className:`grid grid-cols-4 gap-1.5 w-full h-full relative z-10 transition-all duration-300 ${a?"p-3 drop-shadow-xl":""}`,children:s.map(l=>r.jsx("div",{className:"relative w-full h-full",children:r.jsx(fe,{data:l,"data-tile-id":l.id,onClick:A,gradientClass:w.gradient,exitAnimation:oe,ref:n=>{n&&T.current.set(l.id,n)}})},l.id))})]})},t)})}),f&&!Y&&!E&&r.jsxs("div",{className:"absolute inset-0 z-[200] flex flex-col items-center justify-center next-puzzle-overlay animate-fade-in",children:[r.jsxs("div",{className:"flex flex-col items-center gap-2 mb-10",children:[r.jsx("span",{className:"text-white text-2xl font-bold tracking-[0.4em] uppercase opacity-50",children:"Puzzle Cleared"}),r.jsx("div",{className:"w-32 h-1 bg-white rounded-full shadow-[0_0_15px_white]"})]}),r.jsx("button",{onClick:W,className:`px-12 py-6 rounded-full border-4 border-white bg-gradient-to-r ${J} text-white font-black font-oswald text-4xl shadow-[0_0_30px_rgba(255,255,255,0.3)] hover:scale-110 active:scale-95 transition-all uppercase tracking-[0.2em] animate-gradient-shift`,children:"NEXT PUZZLE"}),r.jsx("button",{onClick:()=>G(!0),className:"mt-8 text-deco-gold font-oswald font-black text-xl uppercase tracking-widest hover:text-white transition-colors animate-pulse",children:"CLICK TO REVIEW PUZZLE"})]})]})};export{Ce as default};
