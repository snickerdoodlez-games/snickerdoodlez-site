import{l as d,G as Z,F as Ie,a as M,U as v,f as o,u as ze,v as Me,P as ce}from"./index-DZYk55dN.js";import{f as Te,y as De,h as Le}from"./DebugMenu-BlYmMh_k-BePBMNzk.js";const Oe=({csvData:E,onComplete:de,onExit:ue,levelIndex:G,onThemeChange:T,hintsEnabled:Y,debugMode:fe,onOpenSettings:K})=>{const[f,h]=d.useState([]),[C,q]=d.useState([]),[D,y]=d.useState(null),[L,xe]=d.useState(!0),[j,R]=d.useState(!1),[he,$]=d.useState(!1),[b,me]=d.useState(Z[0]),[O,J]=d.useState(0),[A,N]=d.useState(!1),[P,Q]=d.useState(!1),[pe,ge]=d.useState(""),[X,W]=d.useState(!1),[I,_]=d.useState(0),[ee,be]=d.useState(0),[H,te]=d.useState(!1),[ve,se]=d.useState(0),le=d.useRef(Date.now()),[U,ae]=d.useState([]),S=d.useRef(Date.now()),k=d.useRef(new Map),B=d.useRef(null),ne=d.useRef(!1),z=7,x=4,oe=z*x,we=d.useMemo(()=>{const a=[...f,...C];if(a.length===0)return[];const l=new Map;return a.forEach(r=>{!l.has(r.categoryId)&&r.status!=="placeholder-colored"&&l.set(r.categoryId,{name:r.categoryName,isSolved:!1})}),Array.from(l.values()).sort((r,s)=>r.name.localeCompare(s.name))},[f,C]);d.useEffect(()=>{if(ne.current||!E||E.length===0)return;const a=Z[Math.floor(Math.random()*Z.length)];me(a),T&&T(a.solvedColors);const l=Math.floor(Math.random()*5)+9;be(l),_(l);const r=Ie(l,E);let s=[];r.forEach(u=>{[...u.words].sort(()=>.5-Math.random()).slice(0,4).forEach(i=>{s.push({id:Math.random().toString(36).substr(2,9),word:i,categoryId:u.id,categoryName:u.name,status:"neutral"})})}),s=s.sort(()=>.5-Math.random());const t=s.map((u,i)=>{const e=Math.floor(i/x),c=a.solvedColors[e%a.solvedColors.length];return{...u,color:c}});h(t.slice(0,oe)),q(t.slice(oe)),xe(!1),J(0),N(!1),R(!1),$(!1),Q(!1),te(!1),se(0),le.current=Date.now(),S.current=Date.now(),ne.current=!0},[E,G,T]),d.useEffect(()=>{if(j){const a=Date.now()-le.current;M({levelsCompleted:1,totalTimeMs:a,totalMoves:ve});const l=setTimeout(()=>{$(!0)},800);return()=>clearTimeout(l)}else $(!1)},[j]),d.useEffect(()=>{if(!Y||j||P||L||O>=1)return;const a=setInterval(()=>{Date.now()-S.current>9e4&&!A&&N(!0)},5e3);return()=>clearInterval(a)},[Y,j,P,L,O,A]);const ye=(a,l)=>{if(!B.current)return;const r=Me(l);a.forEach(s=>{var t;const u=k.current.get(s);if(u){const i=u.getBoundingClientRect(),e=i.left+i.width/2,c=i.top+i.height/2;(t=B.current)==null||t.explode(e,c,r)}})},F=a=>{ae(l=>[...l,JSON.parse(JSON.stringify(a))].slice(-10))},V=d.useCallback(a=>{let l=[...a],r=-1,s="";for(let t=0;t<z;t++){const u=t*x,i=u+x;if(i>l.length)break;const e=l.slice(u,i);if(e.some(n=>n.status==="placeholder-colored"||n.status==="solved"))continue;const c=e[0].categoryId;if(e.every(n=>n.categoryId===c)){r=t,s=c;break}}if(r!==-1){v.playRowSolved();const t=b.solvedColors[(ee-I)%b.solvedColors.length],u=r*x,i=[];for(let e=0;e<x;e++)l[u+e]={...l[u+e],status:"solved",color:t},i.push(l[u+e].id);h(l),ye(i,t),M({rowsSolved:1,solvedCategoryIds:[s]}),_(e=>e-1),setTimeout(()=>{const e=[...l.slice(0,u),...l.slice(u+x)];let c=[...C];const n=[],m=b.solvedColors[Math.floor(Math.random()*b.solvedColors.length)];for(let g=0;g<x;g++)if(c.length>0){const w=c.shift();w&&n.push({...w,status:"neutral",isEmoji:!1,color:m})}else n.push({id:`blank-${Math.random()}`,word:"",categoryId:"blank",categoryName:"",status:"placeholder-colored",color:m});q(c),h([...e,...n]),S.current=Date.now(),I<=1&&(R(!0),v.playWin())},1500)}},[I,C,b,ee]),je=a=>{if(j||P||X||H)return;const l=f.findIndex(s=>s.id===a);if(l===-1)return;const r=f[l];if(!(r.status==="placeholder-colored"||r.status==="solved"))if(S.current=Date.now(),N(!1),D===null)v.playSelect(),y(a),h(s=>s.map(t=>t.id===a?{...t,status:"selected"}:t));else if(D===a)v.playSelect(),y(null),h(s=>s.map(t=>t.id===a?{...t,status:"neutral"}:t));else{const s=f.findIndex(n=>n.id===D),t=f.findIndex(n=>n.id===a);if(s===-1||t===-1){y(null);return}F(f),se(n=>n+1);const u=f[s].id,i=f[t].id,e=k.current.get(u),c=k.current.get(i);if(W(!0),v.playSwap(),e&&c){const n=e.getBoundingClientRect(),m=c.getBoundingClientRect(),g=m.left-n.left,w=m.top-n.top;e.style.transition="transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1), z-index 0s",e.style.transform=`translate(${g}px, ${w}px) scale(1.1)`,e.style.zIndex="50",c.style.transition="transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1), z-index 0s",c.style.transform=`translate(${-g}px, ${-w}px) scale(0.9)`,c.style.zIndex="40",setTimeout(()=>{e&&(e.style.transform="",e.style.zIndex="",e.style.transition=""),c&&(c.style.transform="",c.style.zIndex="",c.style.transition="");const p=[...f];p[s]={...p[s],status:"neutral"},p[t]={...p[t],status:"neutral"};const Ce=p[s];p[s]=p[t],p[t]=Ce,h(p),y(null),W(!1),V(p)},300)}else{const n=[...f];n[s]={...n[s],status:"neutral"},n[t]={...n[t],status:"neutral"};const m=n[s];n[s]=n[t],n[t]=m,h(n),y(null),W(!1),V(n)}}},re=(a=!1)=>{if(!a&&(O>=1||X))return;S.current=Date.now(),N(!1);const l={};f.forEach(e=>{(e.status==="neutral"||e.status==="selected")&&(l[e.categoryId]=(l[e.categoryId]||0)+1)});const r=Object.keys(l).find(e=>l[e]>=4);if(!r)return;let s=-1;for(let e=0;e<z;e++){const c=e*x;if(f.slice(c,c+x).every(n=>n.status==="neutral"||n.status==="selected")){s=e;break}}if(s===-1)return;F(f);const t=[...f],u=t.filter(e=>e.categoryId===r&&(e.status==="neutral"||e.status==="selected")).map(e=>e.id).slice(0,4),i=[s*x,s*x+1,s*x+2,s*x+3];for(let e=0;e<4;e++){const c=i[e],n=t[c];if(u.includes(n.id))continue;const m=t.findIndex((g,w)=>u.includes(g.id)&&!i.includes(w));if(m!==-1){const g=t[c];t[c]=t[m],t[m]=g}}h(t),v.playRowSolved(),a||(J(e=>e+1),M({hintsUsed:1})),setTimeout(()=>V(t),200)},Ne=()=>{N(!1),M({hintsRefused:1})},ie=()=>{Q(!0);let a=Math.floor(Math.random()*ce.length);ge(ce[a]),h(l=>l.map(r=>({...r,status:"exiting"}))),setTimeout(()=>{de({mode:"HIDDEN TILES",mistakes:0})},500)},Se=()=>{re(!0)},ke=()=>{F(f),_(0);const a=f.map((l,r)=>{const s=Math.floor(r/x),t=b.solvedColors[s%b.solvedColors.length];return{...l,status:"solved",color:t}});h(a),R(!0),v.playWin()},Ee=()=>{if(U.length>0){const a=U[U.length-1];h(a),ae(l=>l.slice(0,l.length-1)),v.playSelect()}};return L?o.jsx("div",{className:"text-white text-center mt-20 animate-pulse font-oswald text-xl uppercase",children:"LOADING STACK..."}):o.jsxs("div",{className:"flex flex-col items-center w-full max-w-4xl mx-auto h-full px-4 relative select-none overflow-hidden pb-4",children:[o.jsx(Te,{ref:B}),fe&&o.jsx(De,{onMainMenu:ue,onSolveOne:Se,onSolvePuzzle:ke,onUndo:Ee}),A&&o.jsx("div",{className:"absolute inset-0 z-[90] flex items-center justify-center animate-fade-in bg-black/60 backdrop-blur-[2px]",children:o.jsxs("div",{className:"bg-zinc-900 border-4 border-neon-blue rounded-2xl p-6 flex flex-col items-center gap-6 shadow-[0_0_40px_rgba(0,229,255,0.3)] animate-pop w-[90%] max-w-sm",children:[o.jsx("span",{className:"text-white font-black font-oswald text-2xl uppercase tracking-widest text-center drop-shadow-md",children:"NEED SOME HELP?"}),o.jsxs("div",{className:"flex gap-4 w-full",children:[o.jsx("button",{onClick:()=>re(!1),className:"flex-1 bg-neon-blue text-black py-3 rounded-xl font-black uppercase font-oswald text-xl shadow-lg",children:"YES"}),o.jsx("button",{onClick:Ne,className:"flex-1 bg-zinc-800 border-2 border-zinc-600 text-zinc-400 py-3 rounded-xl font-bold uppercase font-oswald text-xl",children:"NO"})]})]})}),he&&!H&&o.jsx("div",{className:"absolute inset-0 z-[100] flex items-center justify-center animate-fade-in bg-black/80 backdrop-blur-sm",children:o.jsxs("div",{className:"relative z-10 flex flex-col items-center min-w-[300px] text-center animate-celebrate",children:[o.jsx(Le,{onClick:ie,levelIndex:G}),o.jsx("div",{onClick:()=>te(!0),className:"mt-4 text-white font-oswald uppercase tracking-widest text-sm hover:text-cyan-400 cursor-pointer animate-pulse transition-colors uppercase",children:"TAP HERE TO REVIEW SOLVED PUZZLE"})]})}),o.jsx("div",{className:"relative flex flex-col justify-center w-full items-end mb-1 py-1 shrink-0 h-auto min-h-[50px] pr-2",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsxs("div",{className:"flex flex-col items-end",children:[o.jsx("h2",{className:"text-right text-3xl font-bold tracking-widest text-deco-gold uppercase font-righteous drop-shadow-md leading-none",children:"HIDDEN TILES"}),o.jsxs("div",{className:"text-white font-oswald text-sm tracking-widest mt-1 text-right uppercase",children:["ROWS LEFT: ",o.jsx("span",{className:"text-neon-blue font-bold text-lg uppercase",children:I})]})]}),H?o.jsx("button",{onClick:ie,className:"px-3 py-1 bg-neon-green text-black font-bold font-oswald uppercase rounded shadow-lg animate-pulse hover:scale-105 transition-transform uppercase",children:"NEXT LEVEL >>"}):o.jsx("button",{onClick:()=>K==null?void 0:K(we),className:"p-1 rounded-full bg-zinc-800 border border-zinc-600 hover:bg-zinc-700 hover:border-white transition-all text-zinc-300 hover:text-white uppercase",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.592c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a7.75 7.75 0 0 1 0 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 0 1 0-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281Z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})}),o.jsx("div",{className:"w-full flex-1 flex flex-col gap-2 min-h-0 relative z-10 py-2",children:Array.from({length:z}).map((a,l)=>{const r=l*x,s=f.slice(r,r+x);if(s.length===0)return null;const t=s.length===x&&s.every(i=>i.status==="solved"),u=t&&s[0].color?s[0].color.split(" ")[0]:"bg-zinc-800";return o.jsxs("div",{className:"w-full flex-1 relative min-h-0",children:[t&&o.jsx("div",{className:"absolute inset-0 z-0 animate-fade-in bg-black border-4 border-white rounded-medium"}),t&&o.jsx("div",{className:"absolute top-0 left-8 z-[100] transform",style:{transform:"translateY(calc(-100% + 4px))"},children:o.jsx("div",{className:`animate-pop px-3 py-1 rounded-t-lg text-[10px] md:text-xs font-bold uppercase tracking-widest leading-tight border-x-4 border-t-4 border-b-0 border-white shadow-[0_-12px_24px_rgba(0,0,0,0.8)] font-oswald text-white drop-shadow-md ${u}`,children:s[0].categoryName})}),o.jsx("div",{className:`w-full h-full grid grid-cols-4 gap-2 relative z-10 transition-all duration-300 ${t?"p-3 drop-shadow-xl":""}`,children:s.map(i=>o.jsx("div",{className:"relative w-full h-full",children:o.jsx(ze,{data:i,"data-tile-id":i.id,onClick:e=>je(e),gradientClass:b.gradient,exitAnimation:pe,ref:e=>{e?k.current.set(i.id,e):k.current.delete(i.id)}})},i.id))})]},l)})})]})};export{Oe as default};
