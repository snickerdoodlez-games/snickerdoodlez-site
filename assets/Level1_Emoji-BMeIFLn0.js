import{r as c,T as R,e as Y,b as w,u as Q,E as G,j as n,c as ee}from"./index-B1BpELOr.js";import{P as te}from"./ParticleOverlay-BxzBYbW3.js";const ce=({onComplete:O,onExit:se,levelIndex:A,onThemeChange:C,hintsEnabled:ae,debugMode:oe,onOpenAnimLab:le,onOpenSettings:E,isStressTesting:I,diagnosticSpeed:L})=>{const[r,h]=c.useState([]),[y,b]=c.useState(null),[$,X]=c.useState(!0),[p,k]=c.useState(!1),[_,W]=c.useState(!1),[g,q]=c.useState(R[0]),[j,D]=c.useState(!1),[J,U]=c.useState(""),[T,B]=c.useState(!1),[ne,H]=c.useState(0),V=c.useRef(Date.now()),N=c.useRef(new Map),F=c.useRef(null),d=3,K=c.useMemo(()=>{if(r.length===0)return[];const a=new Map;return r.forEach(t=>{if(!a.has(t.categoryId)){const s=r.filter(e=>e.categoryId===t.categoryId);a.set(t.categoryId,{name:t.categoryName,isSolved:s.every(e=>["solved","exiting"].includes(e.status))})}}),Array.from(a.values()).sort((t,s)=>t.name.localeCompare(s.name))},[r]);c.useEffect(()=>{const a=R[Math.floor(Math.random()*R.length)];q(a),C&&C(a.solvedColors);const t=[...Y()].sort(()=>.5-Math.random()),s=[],e=new Set;let o=0;const l=7;for(const i of t){if(o>=l)break;const u=[...new Set(i.words)].filter(f=>!e.has(f)).sort(()=>.5-Math.random()).slice(0,d);u.length>=d&&(u.forEach(f=>{e.add(f),s.push({id:Math.random().toString(36).substr(2,9),word:f,categoryId:i.id,categoryName:i.name,status:"neutral",isEmoji:!0})}),o++)}h(s.sort(()=>.5-Math.random())),k(!1),W(!1),D(!1),X(!1),H(0),V.current=Date.now()},[A,C]),c.useEffect(()=>{if(!I||j||$||T)return;if(p){setTimeout(()=>M(),1500);return}if(L==="instant"){k(!0),w.playWin();return}const t=setTimeout(()=>{const s=Array.from(new Set(r.map(o=>o.categoryId)));let e=!1;for(let o=0;o<r.length/d;o++){const l=s[o],i=o*d,u=i+d;if(r.slice(i,u).every(m=>m.status==="solved"))continue;const v=r.findIndex((m,x)=>x>=i&&x<u&&m.categoryId!==l);if(v!==-1){const m=r.findIndex((x,z)=>z>=u&&x.categoryId===l);if(m!==-1){S(r[v].id),setTimeout(()=>{j||p||S(r[m].id)},800),e=!0;break}}}!e&&!p&&P(r)},1200);return()=>clearTimeout(t)},[I,p,$,T,L,r]);const P=c.useCallback(a=>{const t=[...a];let s=!1,e=0;const o=t.length/d;for(let l=0;l<o;l++){const i=t.slice(l*d,l*d+d);if(i.every(u=>u.status==="solved")){e++;continue}if(i.every(u=>u.categoryId===i[0].categoryId)){s=!0,e++,w.playRowSolved(),Q({rowsSolved:1,solvedCategoryIds:[i[0].categoryId]});const u=g.solvedColors[l%g.solvedColors.length];for(let f=l*d;f<l*d+d;f++)t[f]={...t[f],status:"solved",color:u}}}return s&&h(t),e===o&&!p&&(w.playWin(),k(!0)),s},[p,g]),S=a=>{if(!(p||j||T))if(y===null)w.playSelect(),b(a),h(t=>t.map(s=>s.id===a?{...s,status:"selected"}:s));else if(y===a)w.playSelect(),b(null),h(t=>t.map(s=>s.id===a?{...s,status:"neutral"}:s));else{const t=r.findIndex(e=>e.id===y),s=r.findIndex(e=>e.id===a);if(t===-1||s===-1){b(null);return}w.playSelect(),h(e=>e.map(o=>o.id===a||o.id===y?{...o,status:"selected"}:o)),setTimeout(()=>{const e=N.current.get(y),o=N.current.get(a);if(e&&o){B(!0),w.playSwap(),H(x=>x+1);const l=e.getBoundingClientRect(),i=o.getBoundingClientRect(),u=i.left-l.left,f=i.top-l.top,v=e.querySelector(".tile-text"),m=o.querySelector(".tile-text");v&&(v.style.transition="opacity 0.2s",v.style.opacity="0"),m&&(m.style.transition="opacity 0.2s",m.style.opacity="0"),e.style.transition="transform 0.4s ease-out",e.style.transform=`translate(${u}px, ${f}px) scale(1.15)`,e.style.zIndex="100",o.style.transition="transform 0.4s ease-out",o.style.transform=`translate(${-u}px, ${-f}px) scale(1.05)`,o.style.zIndex="90",setTimeout(()=>{e.style.transform="",o.style.transform="",e.style.zIndex="",o.style.zIndex="";const x=[...r],z=x[t];x[t]={...x[s],status:"neutral"},x[s]={...z,status:"neutral"},h(x),b(null),B(!1),P(x)},400)}else b(null)},120)}},M=()=>{j||(D(!0),U(G[Math.floor(Math.random()*G.length)]),h(a=>a.map(t=>({...t,status:"exiting"}))),setTimeout(()=>O({mode:"EMOJI MATCH",mistakes:0}),500))},Z=c.useMemo(()=>{if(!g.solvedColors.length)return"from-zinc-800 to-zinc-900";const a=g.solvedColors.map(t=>t.split(" ")[0].replace("bg-",""));return a.length>=3?`from-${a[0]} via-${a[1]} to-${a[2]}`:`from-${a[0]} to-${a[a.length-1]}`},[g]);return n.jsxs("div",{className:"flex flex-col h-full w-full max-w-4xl mx-auto px-2 relative select-none overflow-hidden",children:[n.jsx(te,{ref:F}),n.jsxs("header",{className:"h-[12vh] flex items-center justify-between w-full shrink-0 z-[60] px-4",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("h2",{className:"text-xl font-black tracking-widest text-deco-gold uppercase font-oswald leading-none",children:"EMOJI MATCH"}),n.jsxs("span",{className:"text-[10px] opacity-70 font-oswald font-bold tracking-widest mt-1 uppercase",children:["LEVEL ",A]})]}),n.jsxs("div",{className:"flex items-center gap-4",children:[(_||p&&I)&&n.jsx("button",{onClick:M,className:`px-4 py-1.5 bg-gradient-to-r ${Z} text-white font-black font-oswald text-xs rounded-full shadow-lg border-2 border-white animate-pop`,children:"NEXT"}),n.jsx("button",{onClick:()=>E==null?void 0:E(K),className:"p-2 rounded-full bg-zinc-800 border border-zinc-600 hover:border-white text-zinc-300 hover:text-white transition-all active:rotate-90",children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})]}),n.jsx("div",{className:"flex-1 w-full flex flex-col gap-1 pb-2",children:Array.from({length:r.length/d}).map((a,t)=>{const s=r.slice(t*d,t*d+d),e=s.every(l=>(l==null?void 0:l.status)==="solved"||(l==null?void 0:l.status)==="exiting"),o=e&&s[0].color?s[0].color.split(" ")[0].replace("bg-","text-"):"text-white";return n.jsx("div",{className:"w-full relative flex-1 flex flex-col justify-center min-h-0",children:n.jsxs("div",{className:"relative w-full h-full p-1",children:[e&&n.jsx("div",{className:"absolute inset-0 z-0 animate-fade-in bg-black border-4 border-white rounded-xl"}),e&&n.jsx("div",{className:"absolute top-0 left-8 z-[100] transform",style:{transform:"translateY(calc(-100% + 4px))"},children:n.jsx("div",{className:`animate-pop px-3 py-1 rounded-t-lg text-[10px] md:text-xs font-bold uppercase tracking-widest border-x-4 border-t-4 border-white font-oswald bg-black ${o}`,children:s[0].categoryName})}),n.jsx("div",{className:`grid grid-cols-3 gap-2 w-full h-full relative z-10 p-1 ${e?"p-2":""}`,children:s.map(l=>n.jsx("div",{className:"relative w-full h-full",children:n.jsx(ee,{data:l,"data-tile-id":l.id,onClick:S,gradientClass:g.gradient,exitAnimation:J,ref:i=>{i&&N.current.set(l.id,i)}})},l.id))})]})},t)})}),p&&!_&&!I&&n.jsxs("div",{className:"absolute inset-0 z-[200] flex flex-col items-center justify-center next-puzzle-overlay animate-fade-in",children:[n.jsxs("div",{className:"flex flex-col items-center gap-2 mb-10",children:[n.jsx("span",{className:"text-white text-2xl font-bold tracking-[0.4em] uppercase opacity-50",children:"Match Complete"}),n.jsx("div",{className:"w-32 h-1 bg-white rounded-full shadow-[0_0_15px_white]"})]}),n.jsx("button",{onClick:M,className:`px-12 py-6 rounded-full border-4 border-white bg-gradient-to-r ${Z} text-white font-black font-oswald text-4xl shadow-2xl hover:scale-110 active:scale-95 transition-all uppercase tracking-[0.2em] animate-gradient-shift`,children:"NEXT PUZZLE"}),n.jsx("button",{onClick:()=>W(!0),className:"mt-8 text-deco-gold font-oswald font-black text-xl uppercase tracking-widest hover:text-white transition-colors animate-pulse",children:"CLICK TO REVIEW PUZZLE"})]})]})};export{ce as default};
