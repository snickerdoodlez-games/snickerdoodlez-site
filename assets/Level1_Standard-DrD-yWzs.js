import{r as a,T as K,G as z,g as He,a as De,b as g,u as Q,j as c,c as Oe,E as D,d as Ve}from"./index-CdL25Luv.js";import{P as Ue,D as Pe,N as Be}from"./DebugMenu-BlYmMh_k.js";const Xe=({csvData:j,onComplete:ge,onExit:we,mode:p,levelIndex:O,onThemeChange:V,hintsEnabled:ee,timeLimit:S,onOpenSettings:U,debugMode:ve,onOpenAnimLab:We})=>{const[d,m]=a.useState([]),[P,M]=a.useState(null),[w,B]=a.useState(!0),[x,te]=a.useState(!1),[ye,W]=a.useState(!1),[Ee,se]=a.useState(""),[Se,be]=a.useState(!1),[b,Ce]=a.useState(K[0]),[Y,ne]=a.useState(0),[re,R]=a.useState(!1),[L,ae]=a.useState(!1),[Ie,Ne]=a.useState(""),[oe,Ye]=a.useState(0),[le,_]=a.useState(!1),[$,ie]=a.useState(!1),[ce,de]=a.useState(0),ue=a.useRef(Date.now()),[G,Z]=a.useState([]),[C,fe]=a.useState(!1),[$e,Te]=a.useState(!1),[Ge,he]=a.useState(S||0),[I,me]=a.useState(!1),k=a.useRef(Date.now()),J=a.useRef(!1),xe=a.useRef(-1),N=a.useRef(null),A=a.useRef(new Map),X=a.useRef(null),je=a.useMemo(()=>{if(d.length===0)return[];const t=new Map;return d.forEach(n=>{if(!t.has(n.categoryId)){const r=d.filter(i=>i.categoryId===n.categoryId).every(i=>i.status==="solved"||i.status==="exiting");t.set(n.categoryId,{name:n.categoryName,isSolved:r})}}),Array.from(t.values()).sort((n,s)=>n.name.localeCompare(s.name))},[d]);a.useEffect(()=>{if(J.current&&d.length>0)return;if(!j||j.length===0){B(!0);return}const t=K[Math.floor(Math.random()*K.length)];Ce(t),V&&V(t.solvedColors);let n=[];if(p===z.LEVEL_4_THEMED){const l=He(20,j);n=l.categories,se(l.name)}else n=De(30,j),se("");if(n.length===0){be(!0),B(!1);return}const s=[],r=new Set,i=[];for(const l of n){if(i.length>=7)break;const u=l.words.filter(e=>!r.has(e));u.length>=4&&([...u].sort(()=>.5-Math.random()).slice(0,4).forEach(o=>{r.add(o),s.push({id:Math.random().toString(36).substr(2,9),word:o,categoryId:l.id,categoryName:l.name.includes(":")?l.name.split(":")[1].trim():l.name,status:"neutral"})}),i.push(l))}m(s.sort(()=>.5-Math.random())),Z([]),te(!1),W(!1),ae(!1),B(!1),ne(0),R(!1),Te(!1),me(!1),_(!1),ie(!1),de(0),p===z.LEVEL_RHYMES?fe(!0):fe(!1),S&&he(S),k.current=Date.now(),ue.current=Date.now(),J.current=!0},[j,p,O,S,oe,V]),a.useEffect(()=>{J.current=!1},[O,p,oe]),a.useEffect(()=>{if(!S||x||L||I||w||C){N.current&&clearInterval(N.current);return}return N.current=setInterval(()=>{he(t=>t<=1?(clearInterval(N.current),me(!0),g.playError(),0):t-1)},1e3),()=>{N.current&&clearInterval(N.current)}},[S,x,L,I,w,C]),a.useEffect(()=>{if(!ee||x||L||w||Y>=1||I||C)return;const t=setInterval(()=>{Date.now()-k.current>9e4&&!re&&R(!0)},5e3);return()=>clearInterval(t)},[ee,x,L,w,Y,re,I,C]),a.useEffect(()=>{if(x){const t=Date.now()-ue.current;Q({levelsCompleted:1,totalTimeMs:t,totalMoves:ce});const n=setTimeout(()=>{W(!0)},800);return()=>clearTimeout(n)}else W(!1)},[x,ce]);const F=t=>{Z(n=>[...n,JSON.parse(JSON.stringify(t))].slice(-10))},Me=(t,n)=>{if(!X.current)return;const s=Oe(n);t.forEach(r=>{var l;const i=A.current.get(r);if(i){const u=i.getBoundingClientRect(),e=u.left+u.width/2,o=u.top+u.height/2;(l=X.current)==null||l.explode(e,o,s)}})},H=a.useCallback(t=>{var u,e;if(w)return;const n=4,s=t.length/n;let r=0;const i=[...t];let l=!1;for(let o=0;o<s;o++){const f=o*n,h=i.slice(f,f+n);if(!h[0]||((u=h[0])==null?void 0:u.status)==="solved"){((e=h[0])==null?void 0:e.status)==="solved"&&r++;continue}const v=h[0].categoryId;if(h.every(E=>E&&E.categoryId===v)){l=!0,r++,g.playRowSolved(),Q({rowsSolved:1,solvedCategoryIds:[v]});const E=b.solvedColors[o%b.solvedColors.length],Ae=h.map(T=>T.id);Me(Ae,E);for(let T=f;T<f+n;T++)i[T]={...i[T],status:"solved",color:E}}}l&&(m(i),k.current=Date.now(),R(!1)),r===s&&s>0&&!x&&(g.playWin(),te(!0))},[x,b,w]),Re=t=>{if(!(x||L||I||C||le||$||!d.find(s=>s.id===t)))if(k.current=Date.now(),R(!1),P===null)g.playSelect(),M(t),m(s=>s.map(r=>r.id===t?{...r,status:"selected"}:r));else if(P===t)g.playSelect(),M(null),m(s=>s.map(r=>r.id===t?{...r,status:"neutral"}:r));else{const s=d.findIndex(o=>o.id===P),r=d.findIndex(o=>o.id===t);if(s===-1||r===-1){M(null);return}F(d),de(o=>o+1);const i=d[s].id,l=d[r].id,u=A.current.get(i),e=A.current.get(l);if(_(!0),u&&e){g.playSwap();const o=u.getBoundingClientRect(),f=e.getBoundingClientRect(),h=f.left-o.left,v=f.top-o.top;u.style.transition="transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",u.style.transform=`translate(${h}px, ${v}px) scale(1.15)`,e.style.transition="transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",e.style.transform=`translate(${-h}px, ${-v}px) scale(0.95)`,setTimeout(()=>{u&&(u.style.transition="",u.style.transform=""),e&&(e.style.transition="",e.style.transform="");const y=[...d],E=y[s];y[s]={...y[r],status:"neutral"},y[r]={...E,status:"neutral"},m(y),M(null),_(!1),H(y)},300)}else{const o=[...d],f=o[s];o[s]=o[r],o[r]=f,m(o),M(null),_(!1),H(o)}}},Le=(t=!1)=>{if(!t&&(Y>=1||I||C||le))return;k.current=Date.now(),R(!1);const n=d.filter(e=>e.status!=="solved").map(e=>e.categoryId),s={};n.forEach(e=>s[e]=(s[e]||0)+1);const r=Object.keys(s).find(e=>s[e]>=4);if(!r)return;const i=Math.floor(d.findIndex(e=>e.status!=="solved")/4);F(d);const l=[...d],u=d.filter(e=>e.categoryId===r&&e.status!=="solved").map(e=>e.id);for(let e=0;e<4;e++){const o=i*4+e,f=l.findIndex(v=>v.id===u[e]),h=l[o];l[o]=l[f],l[f]=h}m(l),g.playRowSolved(),t||(ne(e=>e+1),Q({hintsUsed:1})),setTimeout(()=>H(l),200)},pe=()=>{ae(!0);let t=Math.floor(Math.random()*D.length);for(;t===xe.current&&D.length>1;)t=Math.floor(Math.random()*D.length);xe.current=t,Ne(D[t]),m(n=>n.map(s=>({...s,status:"exiting"}))),setTimeout(()=>{ge()},500)},ke=()=>{F(d);const t=new Map;d.forEach(s=>{const r=t.get(s.categoryId)||[];r.push(s),t.set(s.categoryId,r)});const n=[];Array.from(t.values()).forEach((s,r)=>{const i=b.solvedColors[r%b.solvedColors.length];s.forEach(l=>{n.push({...l,status:"solved",color:i})})}),m(n),setTimeout(()=>H(n),100)},ze=()=>{if(G.length>0){const t=G[G.length-1];m(t),Z(n=>n.slice(0,-1)),g.playSelect()}};if(Se)return c.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] text-white animate-fade-in",children:[c.jsx("p",{className:"mb-4 text-red-400 font-righteous text-xl",children:"COULD NOT GENERATE LEVEL CONTENT."}),c.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-white text-black font-bold rounded-full",children:"RETRY"})]});if(w)return c.jsx("div",{className:"text-white text-center mt-20 animate-pulse font-righteous",children:"LOADING LEVEL..."});const _e=()=>{const t=[],n=d.length/4;for(let s=0;s<n;s++){const r=s*4,i=d.slice(r,r+4);if(!i[0])continue;const l=i.every(e=>(e==null?void 0:e.status)==="solved"||(e==null?void 0:e.status)==="exiting"),u=l&&i[0].color?i[0].color.split(" ")[0]:"bg-zinc-800";t.push(c.jsx("div",{className:"w-full relative z-10 flex-1 flex flex-col justify-center min-h-0",children:c.jsxs("div",{className:"relative w-full h-full p-1",children:[l&&c.jsx("div",{className:"absolute inset-0 z-0 animate-fade-in bg-black border-4 border-white rounded-medium"}),l&&c.jsx("div",{className:"absolute top-0 left-8 z-[100] transform",style:{transform:"translateY(calc(-100% + 4px))"},children:c.jsx("div",{className:`animate-pop px-4 py-1 rounded-t-lg text-[10px] md:text-xs font-bold uppercase tracking-widest leading-tight border-x-4 border-t-4 border-b-0 border-white shadow-[0_-12px_24px_rgba(0,0,0,0.8)] font-oswald text-white drop-shadow-[0_2px_4px_rgba(0,0,0,1)] ${u}`,children:i[0].categoryName})}),c.jsx("div",{className:`grid grid-cols-4 gap-1.5 w-full h-full relative z-10 transition-all duration-300 ${l?"p-3 drop-shadow-xl":""}`,children:i.map(e=>c.jsx("div",{className:"relative w-full h-full",children:c.jsx(Ve,{data:e,"data-tile-id":e.id,onClick:o=>Re(o),gradientClass:b.gradient,exitAnimation:Ie,ref:o=>{o&&A.current.set(e.id,o)}})},e.id))})]})},s))}return t};let q=p===z.LEVEL_4_THEMED?Ee:p.replace(/_/g," ").replace("LEVEL 1 ","").replace("LEVEL ","");return p===z.CLASSIC&&(q="CLASSIC"),p===z.LEVEL_SYNONYMS&&(q="SYNONYMS"),c.jsxs("div",{className:"flex flex-col items-center w-full max-w-4xl mx-auto h-full px-2 relative select-none overflow-hidden pb-1",children:[c.jsx(Ue,{ref:X}),ve&&c.jsx(Pe,{onMainMenu:we,onSolveOne:()=>Le(!0),onSolvePuzzle:ke,onUndo:ze}),ye&&!$&&c.jsx("div",{className:"absolute inset-0 z-[100] flex items-center justify-center animate-fade-in bg-black/80 backdrop-blur-sm",children:c.jsxs("div",{className:"relative z-10 flex flex-col items-center min-w-[300px] text-center animate-celebrate",children:[c.jsx(Be,{onClick:pe,levelIndex:O}),c.jsx("div",{onClick:()=>ie(!0),className:"mt-4 text-white font-oswald uppercase tracking-widest text-sm hover:text-cyan-400 cursor-pointer animate-pulse transition-colors uppercase",children:"TAP HERE TO REVIEW SOLVED PUZZLE"})]})}),c.jsx("div",{className:"relative flex flex-col justify-center w-full items-end mb-1 py-1 shrink-0 z-[60] h-auto min-h-[40px] pr-4",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("h2",{className:"text-right pointer-events-none text-2xl font-bold tracking-widest text-deco-gold uppercase font-righteous drop-shadow-md",children:q}),$?c.jsx("button",{onClick:pe,className:"px-3 py-1 bg-neon-green text-black font-bold font-oswald uppercase rounded shadow-lg animate-pulse hover:scale-105 transition-transform uppercase",children:"NEXT LEVEL >>"}):c.jsx("button",{onClick:()=>U==null?void 0:U(je),className:"p-1 rounded-full bg-zinc-800 border border-zinc-600 hover:bg-zinc-700 hover:border-white transition-all text-zinc-300 hover:text-white active:animate-spin",children:c.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.592c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a7.75 7.75 0 0 1 0 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 0 1 0-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281Z"}),c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})}),c.jsx("div",{className:"w-full flex-1 flex flex-col animate-fade-in gap-1",children:_e()})]})};export{Xe as default};
