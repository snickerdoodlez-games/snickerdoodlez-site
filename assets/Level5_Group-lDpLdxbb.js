import{r as n,a as g,j as c,H as K,b as O}from"./index-D9YckaCJ.js";import{g as Q,P as X}from"./ParticleOverlay-B0gEOZzq.js";const ee=({csvData:R,onComplete:y,levelIndex:F,onOpenSettings:I,isReviewing:u,onNext:L,hintsEnabled:w})=>{const[d,f]=n.useState([]),[b,h]=n.useState([]),[m,_]=n.useState(1),[p,A]=n.useState(0),[M,D]=n.useState(0),[T,P]=n.useState(0),[N,z]=n.useState(90),[x,q]=n.useState(!1),[S,G]=n.useState(0),[j,U]=n.useState([]),v=n.useRef(Date.now()),k=n.useRef(null),E=n.useRef(Date.now()),H=n.useRef(new Map);n.useEffect(()=>{const e=Q(4,R,4),r=[];for(const l of e)l.words.slice(0,4).forEach(o=>{r.push({id:Math.random().toString(36).substr(2,9),word:o,categoryId:l.id,categoryName:l.name,status:"neutral"})});f(r.sort(()=>.5-Math.random())),h([]),D(0),z(Math.max(15,90-(m-1)*20)),v.current=Date.now()},[m,R]),n.useEffect(()=>{if(x||u)return;const e=setInterval(()=>{z(r=>r<=1?(clearInterval(e),B(),0):r-1)},1e3);return()=>clearInterval(e)},[x,u,m]),n.useEffect(()=>{if(x||u||!w)return;const e=setInterval(()=>{Date.now()-v.current>9e4&&W()},1e3);return()=>clearInterval(e)},[d,x,u,w]);const B=()=>{y({roundsWon:T,timeMs:Date.now()-E.current,moves:0,failed:!0,mistakes:p})},W=()=>{if(x||u)return;const e=d.filter(t=>t.status!=="solved");if(e.length<2)return;const r=e[0].categoryId,l=e.filter(t=>t.categoryId===r).slice(0,2);f(t=>t.map(o=>l.some(a=>a.id===o.id)?{...o,status:"correct-preview"}:o)),g.playTick(),G(t=>t+1),v.current=Date.now(),setTimeout(()=>{f(t=>t.map(o=>o.status==="correct-preview"?{...o,status:"neutral"}:o))},1500)},C=n.useCallback(e=>{m===3?(g.playWin(),q(!0),setTimeout(()=>y({roundsWon:e,timeMs:Date.now()-E.current,moves:12,hintsUsedCount:S,mistakes:p,solvedCategoryIds:j}),1e3)):setTimeout(()=>_(r=>r+1),600)},[m,S,p,j,y]),V=n.useCallback((e,r)=>{const l=r.filter(t=>e.includes(t.id));if(l.length===4&&l.every(t=>t.categoryId===l[0].categoryId)){g.playRowSolved(),v.current=Date.now();const t=l[0].categoryId;U(a=>Array.from(new Set([...a,t])));const o=r.map(a=>e.includes(a.id)?{...a,status:"solved",color:"bg-neon-green shadow-[0_0_20px_#00FF66]"}:a);f(o),h([]),e.forEach(a=>{var i;const s=(i=H.current.get(a))==null?void 0:i.getBoundingClientRect();s&&k.current&&k.current.explode(s.left+s.width/2,s.top+s.height/2,"#00FF66")}),o.every(a=>a.status==="solved")&&P(a=>{const s=a+1;return C(s),s})}else if(e.length===4){g.playError();const t=p+1,o=M+1;A(t),D(o),f(a=>a.map(s=>e.includes(s.id)?{...s,status:"wrong"}:s)),setTimeout(()=>{o>=5?C(T):(f(a=>a.map(s=>s.status==="wrong"?{...s,status:"neutral"}:s)),h([]))},500)}},[m,M,p,j,S,C,T]),$=e=>{if(x||N===0||u)return;const r=d.find(s=>s.id===e);if(!r||r.status==="solved"||r.status==="wrong")return;g.playSelect();const t=b.includes(e)?b.filter(s=>s!==e):[...b,e].slice(0,4);h(t);const a=(()=>{if(t.length===3){const s=d.filter(i=>t.includes(i.id));return s.every(i=>i.categoryId===s[0].categoryId)}return!1})();f(s=>s.map(i=>i.status==="solved"?i:t.includes(i.id)?{...i,status:a?"correct-preview":"selected"}:{...i,status:"neutral"})),t.length===4&&setTimeout(()=>V(t,d),150)},J=n.useMemo(()=>{const e=new Map;return d.forEach(r=>e.set(r.categoryName,r.status==="solved")),Array.from(e.entries()).map(([r,l])=>({name:r,isSolved:l}))},[d]);return c.jsxs("div",{className:"flex flex-col h-full w-full max-w-4xl mx-auto overflow-hidden relative bg-black",children:[c.jsxs(K,{modeName:"MIND MATCH",levelIndex:F,onOpenSettings:()=>I==null?void 0:I(J),isReviewing:u,onNext:L,hintsEnabled:w,onManualHint:W,children:[c.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-3 py-1 rounded-full flex flex-col items-end",children:[c.jsx("span",{className:"text-[7px] text-zinc-500 uppercase leading-none mb-0.5",children:"TIMER"}),c.jsxs("span",{className:`text-xs font-black leading-none ${N<10?"text-neon-red animate-pulse":"text-white"}`,children:[N,"s"]})]}),c.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-3 py-1 rounded-full flex flex-col items-end",children:[c.jsx("span",{className:"text-[7px] text-zinc-500 uppercase leading-none mb-0.5",children:"ROUND"}),c.jsxs("span",{className:"text-xs font-black leading-none text-white",children:[m,"/3"]})]}),c.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-3 py-1 rounded-full flex flex-col items-end",children:[c.jsx("span",{className:"text-[7px] text-zinc-500 uppercase leading-none mb-0.5",children:"MISS"}),c.jsx("span",{className:"text-xs font-black leading-none text-neon-red",children:M})]})]}),c.jsx("main",{className:"flex-1 grid grid-cols-4 gap-2 p-4 pt-8",children:d.map(e=>c.jsx(O,{data:e,onClick:$,ref:r=>{r&&H.current.set(e.id,r)}},e.id))}),c.jsx(X,{ref:k})]})};export{ee as default};
