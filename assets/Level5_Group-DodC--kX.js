import{r as n,a as p,j as o,H as B,b as V}from"./index-D4ccOMr0.js";import{g as $,P as J}from"./ParticleOverlay-DFPCy2WV.js";const X=({csvData:M,onComplete:j,levelIndex:k,onOpenSettings:h,isReviewing:i,onNext:z,hintsEnabled:v})=>{const[c,d]=n.useState([]),[K,y]=n.useState([]),[u,E]=n.useState(1),[I,R]=n.useState(0),[w,S]=n.useState(90),[f,H]=n.useState(!1),[F,W]=n.useState(0),[L,_]=n.useState([]),g=n.useRef(Date.now()),b=n.useRef(null),T=n.useRef(Date.now()),C=n.useRef(new Map);n.useEffect(()=>{const t=$(4,M,4),a=[];for(const s of t)s.words.slice(0,4).forEach(r=>{a.push({id:Math.random().toString(36).substr(2,9),word:r,categoryId:s.id,categoryName:s.name,status:"neutral"})});d(a.sort(()=>.5-Math.random())),S(Math.max(15,90-(u-1)*20)),g.current=Date.now()},[u,M]),n.useEffect(()=>{if(f||i)return;const t=setInterval(()=>{S(a=>a<=1?(clearInterval(t),A(),0):a-1)},1e3);return()=>clearInterval(t)},[f,i,u]),n.useEffect(()=>{if(f||i||!v)return;const t=setInterval(()=>{Date.now()-g.current>9e4&&D()},1e3);return()=>clearInterval(t)},[c,f,i,v]);const A=()=>{j({roundsWon:u-1,timeMs:Date.now()-T.current,moves:0,failed:!0,mistakes:I})},D=()=>{if(f||i)return;const t=c.filter(e=>e.status!=="solved");if(t.length<2)return;const a=t[0].categoryId,s=t.filter(e=>e.categoryId===a).slice(0,2);d(e=>e.map(r=>s.some(x=>x.id===r.id)?{...r,status:"correct-preview"}:r)),p.playTick(),W(e=>e+1),g.current=Date.now(),setTimeout(()=>{d(e=>e.map(r=>r.status==="correct-preview"?{...r,status:"neutral"}:r))},1500)},P=t=>{if(f||w===0||i)return;const a=c.find(s=>s.id===t);!a||a.status==="solved"||(p.playSelect(),y(s=>{const r=s.includes(t)?s.filter(m=>m!==t):[...s,t].slice(0,4),U=(m=>{if(m.length===3){const l=c.filter(N=>m.includes(N.id));return l.every(N=>N.categoryId===l[0].categoryId)}return!1})(r);return d(m=>m.map(l=>l.status==="solved"?l:r.includes(l.id)?{...l,status:U?"correct-preview":"selected"}:{...l,status:"neutral"})),r.length===4&&setTimeout(()=>q(r),400),r}))},q=t=>{const a=c.filter(s=>t.includes(s.id));if(a.every(s=>s.categoryId===a[0].categoryId)){p.playRowSolved(),g.current=Date.now();const s=a[0].categoryId;_(e=>Array.from(new Set([...e,s]))),d(e=>e.map(r=>t.includes(r.id)?{...r,status:"solved",color:"bg-neon-green shadow-[0_0_20px_#00FF66]"}:r)),t.forEach(e=>{var x;const r=(x=C.current.get(e))==null?void 0:x.getBoundingClientRect();r&&b.current&&b.current.explode(r.left+r.width/2,r.top+r.height/2,"#00FF66")}),y([]),c.filter(e=>e.status!=="solved").length===4&&(u===3?(p.playWin(),H(!0),setTimeout(()=>j({roundsWon:3,timeMs:Date.now()-T.current,moves:12,hintsUsedCount:F,mistakes:I,solvedCategoryIds:L}),1e3)):E(e=>e+1))}else p.playError(),R(s=>s+1),d(s=>s.map(e=>t.includes(e.id)?{...e,status:"wrong"}:e)),setTimeout(()=>{d(s=>s.map(e=>e.status==="wrong"?{...e,status:"neutral"}:e)),y([])},500)},G=n.useMemo(()=>{const t=new Map;return c.forEach(a=>t.set(a.categoryName,a.status==="solved")),Array.from(t.entries()).map(([a,s])=>({name:a,isSolved:s}))},[c]);return o.jsxs("div",{className:"flex flex-col h-full w-full max-w-4xl mx-auto overflow-hidden relative bg-black",children:[o.jsxs(B,{modeName:"MIND MATCH",levelIndex:k,onOpenSettings:()=>h==null?void 0:h(G),isReviewing:i,onNext:z,hintsEnabled:v,onManualHint:D,children:[o.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-3 py-1 rounded-full flex flex-col items-end",children:[o.jsx("span",{className:"text-[7px] text-zinc-500 uppercase leading-none mb-0.5",children:"TIMER"}),o.jsxs("span",{className:`text-xs font-black leading-none ${w<10?"text-neon-red animate-pulse":"text-white"}`,children:[w,"s"]})]}),o.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-3 py-1 rounded-full flex flex-col items-end",children:[o.jsx("span",{className:"text-[7px] text-zinc-500 uppercase leading-none mb-0.5",children:"ROUND"}),o.jsxs("span",{className:"text-xs font-black leading-none text-white",children:[u,"/3"]})]}),o.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-3 py-1 rounded-full flex flex-col items-end",children:[o.jsx("span",{className:"text-[7px] text-zinc-500 uppercase leading-none mb-0.5",children:"MISS"}),o.jsx("span",{className:"text-xs font-black leading-none text-neon-red",children:I})]})]}),o.jsx("main",{className:"flex-1 grid grid-cols-4 gap-2 p-4 pt-8",children:c.map(t=>o.jsx(V,{data:t,onClick:P,ref:a=>{a&&C.current.set(t.id,a)}},t.id))}),o.jsx(J,{ref:b})]})};export{X as default};
