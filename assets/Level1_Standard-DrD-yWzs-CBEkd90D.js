import{l as r,G as X,w as R,Y as _e,F as Oe,U as v,a as q,f as n,v as Ae,P as O,u as Ye}from"./index-DZYk55dN.js";import{f as $e,y as Ve,h as Ge}from"./DebugMenu-BlYmMh_k-BePBMNzk.js";const Fe=({csvData:C,onComplete:pe,onExit:ge,mode:g,levelIndex:A,onThemeChange:Y,hintsEnabled:K,timeLimit:E,onOpenSettings:Q,debugMode:ve,onOpenAnimLab:Pe})=>{const[c,m]=r.useState([]),[$,I]=r.useState(null),[w,V]=r.useState(!0),[p,ee]=r.useState(!1),[we,G]=r.useState(!1),[be,te]=r.useState(""),[Ee,ye]=r.useState(!1),[y,Se]=r.useState(X[0]),[P,se]=r.useState(0),[le,M]=r.useState(!1),[k,ae]=r.useState(!1),[Ne,je]=r.useState(""),[re,We]=r.useState(0),[ne,z]=r.useState(!1),[W,oe]=r.useState(!1),[ie,ce]=r.useState(0),ue=r.useRef(Date.now()),[B,H]=r.useState([]),[S,de]=r.useState(!1),[Be,Le]=r.useState(!1),[He,fe]=r.useState(E||0),[N,he]=r.useState(!1),T=r.useRef(Date.now()),U=r.useRef(!1),me=r.useRef(-1),j=r.useRef(null),D=r.useRef(new Map),Z=r.useRef(null),Ce=r.useMemo(()=>{if(c.length===0)return[];const s=new Map;return c.forEach(t=>{if(!s.has(t.categoryId)){const l=c.filter(o=>o.categoryId===t.categoryId).every(o=>o.status==="solved"||o.status==="exiting");s.set(t.categoryId,{name:t.categoryName,isSolved:l})}}),Array.from(s.values()).sort((t,l)=>t.name.localeCompare(l.name))},[c]);r.useEffect(()=>{if(U.current&&c.length>0)return;if(!C||C.length===0){V(!0);return}const s=X[Math.floor(Math.random()*X.length)];Se(s),Y&&Y(s.solvedColors);let t=[];if(g===R.LEVEL_4_THEMED){const a=_e(20,C);t=a.categories,te(a.name)}else t=Oe(30,C),te("");if(t.length===0){ye(!0),V(!1);return}const l=[],o=new Set,u=[];for(const a of t){if(u.length>=7)break;const i=a.words.filter(e=>!o.has(e));i.length>=4&&([...i].sort(()=>.5-Math.random()).slice(0,4).forEach(e=>{o.add(e),l.push({id:Math.random().toString(36).substr(2,9),word:e,categoryId:a.id,categoryName:a.name.includes(":")?a.name.split(":")[1].trim():a.name,status:"neutral"})}),u.push(a))}m(l.sort(()=>.5-Math.random())),H([]),ee(!1),G(!1),ae(!1),V(!1),se(0),M(!1),Le(!1),he(!1),z(!1),oe(!1),ce(0),g===R.LEVEL_RHYMES?de(!0):de(!1),E&&fe(E),T.current=Date.now(),ue.current=Date.now(),U.current=!0},[C,g,A,E,re,Y]),r.useEffect(()=>{U.current=!1},[A,g,re]),r.useEffect(()=>{if(!E||p||k||N||w||S){j.current&&clearInterval(j.current);return}return j.current=setInterval(()=>{fe(s=>s<=1?(clearInterval(j.current),he(!0),v.playError(),0):s-1)},1e3),()=>{j.current&&clearInterval(j.current)}},[E,p,k,N,w,S]),r.useEffect(()=>{if(!K||p||k||w||P>=1||N||S)return;const s=setInterval(()=>{Date.now()-T.current>9e4&&!le&&M(!0)},5e3);return()=>clearInterval(s)},[K,p,k,w,P,le,N,S]),r.useEffect(()=>{if(p){const s=Date.now()-ue.current;q({levelsCompleted:1,totalTimeMs:s,totalMoves:ie});const t=setTimeout(()=>{G(!0)},800);return()=>clearTimeout(t)}else G(!1)},[p,ie]);const F=s=>{H(t=>[...t,JSON.parse(JSON.stringify(s))].slice(-10))},Ie=(s,t)=>{if(!Z.current)return;const l=Ae(t);s.forEach(o=>{var u;const a=D.current.get(o);if(a){const i=a.getBoundingClientRect(),e=i.left+i.width/2,d=i.top+i.height/2;(u=Z.current)==null||u.explode(e,d,l)}})},_=r.useCallback(s=>{var t,l;if(w)return;const o=4,u=s.length/o;let a=0;const i=[...s];let e=!1;for(let d=0;d<u;d++){const x=d*o,f=i.slice(x,x+o);if(!f[0]||((t=f[0])==null?void 0:t.status)==="solved"){((l=f[0])==null?void 0:l.status)==="solved"&&a++;continue}const h=f[0].categoryId;if(f.every(b=>b&&b.categoryId===h)){e=!0,a++,v.playRowSolved(),q({rowsSolved:1,solvedCategoryIds:[h]});const b=y.solvedColors[d%y.solvedColors.length],De=f.map(L=>L.id);Ie(De,b);for(let L=x;L<x+o;L++)i[L]={...i[L],status:"solved",color:b}}}e&&(m(i),T.current=Date.now(),M(!1)),a===u&&u>0&&!p&&(v.playWin(),ee(!0))},[p,y,w]),Me=s=>{if(!(p||k||N||S||ne||W||!c.find(t=>t.id===s)))if(T.current=Date.now(),M(!1),$===null)v.playSelect(),I(s),m(t=>t.map(l=>l.id===s?{...l,status:"selected"}:l));else if($===s)v.playSelect(),I(null),m(t=>t.map(l=>l.id===s?{...l,status:"neutral"}:l));else{const t=c.findIndex(e=>e.id===$),l=c.findIndex(e=>e.id===s);if(t===-1||l===-1){I(null);return}F(c),ce(e=>e+1);const o=c[t].id,u=c[l].id,a=D.current.get(o),i=D.current.get(u);if(z(!0),a&&i){v.playSwap();const e=a.getBoundingClientRect(),d=i.getBoundingClientRect(),x=d.left-e.left,f=d.top-e.top;a.style.transition="transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",a.style.transform=`translate(${x}px, ${f}px) scale(1.15)`,i.style.transition="transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",i.style.transform=`translate(${-x}px, ${-f}px) scale(0.95)`,setTimeout(()=>{a&&(a.style.transition="",a.style.transform=""),i&&(i.style.transition="",i.style.transform="");const h=[...c],b=h[t];h[t]={...h[l],status:"neutral"},h[l]={...b,status:"neutral"},m(h),I(null),z(!1),_(h)},300)}else{const e=[...c],d=e[t];e[t]=e[l],e[l]=d,m(e),I(null),z(!1),_(e)}}},ke=(s=!1)=>{if(!s&&(P>=1||N||S||ne))return;T.current=Date.now(),M(!1);const t=c.filter(e=>e.status!=="solved").map(e=>e.categoryId),l={};t.forEach(e=>l[e]=(l[e]||0)+1);const o=Object.keys(l).find(e=>l[e]>=4);if(!o)return;const u=Math.floor(c.findIndex(e=>e.status!=="solved")/4);F(c);const a=[...c],i=c.filter(e=>e.categoryId===o&&e.status!=="solved").map(e=>e.id);for(let e=0;e<4;e++){const d=u*4+e,x=a.findIndex(h=>h.id===i[e]),f=a[d];a[d]=a[x],a[x]=f}m(a),v.playRowSolved(),s||(se(e=>e+1),q({hintsUsed:1})),setTimeout(()=>_(a),200)},xe=()=>{ae(!0);let s=Math.floor(Math.random()*O.length);for(;s===me.current&&O.length>1;)s=Math.floor(Math.random()*O.length);me.current=s,je(O[s]),m(t=>t.map(l=>({...l,status:"exiting"}))),setTimeout(()=>{pe()},500)},Te=()=>{F(c);const s=new Map;c.forEach(l=>{const o=s.get(l.categoryId)||[];o.push(l),s.set(l.categoryId,o)});const t=[];Array.from(s.values()).forEach((l,o)=>{const u=y.solvedColors[o%y.solvedColors.length];l.forEach(a=>{t.push({...a,status:"solved",color:u})})}),m(t),setTimeout(()=>_(t),100)},Re=()=>{if(B.length>0){const s=B[B.length-1];m(s),H(t=>t.slice(0,-1)),v.playSelect()}};if(Ee)return n.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] text-white animate-fade-in",children:[n.jsx("p",{className:"mb-4 text-red-400 font-righteous text-xl",children:"COULD NOT GENERATE LEVEL CONTENT."}),n.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-white text-black font-bold rounded-full",children:"RETRY"})]});if(w)return n.jsx("div",{className:"text-white text-center mt-20 animate-pulse font-righteous",children:"LOADING LEVEL..."});const ze=()=>{const s=[],t=c.length/4;for(let l=0;l<t;l++){const o=l*4,u=c.slice(o,o+4);if(!u[0])continue;const a=u.every(e=>(e==null?void 0:e.status)==="solved"||(e==null?void 0:e.status)==="exiting"),i=a&&u[0].color?u[0].color.split(" ")[0]:"bg-zinc-800";s.push(n.jsx("div",{className:"w-full relative z-10 flex-1 flex flex-col justify-center min-h-0",children:n.jsxs("div",{className:"relative w-full h-full p-1",children:[a&&n.jsx("div",{className:"absolute inset-0 z-0 animate-fade-in bg-black border-4 border-white rounded-medium"}),a&&n.jsx("div",{className:"absolute top-0 left-8 z-[100] transform",style:{transform:"translateY(calc(-100% + 4px))"},children:n.jsx("div",{className:`animate-pop px-4 py-1 rounded-t-lg text-[10px] md:text-xs font-bold uppercase tracking-widest leading-tight border-x-4 border-t-4 border-b-0 border-white shadow-[0_-12px_24px_rgba(0,0,0,0.8)] font-oswald text-white drop-shadow-[0_2px_4px_rgba(0,0,0,1)] ${i}`,children:u[0].categoryName})}),n.jsx("div",{className:`grid grid-cols-4 gap-1.5 w-full h-full relative z-10 transition-all duration-300 ${a?"p-3 drop-shadow-xl":""}`,children:u.map(e=>n.jsx("div",{className:"relative w-full h-full",children:n.jsx(Ye,{data:e,"data-tile-id":e.id,onClick:d=>Me(d),gradientClass:y.gradient,exitAnimation:Ne,ref:d=>{d&&D.current.set(e.id,d)}})},e.id))})]})},l))}return s};let J=g===R.LEVEL_4_THEMED?be:g.replace(/_/g," ").replace("LEVEL 1 ","").replace("LEVEL ","");return g===R.CLASSIC&&(J="CLASSIC"),g===R.LEVEL_SYNONYMS&&(J="SYNONYMS"),n.jsxs("div",{className:"flex flex-col items-center w-full max-w-4xl mx-auto h-full px-2 relative select-none overflow-hidden pb-1",children:[n.jsx($e,{ref:Z}),ve&&n.jsx(Ve,{onMainMenu:ge,onSolveOne:()=>ke(!0),onSolvePuzzle:Te,onUndo:Re}),we&&!W&&n.jsx("div",{className:"absolute inset-0 z-[100] flex items-center justify-center animate-fade-in bg-black/80 backdrop-blur-sm",children:n.jsxs("div",{className:"relative z-10 flex flex-col items-center min-w-[300px] text-center animate-celebrate",children:[n.jsx(Ge,{onClick:xe,levelIndex:A}),n.jsx("div",{onClick:()=>oe(!0),className:"mt-4 text-white font-oswald uppercase tracking-widest text-sm hover:text-cyan-400 cursor-pointer animate-pulse transition-colors uppercase",children:"TAP HERE TO REVIEW SOLVED PUZZLE"})]})}),n.jsx("div",{className:"relative flex flex-col justify-center w-full items-end mb-1 py-1 shrink-0 z-[60] h-auto min-h-[40px] pr-4",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("h2",{className:"text-right pointer-events-none text-2xl font-bold tracking-widest text-deco-gold uppercase font-righteous drop-shadow-md",children:J}),W?n.jsx("button",{onClick:xe,className:"px-3 py-1 bg-neon-green text-black font-bold font-oswald uppercase rounded shadow-lg animate-pulse hover:scale-105 transition-transform uppercase",children:"NEXT LEVEL >>"}):n.jsx("button",{onClick:()=>Q==null?void 0:Q(Ce),className:"p-1 rounded-full bg-zinc-800 border border-zinc-600 hover:bg-zinc-700 hover:border-white transition-all text-zinc-300 hover:text-white active:animate-spin",children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.592c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a7.75 7.75 0 0 1 0 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 0 1 0-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281Z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})}),n.jsx("div",{className:"w-full flex-1 flex flex-col animate-fade-in gap-1",children:ze()})]})};export{Fe as default};
