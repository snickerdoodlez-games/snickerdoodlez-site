import{r as a,a as v,j as l,H as X,b as Y}from"./index-BPfo5Flo.js";import{g as Z,P as ee}from"./ParticleOverlay-Bo7U_dWq.js";const re=({csvData:D,onComplete:w,levelIndex:q,onOpenSettings:T,isReviewing:d,onNext:G,hintsEnabled:m,setHintsEnabled:M})=>{const[i,x]=a.useState([]),[N,g]=a.useState([]),[p,H]=a.useState(1),[y,U]=a.useState(0),[S,R]=a.useState(0),[I,B]=a.useState(0),[k,z]=a.useState(90),[f,W]=a.useState(!1),[F,E]=a.useState(0),[j,V]=a.useState([]),h=a.useRef(Date.now()),C=a.useRef(null),L=a.useRef(Date.now()),_=a.useRef(new Map);a.useEffect(()=>{g([]),m&&(h.current=Date.now())},[m]),a.useEffect(()=>{if(d||f)return;const e=Z(4,D,4),r=[];for(const n of e)n.words.slice(0,4).forEach(o=>{r.push({id:Math.random().toString(36).substr(2,9),word:o,categoryId:n.id,categoryName:n.name,status:"neutral"})});x(r.sort(()=>.5-Math.random())),g([]),R(0),z(Math.max(15,90-(p-1)*20)),h.current=Date.now()},[p,D,d]),a.useEffect(()=>{if(f||d)return;const e=setInterval(()=>{z(r=>r<=1?(clearInterval(e),$(),0):r-1)},1e3);return()=>clearInterval(e)},[f,d,p]),a.useEffect(()=>{if(f||d||!m)return;const e=setInterval(()=>{Date.now()-h.current>9e4&&J()},1e3);return()=>clearInterval(e)},[i,f,d,m]);const $=()=>{f||(W(!0),w({roundsWon:I,timeMs:Date.now()-L.current,moves:12,failed:!0,mistakes:y}))},J=()=>{if(f||d||!m)return;const e=i.filter(t=>t.status!=="solved");if(e.length<2)return;const r=e[0].categoryId,n=e.filter(t=>t.categoryId===r).slice(0,2);x(t=>t.map(o=>n.some(u=>u.id===o.id)?{...o,status:"correct-preview"}:o)),v.playTick(),E(t=>t+1),h.current=Date.now(),setTimeout(()=>{x(t=>t.map(o=>o.status==="correct-preview"?{...o,status:"neutral"}:o))},1500)},A=a.useCallback((e,r,n)=>{v.playWin(),W(!0),w({roundsWon:e,timeMs:Date.now()-L.current,moves:12,hintsUsedCount:F,mistakes:r,solvedCategoryIds:n})},[w,F]),b=a.useCallback((e,r,n)=>{p>=3?A(e,r,n):setTimeout(()=>H(t=>t+1),600)},[p,A]),K=a.useCallback((e,r)=>{const n=r.filter(t=>e.includes(t.id));if(n.length===4&&n.every(t=>t.categoryId===n[0].categoryId)){v.playRowSolved(),h.current=Date.now();const t=n[0].categoryId,o=Array.from(new Set([...j,t]));V(o);const u=r.map(s=>e.includes(s.id)?{...s,status:"solved",color:"bg-neon-green shadow-[0_0_20px_#00FF66]"}:s);if(x(u),g([]),e.forEach(s=>{var P;const c=(P=_.current.get(s))==null?void 0:P.getBoundingClientRect();c&&C.current&&C.current.explode(c.left+c.width/2,c.top+c.height/2,"#00FF66")}),u.every(s=>s.status==="solved")){const s=I+1;B(s),b(s,y,o)}}else if(e.length===4){v.playError();const t=y+1,o=S+1;U(t),R(o),x(u=>u.map(s=>e.includes(s.id)?{...s,status:"wrong"}:s)),setTimeout(()=>{o>=3?b(I,t,j):(x(u=>u.map(s=>s.status==="wrong"?{...s,status:"neutral"}:s)),g([]))},500)}},[p,S,y,j,b,I]),O=e=>{if(f||k===0||d)return;const r=i.find(s=>s.id===e);if(!r||r.status==="solved"||r.status==="wrong")return;v.playSelect();const t=N.includes(e)?N.filter(s=>s!==e):[...N,e].slice(0,4);g(t);const u=(()=>{if(t.length===3){const s=i.filter(c=>t.includes(c.id));return s.every(c=>c.categoryId===s[0].categoryId)}return!1})();x(s=>s.map(c=>c.status==="solved"?c:t.includes(c.id)?{...c,status:u?"correct-preview":"selected"}:{...c,status:"neutral"})),t.length===4&&setTimeout(()=>K(t,i),150)},Q=a.useMemo(()=>{const e=new Map;return i.forEach(r=>e.set(r.categoryName,r.status==="solved")),Array.from(e.entries()).map(([r,n])=>({name:r,isSolved:n}))},[i]);return l.jsxs("div",{className:"flex flex-col h-full w-full max-w-4xl mx-auto overflow-hidden relative bg-black",children:[l.jsxs(X,{modeName:"MIND MATCH",levelIndex:q,onOpenSettings:()=>T==null?void 0:T(Q),isReviewing:d,onNext:G,hintsEnabled:m,onToggleHints:()=>M==null?void 0:M(!m),children:[l.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-3 py-1 rounded-full flex flex-col items-end",children:[l.jsx("span",{className:"text-[7px] text-zinc-500 uppercase leading-none mb-0.5",children:"TIMER"}),l.jsxs("span",{className:`text-xs font-black leading-none ${k<10?"text-neon-red animate-pulse":"text-white"}`,children:[k,"s"]})]}),l.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-3 py-1 rounded-full flex flex-col items-end",children:[l.jsx("span",{className:"text-[7px] text-zinc-500 uppercase leading-none mb-0.5",children:"ROUND"}),l.jsxs("span",{className:"text-xs font-black leading-none text-white",children:[p,"/3"]})]}),l.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-3 py-1 rounded-full flex flex-col items-end",children:[l.jsx("span",{className:"text-[7px] text-zinc-500 uppercase leading-none mb-0.5",children:"MISS"}),l.jsxs("span",{className:"text-xs font-black leading-none text-neon-red",children:[S,"/3"]})]})]}),l.jsx("main",{className:"flex-1 grid grid-cols-4 gap-2 p-4 pt-8",children:i.map(e=>l.jsx(Y,{data:e,onClick:O,ref:r=>{r&&_.current.set(e.id,r)}},e.id))}),l.jsx(ee,{ref:C})]})};export{re as default};
