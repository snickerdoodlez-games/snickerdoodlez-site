import{r as i,T as A,a as fe,u as Z,b as x,j as r,d as he,c as me,E as X}from"./index-CdL25Luv.js";import{P as xe,D as pe,N as ge}from"./DebugMenu-BlYmMh_k.js";const Se=({csvData:y,onComplete:F,onExit:G,levelIndex:L,onThemeChange:N,hintsEnabled:ve,onOpenSettings:j,debugMode:Y})=>{const[c,m]=i.useState([]),[I,T]=i.useState(null),[q,J]=i.useState(!0),[w,E]=i.useState(!1),[K,W]=i.useState(!1),[p,Q]=i.useState(A[0]),[we,ee]=i.useState(0),[be,te]=i.useState(!1),[se,P]=i.useState(!1),[oe,ae]=i.useState(""),[ne,k]=i.useState(!1),[M,_]=i.useState(!1),[B,D]=i.useState(0),H=i.useRef(Date.now()),[R,S]=i.useState([]),U=i.useRef(Date.now()),$=i.useRef(!1),C=i.useRef(new Map),z=i.useRef(null),le=i.useMemo(()=>{if(c.length===0)return[];const o=new Map;return c.forEach(a=>{if(!o.has(a.categoryId)){const t=c.filter(n=>n.categoryId===a.categoryId).every(n=>n.status==="solved"||n.status==="exiting");o.set(a.categoryId,{name:a.categoryName,isSolved:t})}}),Array.from(o.values()).sort((a,e)=>a.name.localeCompare(e.name))},[c]);i.useEffect(()=>{if($.current||!y||y.length===0)return;const o=A[Math.floor(Math.random()*A.length)];Q(o),N&&N(o.solvedColors);const a=fe(15,y),e=[],t=new Set,n=[];for(const l of a){if(n.length>=7)break;const s=l.words.filter(f=>!t.has(f));s.length>=4&&([...s].sort(()=>.5-Math.random()).slice(0,4).forEach(d=>{t.add(d),e.push({id:Math.random().toString(36).substr(2,9),word:d,categoryId:l.id,categoryName:l.name.toUpperCase(),status:"neutral"})}),n.push(l))}m(e.sort(()=>.5-Math.random())),S([]),E(!1),W(!1),P(!1),J(!1),ee(0),te(!1),k(!1),_(!1),D(0),U.current=Date.now(),H.current=Date.now(),$.current=!0},[y,L,N]),i.useEffect(()=>{if(w){const o=Date.now()-H.current;Z({levelsCompleted:1,totalTimeMs:o,totalMoves:B}),setTimeout(()=>W(!0),800)}},[w,B]);const re=(o,a)=>{if(!z.current)return;const e=me(a);o.forEach(t=>{var l;const n=C.current.get(t);if(n){const s=n.getBoundingClientRect(),f=s.left+s.width/2,d=s.top+s.height/2;(l=z.current)==null||l.explode(f,d,e)}})},O=i.useCallback(o=>{var s,f;const e=o.length/4;let t=0;const n=[...o];let l=!1;for(let d=0;d<e;d++){const h=d*4,u=n.slice(h,h+4);if(!u[0]||((s=u[0])==null?void 0:s.status)==="solved"){((f=u[0])==null?void 0:f.status)==="solved"&&t++;continue}const g=u[0].categoryId;if(u.every(b=>b&&b.categoryId===g)){l=!0,t++,x.playRowSolved(),Z({rowsSolved:1,solvedCategoryIds:[g]});const b=p.solvedColors[d%p.solvedColors.length];re(u.map(v=>v.id),b);for(let v=h;v<h+4;v++)n[v]={...n[v],status:"solved",color:b}}}l&&m(n),t===e&&e>0&&!w&&(x.playWin(),E(!0))},[w,p]),ie=o=>{if(w||se||ne||M)return;const a=c.find(e=>e.id===o);if(!(!a||a.status==="solved"))if(U.current=Date.now(),I===null)x.playSelect(),T(o),m(e=>e.map(t=>t.id===o?{...t,status:"selected"}:t));else if(I===o)x.playSelect(),T(null),m(e=>e.map(t=>t.id===o?{...t,status:"neutral"}:t));else{const e=c.findIndex(s=>s.id===I),t=c.findIndex(s=>s.id===o);S(s=>[...s,c]),D(s=>s+1),k(!0),x.playSwap();const n=C.current.get(I),l=C.current.get(o);if(n&&l){const s=n.getBoundingClientRect(),f=l.getBoundingClientRect(),d=f.left-s.left,h=f.top-s.top;n.style.transition="transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",n.style.transform=`translate(${d}px, ${h}px) scale(1.1)`,l.style.transition="transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",l.style.transform=`translate(${-d}px, ${-h}px) scale(0.9)`,setTimeout(()=>{n.style.transform="",l.style.transform="";const u=[...c],g=u[e];u[e]={...u[t],status:"neutral"},u[t]={...g,status:"neutral"},m(u),T(null),k(!1),O(u)},300)}}},V=()=>{P(!0);const o=X[Math.floor(Math.random()*X.length)];ae(o),m(a=>a.map(e=>({...e,status:"exiting"}))),setTimeout(()=>{F()},500)},ce=()=>{const o=c.filter(s=>s.status==="neutral");if(o.length<4)return;const a=o[0].categoryId,e=[...c],t=Math.floor(c.findIndex(s=>s.status!=="solved")/4),n=[t*4,t*4+1,t*4+2,t*4+3];c.filter(s=>s.categoryId===a).map(s=>s.id).forEach((s,f)=>{const d=e.findIndex(g=>g.id===s),h=n[f],u=e[h];e[h]=e[d],e[h]=e[d],e[d]=u}),m(e),O(e)},de=()=>{S(e=>[...e,c]);const o=new Map;c.forEach(e=>{const t=o.get(e.categoryId)||[];t.push(e),o.set(e.categoryId,t)});const a=[];Array.from(o.values()).forEach((e,t)=>{const n=p.solvedColors[t%p.solvedColors.length];e.forEach(l=>{a.push({...l,status:"solved",color:n})})}),m(a),E(!0),x.playWin()},ue=()=>{if(R.length>0){const o=R[R.length-1];m(o),S(a=>a.slice(0,-1)),x.playSelect()}};return q?r.jsx("div",{className:"text-white text-center mt-20 animate-pulse font-righteous",children:"LOADING TRANSLATIONS..."}):r.jsxs("div",{className:"flex flex-col items-center w-full max-w-4xl mx-auto h-full px-2 relative select-none overflow-hidden pb-1",children:[r.jsx(xe,{ref:z}),Y&&r.jsx(pe,{onMainMenu:G,onSolveOne:ce,onSolvePuzzle:de,onUndo:ue}),K&&!M&&r.jsx("div",{className:"absolute inset-0 z-[250] flex items-center justify-center animate-fade-in bg-black/80 backdrop-blur-sm",children:r.jsxs("div",{className:"relative z-10 flex flex-col items-center min-w-[300px] text-center animate-celebrate",children:[r.jsx(ge,{onClick:V,levelIndex:L}),r.jsx("div",{onClick:()=>_(!0),className:"mt-4 text-white font-oswald uppercase tracking-widest text-sm hover:text-cyan-400 cursor-pointer animate-pulse transition-colors uppercase",children:"TAP HERE TO REVIEW SOLVED PUZZLE"})]})}),r.jsx("div",{className:"relative flex flex-col justify-center w-full items-end mb-1 py-1 shrink-0 z-[60] h-auto min-h-[40px] pr-4",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("h2",{className:"text-right pointer-events-none text-2xl font-bold tracking-widest text-deco-gold uppercase font-righteous drop-shadow-md",children:"TRANSLATION"}),M?r.jsx("button",{onClick:V,className:"px-3 py-1 bg-neon-green text-black font-bold font-oswald uppercase rounded shadow-lg animate-pulse hover:scale-105 transition-transform uppercase",children:"NEXT LEVEL >>"}):r.jsx("button",{onClick:()=>j==null?void 0:j(le),className:"p-1 rounded-full bg-zinc-800 border border-zinc-600 hover:bg-zinc-700 hover:border-white transition-all text-zinc-300 hover:text-white active:animate-spin",children:r.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.592c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a7.75 7.75 0 0 1 0 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 0 1 0-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281Z"}),r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})}),r.jsx("div",{className:"w-full flex-1 flex flex-col gap-1",children:Array.from({length:c.length/4}).map((o,a)=>{const e=c.slice(a*4,a*4+4),t=e.every(l=>l.status==="solved"||l.status==="exiting"),n=t&&e[0].color?e[0].color.split(" ")[0]:"bg-zinc-800";return r.jsx("div",{className:"w-full relative flex-1 flex flex-col justify-center min-h-0",children:r.jsxs("div",{className:"relative w-full h-full p-1",children:[t&&r.jsx("div",{className:"absolute inset-0 z-0 animate-fade-in bg-black border-4 border-white rounded-medium"}),t&&r.jsx("div",{className:"absolute top-0 left-8 z-[100] transform",style:{transform:"translateY(calc(-100% + 4px))"},children:r.jsx("div",{className:`animate-pop px-4 py-1 rounded-t-lg text-[10px] md:text-xs font-bold uppercase tracking-widest leading-tight border-x-4 border-t-4 border-b-0 border-white shadow-[0_-12px_24px_rgba(0,0,0,0.8)] font-oswald text-white drop-shadow-[0_2px_4px_rgba(0,0,0,1)] ${n}`,children:e[0].categoryName})}),r.jsx("div",{className:`grid grid-cols-4 gap-1.5 w-full h-full relative z-10 transition-all duration-300 ${t?"p-3 drop-shadow-xl":""}`,children:e.map(l=>r.jsx("div",{className:"relative w-full h-full",children:r.jsx(he,{data:l,"data-tile-id":l.id,onClick:ie,gradientClass:p.gradient,exitAnimation:oe,ref:s=>{s&&C.current.set(l.id,s)}})},l.id))})]})},a)})})]})};export{Se as default};
