import{r as a,T as L,b as u,j as t,c as ae,a as ne,u as le}from"./index-B1BpELOr.js";import{P as oe}from"./ParticleOverlay-BxzBYbW3.js";const xe=({csvData:U,onComplete:J,onExit:ie,levelIndex:Q,onThemeChange:_,hintsEnabled:ce,debugMode:de,onOpenSettings:k,isStressTesting:v,diagnosticSpeed:$})=>{const[c,m]=a.useState([]),[I,b]=a.useState([]),[C,A]=a.useState([]),[h,D]=a.useState(!0),[d,p]=a.useState(!1),[W,G]=a.useState(!1),[g,Y]=a.useState(L[0]),[M,E]=a.useState(0),[f,N]=a.useState(!1),[x,R]=a.useState(1),O=90,[H,P]=a.useState(O),w=a.useRef(null),V=a.useRef(Date.now()),j=a.useRef(!0),ee=a.useRef(null),X=4,y=3,T=5;a.useEffect(()=>(u.resume(),j.current=!0,()=>{j.current=!1}),[]),a.useEffect(()=>{if(h||d||f){w.current&&clearInterval(w.current);return}return w.current=setInterval(()=>{j.current&&P(e=>e<=1?(te(),0):e-1)},1e3),()=>{w.current&&clearInterval(w.current)}},[h,d,f]),a.useEffect(()=>{if(!v||h||f)return;if(d){setTimeout(()=>z(),1500);return}if($==="instant"){setTimeout(()=>{x>=y?(p(!0),u.playWin()):(R(l=>l+1),S())},100);return}setTimeout(()=>{if(d||f)return;const r=c.find(l=>l.status!=="solved"&&l.status!=="selected");if(r){let l=r.categoryId;if(I.length>0){const s=c.find(i=>i.id===I[0]);s&&(l=s.categoryId)}const n=c.find(s=>s.categoryId===l&&s.status!=="solved"&&s.status!=="selected");n&&Z(n.id)}},600)},[v,d,h,c,$,x,f,I]);const te=()=>{u.playError(),E(T),p(!0)},S=(e=!1)=>{D(!0);const r=L[Math.floor(Math.random()*L.length)];Y(r),_&&_(r.solvedColors);const l=ne(40,U),n=[],s=new Set,i=[];for(const o of l){if(i.length>=X)break;const F=o.words.filter(K=>!s.has(K));F.length>=4&&([...F].sort(()=>.5-Math.random()).slice(0,4).forEach(q=>{s.add(q),n.push({id:Math.random().toString(36).substr(2,9),word:q,categoryId:o.id,categoryName:o.name.toUpperCase(),status:"neutral"})}),i.push(o))}m(n.sort(()=>.5-Math.random())),b([]),A([]),p(!1),G(!1),N(!1),P(O),D(!1),E(0),e&&(R(1),V.current=Date.now())};a.useEffect(()=>{S(!0)},[U]);const Z=e=>{if(h||d||f)return;const r=c.find(l=>l.id===e);!r||r.status==="solved"||(u.playSelect(),b(l=>{const s=l.includes(e)?l.filter(i=>i!==e):[...l,e].slice(0,4);return m(i=>i.map(o=>s.includes(o.id)?{...o,status:"selected"}:o.status==="solved"?o:{...o,status:"neutral"})),s.length===4&&setTimeout(()=>se(s),400),s}))},se=e=>{if(d)return;N(!0);const r=c.filter(n=>e.includes(n.id));if(r.every(n=>n.categoryId===r[0].categoryId)){u.playRowSolved();const n=g.solvedColors[C.length%g.solvedColors.length],s={id:Math.random().toString(36),tileIds:e,color:n,categoryName:r[0].categoryName};A(i=>[...i,s]),m(i=>i.map(o=>e.includes(o.id)?{...o,status:"solved",color:n}:o)),b([]),N(!1),le({rowsSolved:1,solvedCategoryIds:[r[0].categoryId]}),C.length+1===X&&(u.playWin(),p(!0))}else u.playError(),E(n=>{const s=n+1;return s>=T&&setTimeout(()=>p(!0),600),s}),m(n=>n.map(s=>e.includes(s.id)?{...s,status:"wrong"}:s)),setTimeout(()=>{j.current&&(m(n=>n.map(s=>s.status==="wrong"?{...s,status:"neutral"}:s)),b([]),N(!1))},1e3)},z=()=>{x<y?(R(e=>e+1),S()):J({mode:"MIND MATCH",mistakes:M,totalTimeMs:Date.now()-V.current})},re=a.useMemo(()=>{const e=new Map;return c.forEach(r=>e.set(r.categoryName,r.status==="solved")),Array.from(e.entries()).map(([r,l])=>({name:r,isSolved:l}))},[c]),B=a.useMemo(()=>{if(!g.solvedColors.length)return"from-zinc-800 to-zinc-900";const e=g.solvedColors.map(r=>r.split(" ")[0].replace("bg-",""));return e.length>=3?`from-${e[0]} via-${e[1]} to-${e[2]}`:`from-${e[0]} to-${e[e.length-1]}`},[g]);return t.jsxs("div",{className:"flex flex-col h-full w-full max-w-4xl mx-auto px-2 relative select-none overflow-hidden",children:[t.jsx(oe,{ref:ee}),t.jsxs("header",{className:"h-[12vh] flex items-center justify-between w-full shrink-0 z-[60] px-4",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("h2",{className:"text-xl font-black tracking-widest text-deco-gold uppercase font-oswald leading-none",children:"MIND MATCH"}),t.jsxs("span",{className:"text-[10px] opacity-70 font-oswald font-bold tracking-widest mt-1 uppercase",children:["LEVEL ",Q]})]}),t.jsxs("div",{className:"flex items-center gap-2 font-bold uppercase font-oswald text-[8px] md:text-[10px]",children:[t.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-2 py-1 rounded-full shadow-inner flex flex-col items-center",children:[t.jsx("span",{className:"text-zinc-500 text-[6px] leading-none mb-0.5",children:"TIME"}),t.jsxs("span",{className:H<=15?"text-red-500 animate-pulse":"text-white",children:[H,"s"]})]}),t.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-2 py-1 rounded-full shadow-inner flex flex-col items-center",children:[t.jsx("span",{className:"text-zinc-500 text-[6px] leading-none mb-0.5",children:"ERRORS"}),t.jsxs("span",{className:M>=T-1?"text-red-500":"text-white",children:[M,"/",T]})]}),t.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-2 py-1 rounded-full shadow-inner flex flex-col items-center",children:[t.jsx("span",{className:"text-zinc-500 text-[6px] leading-none mb-0.5",children:"ROUND"}),t.jsxs("span",{className:"text-white",children:[x,"/",y]})]})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[(W||d&&v)&&t.jsx("button",{onClick:z,className:`px-4 py-1.5 bg-gradient-to-r ${B} text-white font-black font-oswald text-xs rounded-full shadow-lg border-2 border-white animate-pop`,children:"NEXT"}),t.jsx("button",{onClick:()=>k==null?void 0:k(re),className:"p-2 rounded-full bg-zinc-800 border border-zinc-600 hover:border-white text-zinc-300 hover:text-white transition-all active:rotate-90",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})]}),t.jsx("div",{className:"flex-1 w-full flex flex-col py-1 overflow-hidden",children:t.jsx("div",{className:"w-full h-full grid grid-cols-4 grid-rows-4 gap-2",children:c.map(e=>t.jsx("div",{className:"relative w-full h-full",children:t.jsx(ae,{data:e,"data-tile-id":e.id,onClick:Z})},e.id))},`grid-round-${x}`)}),t.jsx("div",{className:"h-[10vh] w-full flex items-center justify-center pointer-events-none gap-2 px-2 overflow-x-auto no-scrollbar",children:C.map(e=>{const r=e.color?e.color.split(" ")[0].replace("bg-","text-"):"text-white";return t.jsx("div",{className:`animate-pop px-3 py-1 rounded-t-lg text-[9px] md:text-xs font-black uppercase tracking-widest border-x-2 border-t-2 border-white bg-black ${r} whitespace-nowrap`,children:e.categoryName},e.id)})}),d&&!W&&!v&&t.jsxs("div",{className:"absolute inset-0 z-[200] flex flex-col items-center justify-center next-puzzle-overlay animate-fade-in",children:[t.jsxs("div",{className:"flex flex-col items-center gap-2 mb-10",children:[t.jsx("span",{className:"text-white text-2xl font-bold tracking-[0.4em] uppercase opacity-50",children:"Round Success"}),t.jsx("div",{className:"w-32 h-1 bg-white rounded-full shadow-[0_0_15px_white]"})]}),t.jsx("button",{onClick:z,className:`px-12 py-6 rounded-full border-4 border-white bg-gradient-to-r ${B} text-white font-black font-oswald text-4xl shadow-2xl hover:scale-110 active:scale-95 transition-all uppercase tracking-[0.2em] animate-gradient-shift`,children:x===y?"NEXT PUZZLE":"NEXT ROUND"}),t.jsx("button",{onClick:()=>G(!0),className:"mt-8 text-deco-gold font-oswald font-black text-xl uppercase tracking-widest hover:text-white transition-colors animate-pulse",children:"CLICK TO REVIEW PUZZLE"})]})]})};export{xe as default};
