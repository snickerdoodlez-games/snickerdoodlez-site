import{r as o,T as Y,b as N,u as H,j as e,d as Se,c as ye,e as Ee}from"./index-CdL25Luv.js";import{P as Ce,D as Me,N as Ie}from"./DebugMenu-BlYmMh_k.js";const Ae=({csvData:g,onExit:le,onComplete:re,onGameOver:Re,levelIndex:Z,onThemeChange:G,hintsEnabled:J,debugMode:ae,onOpenAnimLab:ze,onOpenSettings:A})=>{const[n,ie]=o.useState(null),[w,x]=o.useState([]),[j,P]=o.useState(0),[O,ce]=o.useState(0),[k,y]=o.useState(!1),[X,q]=o.useState(null),[h,de]=o.useState(!1),[ue,fe]=o.useState(0),[xe,R]=o.useState(!1),[u,he]=o.useState(Y[0]),[T,E]=o.useState(0),[z,Q]=o.useState(21),[D,ee]=o.useState(0),[U,C]=o.useState(!1),[_,me]=o.useState(!1),[pe,we]=o.useState(0),te=o.useRef(Date.now()),[F,W]=o.useState([]),L=o.useRef(Date.now()),V=o.useRef(null),ve=o.useRef(null),se=6,$=5;o.useEffect(()=>{N.resume(),te.current=Date.now()},[]),o.useEffect(()=>{if(!J||h||k||D>=1)return;const t=setInterval(()=>{Date.now()-L.current>9e4&&!U&&C(!0)},5e3);return()=>clearInterval(t)},[J,h,k,D,U]),o.useEffect(()=>{if(k||h||!n||z<=0)return;const t=setInterval(()=>{Q(s=>s-1)},1e3);return()=>clearInterval(t)},[z,k,h,n]),o.useEffect(()=>{if(h){const t=Date.now()-te.current;H({levelsCompleted:1,totalTimeMs:t,totalMoves:pe})}},[h]);const B=()=>{W(t=>[...t.slice(-10),{tiles:JSON.parse(JSON.stringify(w)),mistakes:j,foundCount:T}])},ne=(t=!1)=>{if(h)return;const s=()=>{const l=Y[Math.floor(Math.random()*Y.length)];he(l),G&&G(l.solvedColors),E(0),ee(0),C(!1),W([]),L.current=Date.now();const i=Math.floor(Z/3),c=Math.max(10,21-O-i);Q(c);const m=g.filter(a=>a.words.length>=6);if(m.length===0){R(!0),t||y(!1);return}const v=m[Math.floor(Math.random()*m.length)];ie(v);const I=Ee(v,6),r=new Set(I),b=g.filter(a=>a.id!==v.id);let d=[],p=0;if(b.length>0)for(;d.length<14&&p<1e3;){p++;const a=b[Math.floor(Math.random()*b.length)];if(a&&a.words.length>0){const K=a.words[Math.floor(Math.random()*a.words.length)];r.has(K)||(d.push(K),r.add(K))}}for(;d.length<14;)d.push(`EXTRA-${d.length}`);const S=[...I.map(a=>({w:a,type:"correct"})),...d.map(a=>({w:a,type:"wrong"}))].sort(()=>.5-Math.random()).map(a=>({id:Math.random().toString(36).substr(2,9),word:a.w,categoryId:a.type==="correct"?v.id:"wrong",categoryName:a.type==="correct"?v.name:"UNKNOWN",status:"neutral"}));x(S),P(0),y(!1)};t?(q(null),R(!1),s()):(y(!0),q(null),R(!1),setTimeout(s,600))};o.useEffect(()=>{if(g&&g.length>0)ne(!0);else{const t=setTimeout(()=>{(!g||g.length===0)&&R(!0)},3e3);return()=>clearTimeout(t)}},[g]);const M=t=>{if(h)return;const s=O+1;ce(s),n&&H({rowsSolved:1,solvedCategoryIds:[n.id]}),s>=se?(N.playWin(),de(!0)):(t&&N.playRowSolved(),setTimeout(()=>ne(!1),1200))},ge=t=>{var v,I;if(k||h||_)return;L.current=Date.now(),C(!1);const s=document.querySelector(`[data-tile-id="${t}"]`);let l=0,i=0;if(s){const r=s.getBoundingClientRect();l=r.left+r.width/2,i=r.top+r.height/2}const c=w.findIndex(r=>r.id===t);if(c===-1)return;const m=w[c];if(m&&!(m.status!=="neutral"&&m.status!=="hint"))if(B(),we(r=>r+1),m.categoryId===(n==null?void 0:n.id)){N.playCorrect();const r=T+1;E(r);const b=(r-1)%u.solvedColors.length,d=u.solvedColors[b],p=ye(d);s&&((v=V.current)==null||v.explode(l,i,p));const f=[...w];f[c]={...m,status:"correct-preview",color:d},x(f),r===6&&M(j===0)}else{N.playError(),s&&((I=V.current)==null||I.explode(l,i,"#ef4444"));const r=[...w];r[c]={...m,status:"wrong"},x(r),P(b=>{const d=b+1;return fe(p=>p+1),d>=$?(y(!0),setTimeout(()=>{x(p=>{let f=T;return p.map(S=>{if(S.categoryId===(n==null?void 0:n.id)&&S.status!=="correct-preview"){f++;const a=(f-1)%u.solvedColors.length;return{...S,status:"correct-preview",color:u.solvedColors[a]}}return S})})},200),M(!1)):setTimeout(()=>{x(p=>p.map(f=>f.id===t&&f.status==="wrong"?{...f,status:"neutral"}:f))},800),d})}},be=()=>{if(D>=1||(L.current=Date.now(),C(!1),w.filter(l=>l.categoryId===(n==null?void 0:n.id)&&(l.status==="neutral"||l.status==="hint")).length===0))return;N.playRowSolved(),ee(l=>l+1),H({hintsUsed:1});let s=T;x(l=>l.map(i=>{if(i.categoryId===(n==null?void 0:n.id)&&(i.status==="neutral"||i.status==="hint")){s++;const c=(s-1)%u.solvedColors.length;return{...i,status:"correct-preview",color:u.solvedColors[c]}}return i})),E(s),setTimeout(()=>{M(j===0)},800)},Ne=()=>{C(!1),H({hintsRefused:1})},oe=()=>{y(!0),x(t=>t.map(s=>({...s,status:"exiting"}))),setTimeout(()=>{re({mode:"MIND MATCH",mistakes:ue})},500)},je=()=>{B();const t=w.find(s=>s.categoryId===(n==null?void 0:n.id)&&s.status==="neutral");if(t){const s=T+1;E(s);const l=(s-1)%u.solvedColors.length;x(i=>i.map(c=>c.id===t.id?{...c,status:"correct-preview",color:u.solvedColors[l]}:c)),s===6&&M(j===0)}},ke=()=>{B();let t=T;const s=w.map(l=>{if(l.categoryId===(n==null?void 0:n.id)&&l.status!=="correct-preview"){t++;const i=(t-1)%u.solvedColors.length;return{...l,status:"correct-preview",color:u.solvedColors[i]}}return l});x(s),setTimeout(()=>M(!0),500)},Te=()=>{if(F.length>0){const t=F[F.length-1];x(t.tiles),P(t.mistakes),E(t.foundCount),W(s=>s.slice(0,s.length-1)),N.playSelect()}};return xe?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] text-white animate-fade-in",children:[e.jsx("p",{className:"mb-4 text-red-400 font-righteous text-xl",children:"UNABLE TO GENERATE LEVEL DATA."}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-white text-black font-bold rounded-full",children:"RETRY"})]}):e.jsxs("div",{className:"flex flex-col items-center w-full max-w-4xl mx-auto h-full px-4 relative select-none overflow-hidden pb-1",children:[e.jsx(Ce,{ref:V}),ae&&e.jsx(Me,{onMainMenu:le,onSolveOne:je,onSolvePuzzle:ke,onUndo:Te}),U&&e.jsx("div",{className:"absolute inset-0 z-[90] flex items-center justify-center animate-fade-in bg-black/60",children:e.jsxs("div",{className:"bg-zinc-900 border-4 border-neon-blue rounded-2xl p-6 flex flex-col items-center gap-6 shadow-[0_0_40px_rgba(0,229,255,0.3)] animate-pop w-[90%] max-w-sm",children:[e.jsx("span",{className:"text-white font-black font-oswald text-2xl uppercase tracking-widest text-center drop-shadow-md",children:"NEED SOME HELP?"}),e.jsxs("div",{className:"flex gap-4 w-full",children:[e.jsx("button",{onClick:be,className:"flex-1 bg-neon-blue text-black hover:bg-white hover:scale-105 active:scale-95 transition-all py-3 rounded-xl font-black uppercase font-oswald text-xl shadow-lg",children:"YES"}),e.jsx("button",{onClick:Ne,className:"flex-1 bg-zinc-800 border-2 border-zinc-600 text-zinc-400 hover:text-white hover:border-white hover:bg-zinc-700 hover:scale-105 active:scale-95 transition-all py-3 rounded-xl font-bold uppercase font-oswald text-xl",children:"NO"})]})]})}),h&&!_&&e.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center animate-fade-in bg-black/80",children:e.jsxs("div",{className:"relative z-10 flex flex-col items-center min-w-[300px] text-center animate-celebrate",children:[e.jsx(Ie,{onClick:oe,levelIndex:Z}),e.jsx("div",{onClick:()=>me(!0),className:"mt-4 text-white font-oswald uppercase tracking-widest text-sm hover:text-cyan-400 cursor-pointer animate-pulse transition-colors uppercase",children:"TAP HERE TO REVIEW SOLVED PUZZLE"})]})}),e.jsxs("div",{className:"w-full mb-1 shrink-0 flex flex-col items-end gap-1 py-1 h-auto relative pr-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-2xl md:text-4xl font-black text-deco-gold font-righteous uppercase tracking-widest text-right drop-shadow-md leading-none",children:"MIND MATCH"}),_?e.jsx("button",{onClick:oe,className:"px-3 py-1 bg-neon-green text-black font-bold font-oswald uppercase rounded shadow-lg animate-pulse hover:scale-105 transition-transform uppercase",children:"NEXT LEVEL >>"}):e.jsx("button",{onClick:()=>A==null?void 0:A([{name:(n==null?void 0:n.name)||"",isSolved:!1}]),className:"p-1 rounded-full bg-zinc-800 border border-zinc-600 hover:bg-zinc-700 hover:border-white transition-all text-zinc-300 hover:text-white active:animate-spin",title:"Settings",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.592c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a7.75 7.75 0 0 1 0 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 0 1 0-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]}),e.jsx("div",{className:"flex w-full items-center justify-end pl-2",children:e.jsxs("div",{className:"flex items-center gap-1.5 mt-1 justify-end flex-wrap max-w-full",children:[e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-2 py-0.5 rounded-full flex items-center shadow-sm whitespace-nowrap",children:[e.jsx("span",{className:"text-zinc-500 font-oswald text-[9px] mr-1.5 tracking-wider uppercase",children:"TIMER"}),e.jsxs("span",{className:`font-bold font-oswald text-xs ${z<10?"text-red-500 animate-pulse":"text-white"}`,children:["00:",z.toString().padStart(2,"0")]})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-2 py-0.5 rounded-full flex items-center shadow-sm whitespace-nowrap",children:[e.jsx("span",{className:"text-zinc-500 font-oswald text-[9px] mr-1.5 tracking-wider uppercase",children:"MISTAKES"}),e.jsxs("span",{className:`font-bold font-oswald text-xs ${j>=$-1?"text-red-500":"text-white"}`,children:[j,"/",$]})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-2 py-0.5 rounded-full flex items-center shadow-sm whitespace-nowrap",children:[e.jsx("span",{className:"text-zinc-500 font-oswald text-[9px] mr-1.5 tracking-wider uppercase",children:"ROUND"}),e.jsxs("span",{className:"text-white font-bold font-oswald text-xs",children:[O+1,"/",se]})]})]})})]}),e.jsxs("div",{className:"relative w-full flex-1 flex flex-col py-1 min-h-0",ref:ve,children:[X&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20 pointer-events-none animate-pop",children:e.jsx("div",{className:"bg-black/80 px-12 py-4 rounded-xl border border-white text-white font-black text-2xl tracking-widest shadow-2xl font-oswald uppercase",children:X})}),e.jsx("div",{className:`w-full flex-1 grid grid-cols-4 sm:grid-cols-5 grid-rows-5 sm:grid-rows-4 gap-1.5 transition-all duration-500 transform ${k?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:w.map(t=>e.jsx("div",{className:"relative h-full",children:e.jsx(Se,{data:t,"data-tile-id":t.id,onClick:ge,gradientClass:u.gradient})},t.id))})]}),e.jsx("div",{className:"w-full flex-shrink-0 flex items-center justify-center z-[70] min-h-[50px] pointer-events-none py-2",children:n&&e.jsx("div",{className:"animate-pop bg-black text-white px-6 py-2 rounded-t-xl text-lg md:text-xl font-black uppercase tracking-[0.2em] leading-tight border-x-4 border-t-4 border-b-0 border-white shadow-[0_-12px_24px_rgba(0,0,0,0.8)] font-oswald drop-shadow-md",children:n.name})})]})};export{Ae as default};
