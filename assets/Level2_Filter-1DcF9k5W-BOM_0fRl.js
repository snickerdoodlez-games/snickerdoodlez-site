import{l,G as H,U as N,a as L,f as e,u as ke,v as Se,K as Ee}from"./index-DZYk55dN.js";import{f as Ce,y as Te,h as ze}from"./DebugMenu-BlYmMh_k-BePBMNzk.js";const Le=({csvData:g,onExit:ne,onComplete:ae,onGameOver:Me,levelIndex:G,onThemeChange:X,hintsEnabled:q,debugMode:re,onOpenAnimLab:Ie,onOpenSettings:Y})=>{const[a,oe]=l.useState(null),[m,x]=l.useState([]),[y,O]=l.useState(0),[A,ie]=l.useState(0),[k,E]=l.useState(!1),[Z,F]=l.useState(null),[f,ce]=l.useState(!1),[de,ue]=l.useState(0),[xe,I]=l.useState(!1),[u,fe]=l.useState(H[0]),[S,C]=l.useState(0),[R,J]=l.useState(21),[U,Q]=l.useState(0),[$,T]=l.useState(!1),[_,he]=l.useState(!1),[pe,me]=l.useState(0),ee=l.useRef(Date.now()),[W,K]=l.useState([]),D=l.useRef(Date.now()),P=l.useRef(null),we=l.useRef(null),te=6,V=5;l.useEffect(()=>{N.resume(),ee.current=Date.now()},[]),l.useEffect(()=>{if(!q||f||k||U>=1)return;const t=setInterval(()=>{Date.now()-D.current>9e4&&!$&&T(!0)},5e3);return()=>clearInterval(t)},[q,f,k,U,$]),l.useEffect(()=>{if(k||f||!a||R<=0)return;const t=setInterval(()=>{J(s=>s-1)},1e3);return()=>clearInterval(t)},[R,k,f,a]),l.useEffect(()=>{if(f){const t=Date.now()-ee.current;L({levelsCompleted:1,totalTimeMs:t,totalMoves:pe})}},[f]);const B=()=>{K(t=>[...t.slice(-10),{tiles:JSON.parse(JSON.stringify(m)),mistakes:y,foundCount:S}])},se=(t=!1)=>{if(f)return;const s=()=>{const r=H[Math.floor(Math.random()*H.length)];fe(r),X&&X(r.solvedColors),C(0),Q(0),T(!1),K([]),D.current=Date.now();const i=Math.floor(G/3),w=Math.max(10,21-A-i);J(w);const b=g.filter(n=>n.words.length>=6);if(b.length===0){I(!0),t||E(!1);return}const h=b[Math.floor(Math.random()*b.length)];oe(h);const v=Ee(h,6),o=new Set(v),j=g.filter(n=>n.id!==h.id);let c=[],p=0;if(j.length>0)for(;c.length<14&&p<1e3;){p++;const n=j[Math.floor(Math.random()*j.length)];if(n&&n.words.length>0){const M=n.words[Math.floor(Math.random()*n.words.length)];o.has(M)||(c.push(M),o.add(M))}}for(;c.length<14;)c.push(`EXTRA-${c.length}`);const d=[...v.map(n=>({w:n,type:"correct"})),...c.map(n=>({w:n,type:"wrong"}))].sort(()=>.5-Math.random()).map(n=>({id:Math.random().toString(36).substr(2,9),word:n.w,categoryId:n.type==="correct"?h.id:"wrong",categoryName:n.type==="correct"?h.name:"UNKNOWN",status:"neutral"}));x(d),O(0),E(!1)};t?(F(null),I(!1),s()):(E(!0),F(null),I(!1),setTimeout(s,600))};l.useEffect(()=>{if(g&&g.length>0)se(!0);else{const t=setTimeout(()=>{(!g||g.length===0)&&I(!0)},3e3);return()=>clearTimeout(t)}},[g]);const z=t=>{if(f)return;const s=A+1;ie(s),a&&L({rowsSolved:1,solvedCategoryIds:[a.id]}),s>=te?(N.playWin(),ce(!0)):(t&&N.playRowSolved(),setTimeout(()=>se(!1),1200))},ve=t=>{var s,r;if(k||f||_)return;D.current=Date.now(),T(!1);const i=document.querySelector(`[data-tile-id="${t}"]`);let w=0,b=0;if(i){const o=i.getBoundingClientRect();w=o.left+o.width/2,b=o.top+o.height/2}const h=m.findIndex(o=>o.id===t);if(h===-1)return;const v=m[h];if(v&&!(v.status!=="neutral"&&v.status!=="hint"))if(B(),me(o=>o+1),v.categoryId===(a==null?void 0:a.id)){N.playCorrect();const o=S+1;C(o);const j=(o-1)%u.solvedColors.length,c=u.solvedColors[j],p=Se(c);i&&((s=P.current)==null||s.explode(w,b,p));const d=[...m];d[h]={...v,status:"correct-preview",color:c},x(d),o===6&&z(y===0)}else{N.playError(),i&&((r=P.current)==null||r.explode(w,b,"#ef4444"));const o=[...m];o[h]={...v,status:"wrong"},x(o),O(j=>{const c=j+1;return ue(p=>p+1),c>=V?(E(!0),setTimeout(()=>{x(p=>{let d=S;return p.map(n=>{if(n.categoryId===(a==null?void 0:a.id)&&n.status!=="correct-preview"){d++;const M=(d-1)%u.solvedColors.length;return{...n,status:"correct-preview",color:u.solvedColors[M]}}return n})})},200),z(!1)):setTimeout(()=>{x(p=>p.map(d=>d.id===t&&d.status==="wrong"?{...d,status:"neutral"}:d))},800),c})}},ge=()=>{if(U>=1||(D.current=Date.now(),T(!1),m.filter(s=>s.categoryId===(a==null?void 0:a.id)&&(s.status==="neutral"||s.status==="hint")).length===0))return;N.playRowSolved(),Q(s=>s+1),L({hintsUsed:1});let t=S;x(s=>s.map(r=>{if(r.categoryId===(a==null?void 0:a.id)&&(r.status==="neutral"||r.status==="hint")){t++;const i=(t-1)%u.solvedColors.length;return{...r,status:"correct-preview",color:u.solvedColors[i]}}return r})),C(t),setTimeout(()=>{z(y===0)},800)},be=()=>{T(!1),L({hintsRefused:1})},le=()=>{E(!0),x(t=>t.map(s=>({...s,status:"exiting"}))),setTimeout(()=>{ae({mode:"MIND MATCH",mistakes:de})},500)},je=()=>{B();const t=m.find(s=>s.categoryId===(a==null?void 0:a.id)&&s.status==="neutral");if(t){const s=S+1;C(s);const r=(s-1)%u.solvedColors.length;x(i=>i.map(w=>w.id===t.id?{...w,status:"correct-preview",color:u.solvedColors[r]}:w)),s===6&&z(y===0)}},Ne=()=>{B();let t=S;const s=m.map(r=>{if(r.categoryId===(a==null?void 0:a.id)&&r.status!=="correct-preview"){t++;const i=(t-1)%u.solvedColors.length;return{...r,status:"correct-preview",color:u.solvedColors[i]}}return r});x(s),setTimeout(()=>z(!0),500)},ye=()=>{if(W.length>0){const t=W[W.length-1];x(t.tiles),O(t.mistakes),C(t.foundCount),K(s=>s.slice(0,s.length-1)),N.playSelect()}};return xe?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[50vh] text-white animate-fade-in",children:[e.jsx("p",{className:"mb-4 text-red-400 font-righteous text-xl",children:"UNABLE TO GENERATE LEVEL DATA."}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-white text-black font-bold rounded-full",children:"RETRY"})]}):e.jsxs("div",{className:"flex flex-col items-center w-full max-w-4xl mx-auto h-full px-4 relative select-none overflow-hidden pb-1",children:[e.jsx(Ce,{ref:P}),re&&e.jsx(Te,{onMainMenu:ne,onSolveOne:je,onSolvePuzzle:Ne,onUndo:ye}),$&&e.jsx("div",{className:"absolute inset-0 z-[90] flex items-center justify-center animate-fade-in bg-black/60",children:e.jsxs("div",{className:"bg-zinc-900 border-4 border-neon-blue rounded-2xl p-6 flex flex-col items-center gap-6 shadow-[0_0_40px_rgba(0,229,255,0.3)] animate-pop w-[90%] max-w-sm",children:[e.jsx("span",{className:"text-white font-black font-oswald text-2xl uppercase tracking-widest text-center drop-shadow-md",children:"NEED SOME HELP?"}),e.jsxs("div",{className:"flex gap-4 w-full",children:[e.jsx("button",{onClick:ge,className:"flex-1 bg-neon-blue text-black hover:bg-white hover:scale-105 active:scale-95 transition-all py-3 rounded-xl font-black uppercase font-oswald text-xl shadow-lg",children:"YES"}),e.jsx("button",{onClick:be,className:"flex-1 bg-zinc-800 border-2 border-zinc-600 text-zinc-400 hover:text-white hover:border-white hover:bg-zinc-700 hover:scale-105 active:scale-95 transition-all py-3 rounded-xl font-bold uppercase font-oswald text-xl",children:"NO"})]})]})}),f&&!_&&e.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center animate-fade-in bg-black/80",children:e.jsxs("div",{className:"relative z-10 flex flex-col items-center min-w-[300px] text-center animate-celebrate",children:[e.jsx(ze,{onClick:le,levelIndex:G}),e.jsx("div",{onClick:()=>he(!0),className:"mt-4 text-white font-oswald uppercase tracking-widest text-sm hover:text-cyan-400 cursor-pointer animate-pulse transition-colors uppercase",children:"TAP HERE TO REVIEW SOLVED PUZZLE"})]})}),e.jsxs("div",{className:"w-full mb-1 shrink-0 flex flex-col items-end gap-1 py-1 h-auto relative pr-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-2xl md:text-4xl font-black text-deco-gold font-righteous uppercase tracking-widest text-right drop-shadow-md leading-none",children:"MIND MATCH"}),_?e.jsx("button",{onClick:le,className:"px-3 py-1 bg-neon-green text-black font-bold font-oswald uppercase rounded shadow-lg animate-pulse hover:scale-105 transition-transform uppercase",children:"NEXT LEVEL >>"}):e.jsx("button",{onClick:()=>Y==null?void 0:Y([{name:(a==null?void 0:a.name)||"",isSolved:!1}]),className:"p-1 rounded-full bg-zinc-800 border border-zinc-600 hover:bg-zinc-700 hover:border-white transition-all text-zinc-300 hover:text-white active:animate-spin",title:"Settings",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.592c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a7.75 7.75 0 0 1 0 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 0 1 0-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]}),e.jsx("div",{className:"flex w-full items-center justify-end pl-2",children:e.jsxs("div",{className:"flex items-center gap-1.5 mt-1 justify-end flex-wrap max-w-full",children:[e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-2 py-0.5 rounded-full flex items-center shadow-sm whitespace-nowrap",children:[e.jsx("span",{className:"text-zinc-500 font-oswald text-[9px] mr-1.5 tracking-wider uppercase",children:"TIMER"}),e.jsxs("span",{className:`font-bold font-oswald text-xs ${R<10?"text-red-500 animate-pulse":"text-white"}`,children:["00:",R.toString().padStart(2,"0")]})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-2 py-0.5 rounded-full flex items-center shadow-sm whitespace-nowrap",children:[e.jsx("span",{className:"text-zinc-500 font-oswald text-[9px] mr-1.5 tracking-wider uppercase",children:"MISTAKES"}),e.jsxs("span",{className:`font-bold font-oswald text-xs ${y>=V-1?"text-red-500":"text-white"}`,children:[y,"/",V]})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-2 py-0.5 rounded-full flex items-center shadow-sm whitespace-nowrap",children:[e.jsx("span",{className:"text-zinc-500 font-oswald text-[9px] mr-1.5 tracking-wider uppercase",children:"ROUND"}),e.jsxs("span",{className:"text-white font-bold font-oswald text-xs",children:[A+1,"/",te]})]})]})})]}),e.jsxs("div",{className:"relative w-full flex-1 flex flex-col py-1 min-h-0",ref:we,children:[Z&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-20 pointer-events-none animate-pop",children:e.jsx("div",{className:"bg-black/80 px-12 py-4 rounded-xl border border-white text-white font-black text-2xl tracking-widest shadow-2xl font-oswald uppercase",children:Z})}),e.jsx("div",{className:`w-full flex-1 grid grid-cols-4 sm:grid-cols-5 grid-rows-5 sm:grid-rows-4 gap-1.5 transition-all duration-500 transform ${k?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:m.map(t=>e.jsx("div",{className:"relative h-full",children:e.jsx(ke,{data:t,"data-tile-id":t.id,onClick:ve,gradientClass:u.gradient})},t.id))})]}),e.jsx("div",{className:"w-full flex-shrink-0 flex items-center justify-center z-[70] min-h-[50px] pointer-events-none py-2",children:a&&e.jsx("div",{className:"animate-pop bg-black text-white px-6 py-2 rounded-t-xl text-lg md:text-xl font-black uppercase tracking-[0.2em] leading-tight border-x-4 border-t-4 border-b-0 border-white shadow-[0_-12px_24px_rgba(0,0,0,0.8)] font-oswald drop-shadow-md",children:a.name})})]})};export{Le as default};
