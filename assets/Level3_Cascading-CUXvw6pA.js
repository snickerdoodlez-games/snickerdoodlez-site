import{r as c,T as G,a as ke,u as R,b as v,j as n,d as Ee,c as Re,E as ce}from"./index-CdL25Luv.js";import{P as ze,D as Me,N as Le}from"./DebugMenu-BlYmMh_k.js";const He=({csvData:T,onComplete:de,onExit:ue,levelIndex:J,onThemeChange:z,hintsEnabled:X,debugMode:fe,onOpenSettings:M})=>{const[f,h]=c.useState([]),[j,Y]=c.useState([]),[L,y]=c.useState(null),[D,xe]=c.useState(!0),[I,A]=c.useState(!1),[me,H]=c.useState(!1),[w,he]=c.useState(G[0]),[_,K]=c.useState(0),[O,S]=c.useState(!1),[P,q]=c.useState(!1),[pe,ge]=c.useState(""),[Q,B]=c.useState(!1),[k,W]=c.useState(0),[ee,we]=c.useState(0),[U,te]=c.useState(!1),[ve,se]=c.useState(0),le=c.useRef(Date.now()),[$,oe]=c.useState([]),C=c.useRef(Date.now()),N=c.useRef(new Map),V=c.useRef(null),ne=c.useRef(!1),E=7,x=4,ae=E*x,be=c.useMemo(()=>{const o=[...f,...j];if(o.length===0)return[];const l=new Map;return o.forEach(r=>{!l.has(r.categoryId)&&r.status!=="placeholder-colored"&&l.set(r.categoryId,{name:r.categoryName,isSolved:!1})}),Array.from(l.values()).sort((r,s)=>r.name.localeCompare(s.name))},[f,j]);c.useEffect(()=>{if(ne.current||!T||T.length===0)return;const o=G[Math.floor(Math.random()*G.length)];he(o),z&&z(o.solvedColors);const l=Math.floor(Math.random()*5)+9;we(l),W(l);const r=ke(l,T);let s=[];r.forEach(u=>{[...u.words].sort(()=>.5-Math.random()).slice(0,4).forEach(e=>{s.push({id:Math.random().toString(36).substr(2,9),word:e,categoryId:u.id,categoryName:u.name,status:"neutral"})})}),s=s.sort(()=>.5-Math.random());const t=s.map((u,d)=>{const e=Math.floor(d/x),i=o.solvedColors[e%o.solvedColors.length];return{...u,color:i}});h(t.slice(0,ae)),Y(t.slice(ae)),xe(!1),K(0),S(!1),A(!1),H(!1),q(!1),te(!1),se(0),le.current=Date.now(),C.current=Date.now(),ne.current=!0},[T,J,z]),c.useEffect(()=>{if(I){const o=Date.now()-le.current;R({levelsCompleted:1,totalTimeMs:o,totalMoves:ve});const l=setTimeout(()=>{H(!0)},800);return()=>clearTimeout(l)}else H(!1)},[I]),c.useEffect(()=>{if(!X||I||P||D||_>=1)return;const o=setInterval(()=>{Date.now()-C.current>9e4&&!O&&S(!0)},5e3);return()=>clearInterval(o)},[X,I,P,D,_,O]);const ye=(o,l)=>{if(!V.current)return;const r=Re(l);o.forEach(s=>{var u;const t=N.current.get(s);if(t){const d=t.getBoundingClientRect(),e=d.left+d.width/2,i=d.top+d.height/2;(u=V.current)==null||u.explode(e,i,r)}})},Z=o=>{oe(l=>[...l,JSON.parse(JSON.stringify(o))].slice(-10))},F=c.useCallback(o=>{let l=[...o],r=-1,s="";for(let t=0;t<E;t++){const u=t*x,d=u+x;if(d>l.length)break;const e=l.slice(u,d);if(e.some(a=>a.status==="placeholder-colored"||a.status==="solved"))continue;const i=e[0].categoryId;if(e.every(a=>a.categoryId===i)){r=t,s=i;break}}if(r!==-1){v.playRowSolved();const t=w.solvedColors[(ee-k)%w.solvedColors.length],u=r*x,d=[];for(let e=0;e<x;e++)l[u+e]={...l[u+e],status:"solved",color:t},d.push(l[u+e].id);h(l),ye(d,t),R({rowsSolved:1,solvedCategoryIds:[s]}),W(e=>e-1),setTimeout(()=>{const e=[...l.slice(0,u),...l.slice(u+x)];let i=[...j];const a=[],m=w.solvedColors[Math.floor(Math.random()*w.solvedColors.length)];for(let g=0;g<x;g++)if(i.length>0){const b=i.shift();b&&a.push({...b,status:"neutral",isEmoji:!1,color:m})}else a.push({id:`blank-${Math.random()}`,word:"",categoryId:"blank",categoryName:"",status:"placeholder-colored",color:m});Y(i),h([...e,...a]),C.current=Date.now(),k<=1&&(A(!0),v.playWin())},1500)}},[k,j,w,ee]),Ie=o=>{if(I||P||Q||U)return;const l=f.findIndex(s=>s.id===o);if(l===-1)return;const r=f[l];if(!(r.status==="placeholder-colored"||r.status==="solved"))if(C.current=Date.now(),S(!1),L===null)v.playSelect(),y(o),h(s=>s.map(t=>t.id===o?{...t,status:"selected"}:t));else if(L===o)v.playSelect(),y(null),h(s=>s.map(t=>t.id===o?{...t,status:"neutral"}:t));else{const s=f.findIndex(a=>a.id===L),t=f.findIndex(a=>a.id===o);if(s===-1||t===-1){y(null);return}Z(f),se(a=>a+1);const u=f[s].id,d=f[t].id,e=N.current.get(u),i=N.current.get(d);if(B(!0),v.playSwap(),e&&i){const a=e.getBoundingClientRect(),m=i.getBoundingClientRect(),g=m.left-a.left,b=m.top-a.top;e.style.transition="transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1), z-index 0s",e.style.transform=`translate(${g}px, ${b}px) scale(1.1)`,e.style.zIndex="50",i.style.transition="transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1), z-index 0s",i.style.transform=`translate(${-g}px, ${-b}px) scale(0.9)`,i.style.zIndex="40",setTimeout(()=>{e&&(e.style.transform="",e.style.zIndex="",e.style.transition=""),i&&(i.style.transform="",i.style.zIndex="",i.style.transition="");const p=[...f];p[s]={...p[s],status:"neutral"},p[t]={...p[t],status:"neutral"};const je=p[s];p[s]=p[t],p[t]=je,h(p),y(null),B(!1),F(p)},300)}else{const a=[...f];a[s]={...a[s],status:"neutral"},a[t]={...a[t],status:"neutral"};const m=a[s];a[s]=a[t],a[t]=m,h(a),y(null),B(!1),F(a)}}},re=(o=!1)=>{if(!o&&(_>=1||Q))return;C.current=Date.now(),S(!1);const l={};f.forEach(e=>{(e.status==="neutral"||e.status==="selected")&&(l[e.categoryId]=(l[e.categoryId]||0)+1)});const r=Object.keys(l).find(e=>l[e]>=4);if(!r)return;let s=-1;for(let e=0;e<E;e++){const i=e*x;if(f.slice(i,i+x).every(m=>m.status==="neutral"||m.status==="selected")){s=e;break}}if(s===-1)return;Z(f);const t=[...f],u=t.filter(e=>e.categoryId===r&&(e.status==="neutral"||e.status==="selected")).map(e=>e.id).slice(0,4),d=[s*x,s*x+1,s*x+2,s*x+3];for(let e=0;e<4;e++){const i=d[e],a=t[i];if(u.includes(a.id))continue;const m=t.findIndex((g,b)=>u.includes(g.id)&&!d.includes(b));if(m!==-1){const g=t[i];t[i]=t[m],t[m]=g}}h(t),v.playRowSolved(),o||(K(e=>e+1),R({hintsUsed:1})),setTimeout(()=>F(t),200)},Se=()=>{S(!1),R({hintsRefused:1})},ie=()=>{q(!0);let o=Math.floor(Math.random()*ce.length);ge(ce[o]),h(l=>l.map(r=>({...r,status:"exiting"}))),setTimeout(()=>{de({mode:"HIDDEN TILES",mistakes:0})},500)},Ce=()=>{re(!0)},Ne=()=>{Z(f),W(0);const o=f.map((l,r)=>{const s=Math.floor(r/x),t=w.solvedColors[s%w.solvedColors.length];return{...l,status:"solved",color:t}});h(o),A(!0),v.playWin()},Te=()=>{if($.length>0){const o=$[$.length-1];h(o),oe(l=>l.slice(0,l.length-1)),v.playSelect()}};return D?n.jsx("div",{className:"text-white text-center mt-20 animate-pulse font-oswald text-xl uppercase",children:"LOADING STACK..."}):n.jsxs("div",{className:"flex flex-col items-center w-full max-w-4xl mx-auto h-full px-4 relative select-none overflow-hidden pb-4",children:[n.jsx(ze,{ref:V}),fe&&n.jsx(Me,{onMainMenu:ue,onSolveOne:Ce,onSolvePuzzle:Ne,onUndo:Te}),O&&n.jsx("div",{className:"absolute inset-0 z-[90] flex items-center justify-center animate-fade-in bg-black/60 backdrop-blur-[2px]",children:n.jsxs("div",{className:"bg-zinc-900 border-4 border-neon-blue rounded-2xl p-6 flex flex-col items-center gap-6 shadow-[0_0_40px_rgba(0,229,255,0.3)] animate-pop w-[90%] max-w-sm",children:[n.jsx("span",{className:"text-white font-black font-oswald text-2xl uppercase tracking-widest text-center drop-shadow-md",children:"NEED SOME HELP?"}),n.jsxs("div",{className:"flex gap-4 w-full",children:[n.jsx("button",{onClick:()=>re(!1),className:"flex-1 bg-neon-blue text-black py-3 rounded-xl font-black uppercase font-oswald text-xl shadow-lg",children:"YES"}),n.jsx("button",{onClick:Se,className:"flex-1 bg-zinc-800 border-2 border-zinc-600 text-zinc-400 py-3 rounded-xl font-bold uppercase font-oswald text-xl",children:"NO"})]})]})}),me&&!U&&n.jsx("div",{className:"absolute inset-0 z-[100] flex items-center justify-center animate-fade-in bg-black/80 backdrop-blur-sm",children:n.jsxs("div",{className:"relative z-10 flex flex-col items-center min-w-[300px] text-center animate-celebrate",children:[n.jsx(Le,{onClick:ie,levelIndex:J}),n.jsx("div",{onClick:()=>te(!0),className:"mt-4 text-white font-oswald uppercase tracking-widest text-sm hover:text-cyan-400 cursor-pointer animate-pulse transition-colors uppercase",children:"TAP HERE TO REVIEW SOLVED PUZZLE"})]})}),n.jsx("div",{className:"relative flex flex-col justify-center w-full items-end mb-1 py-1 shrink-0 h-auto min-h-[50px] pr-2",children:n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("div",{className:"flex flex-col items-end",children:[n.jsx("h2",{className:"text-right text-3xl font-bold tracking-widest text-deco-gold uppercase font-righteous drop-shadow-md leading-none",children:"HIDDEN TILES"}),n.jsxs("div",{className:"text-white font-oswald text-sm tracking-widest mt-1 text-right uppercase",children:["ROWS LEFT: ",n.jsx("span",{className:"text-neon-blue font-bold text-lg uppercase",children:k})]})]}),U?n.jsx("button",{onClick:ie,className:"px-3 py-1 bg-neon-green text-black font-bold font-oswald uppercase rounded shadow-lg animate-pulse hover:scale-105 transition-transform uppercase",children:"NEXT LEVEL >>"}):n.jsx("button",{onClick:()=>M==null?void 0:M(be),className:"p-1 rounded-full bg-zinc-800 border border-zinc-600 hover:bg-zinc-700 hover:border-white transition-all text-zinc-300 hover:text-white uppercase",children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.592c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a7.75 7.75 0 0 1 0 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 0 1 0-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281Z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})}),n.jsx("div",{className:"w-full flex-1 flex flex-col gap-2 min-h-0 relative z-10 py-2",children:Array.from({length:E}).map((o,l)=>{const r=l*x,s=f.slice(r,r+x);if(s.length===0)return null;const t=s.length===x&&s.every(d=>d.status==="solved"),u=t&&s[0].color?s[0].color.split(" ")[0]:"bg-zinc-800";return n.jsxs("div",{className:"w-full flex-1 relative min-h-0",children:[t&&n.jsx("div",{className:"absolute inset-0 z-0 animate-fade-in bg-black border-4 border-white rounded-medium"}),t&&n.jsx("div",{className:"absolute top-0 left-8 z-[100] transform",style:{transform:"translateY(calc(-100% + 4px))"},children:n.jsx("div",{className:`animate-pop px-3 py-1 rounded-t-lg text-[10px] md:text-xs font-bold uppercase tracking-widest leading-tight border-x-4 border-t-4 border-b-0 border-white shadow-[0_-12px_24px_rgba(0,0,0,0.8)] font-oswald text-white drop-shadow-md ${u}`,children:s[0].categoryName})}),n.jsx("div",{className:`w-full h-full grid grid-cols-4 gap-2 relative z-10 transition-all duration-300 ${t?"p-3 drop-shadow-xl":""}`,children:s.map(d=>n.jsx("div",{className:"relative w-full h-full",children:n.jsx(Ee,{data:d,"data-tile-id":d.id,onClick:e=>Ie(e),gradientClass:w.gradient,exitAnimation:pe,ref:e=>{e?N.current.set(d.id,e):N.current.delete(d.id)}})},d.id))})]},l)})})]})};export{He as default};
