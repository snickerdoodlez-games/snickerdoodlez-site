import{r as i,T as W,a as me,b as y,u as xe,E as ee,j as n,c as he,d as pe}from"./index-B1BpELOr.js";import{P as ge}from"./ParticleOverlay-BxzBYbW3.js";const ke=({csvData:N,onComplete:te,onExit:we,levelIndex:_,onThemeChange:S,hintsEnabled:ve,debugMode:ye,onOpenSettings:z,isStressTesting:b,diagnosticSpeed:D})=>{const[u,g]=i.useState([]),[j,V]=i.useState([]),[C,k]=i.useState(null),[Z,se]=i.useState(!0),[w,L]=i.useState(!1),[U,X]=i.useState(!1),[p,oe]=i.useState(W[0]),[v,q]=i.useState(!1),[le,re]=i.useState(""),[ae,G]=i.useState(!1),[R,$]=i.useState(!1),[ne,O]=i.useState(0),[F,ie]=i.useState(0),[be,K]=i.useState(0),ce=i.useRef(Date.now()),M=i.useRef(new Map),A=i.useRef(null),Y=i.useRef(!1),T=i.useRef(0),E=7,c=4,J=E*c,de=i.useMemo(()=>{const r=[...u,...j],a=new Map;return r.forEach(o=>{o.status!=="placeholder-colored"&&!a.has(o.categoryId)&&a.set(o.categoryId,{name:o.categoryName,isSolved:!1})}),Array.from(a.values()).sort((o,l)=>o.name.localeCompare(l.name))},[u,j]);i.useEffect(()=>{if(Y.current||!N||N.length===0)return;const r=W[Math.floor(Math.random()*W.length)];oe(r),S&&S(r.solvedColors);const a=Math.floor(Math.random()*5)+9;ie(a),O(a),T.current=a;const o=me(a,N);let l=[];o.forEach(t=>{[...t.words].sort(()=>.5-Math.random()).slice(0,4).forEach(e=>{l.push({id:Math.random().toString(36).substr(2,9),word:e,categoryId:t.id,categoryName:t.name,status:"neutral"})})}),l=l.sort(()=>.5-Math.random()).map((t,s)=>{const e=r.solvedColors[Math.floor(s/c)%r.solvedColors.length];return{...t,color:e}}),g(l.slice(0,J)),V(l.slice(J)),se(!1),L(!1),X(!1),q(!1),K(0),$(!1),ce.current=Date.now(),Y.current=!0},[N,_,S]),i.useEffect(()=>{if(!b||Z||R||v||w)return;if(D==="instant"){L(!0),y.playWin();return}const a=setTimeout(()=>{const o=new Map;u.forEach(e=>{e.status==="neutral"&&e.categoryId!=="blank"&&o.set(e.categoryId,(o.get(e.categoryId)||0)+1)});let l="";for(let[e,d]of o.entries())if(d>=4){l=e;break}if(!l){B(u);return}let t=-1,s=-1;for(let e=0;e<E;e++){const d=u.slice(e*c,e*c+c);if(d.some(m=>m.status==="solved"||m.status==="placeholder-colored"))continue;const f=d.filter(m=>m.categoryId===l).length;f>s&&f<4&&(s=f,t=e)}if(t===-1&&(t=Array.from({length:E}).findIndex((e,d)=>u.slice(d*c,d*c+c).every(f=>f.status==="neutral"&&f.categoryId!=="blank"))),t!==-1){const e=t*c,d=u.findIndex((m,x)=>x>=e&&x<e+c&&m.categoryId!==l),f=u.findIndex((m,x)=>(x<e||x>=e+c)&&m.categoryId===l&&m.status==="neutral");d!==-1&&f!==-1&&(H(u[d].id),setTimeout(()=>{v||R||w||H(u[f].id)},800))}},1200);return()=>clearTimeout(a)},[b,w,Z,u,R,D,v]),i.useEffect(()=>{if(b&&w&&!v){const r=setTimeout(()=>P(),1500);return()=>clearTimeout(r)}},[b,w,v]);const ue=(r,a)=>{if(!A.current)return;const o=pe(a);r.forEach(l=>{var s;const t=M.current.get(l);if(t){const e=t.getBoundingClientRect();(s=A.current)==null||s.explode(e.left+e.width/2,e.top+e.height/2,o)}})},B=i.useCallback(r=>{let a=[...r],o=-1,l="";for(let t=0;t<E;t++){const s=t*c,e=a.slice(s,s+c);if(!(e.some(d=>d.status==="placeholder-colored"||d.status==="solved")||e[0].categoryId==="blank")&&e.every(d=>d.categoryId===e[0].categoryId)){o=t,l=e[0].categoryId;break}}if(o!==-1){$(!0),y.playRowSolved();const t=p.solvedColors[(F-T.current)%p.solvedColors.length],s=o*c;for(let e=0;e<c;e++)a[s+e]={...a[s+e],status:"solved",color:t};g(a),ue(a.slice(s,s+c).map(e=>e.id),t),xe({rowsSolved:1,solvedCategoryIds:[l]}),T.current-=1,O(T.current),setTimeout(()=>{const e=[...a.slice(0,s),...a.slice(s+c)];let d=[...j];const f=[],m=p.solvedColors[Math.floor(Math.random()*p.solvedColors.length)];for(let I=0;I<c;I++){const h=d.shift();h?f.push({...h,status:"neutral",isEmoji:!1,color:m}):f.push({id:`blank-${Math.random()}`,word:"",categoryId:"blank",categoryName:"",status:"placeholder-colored",color:m})}V(d);const x=[...e,...f];g(x),$(!1),T.current<=0?(L(!0),y.playWin()):setTimeout(()=>B(x),300)},1500)}},[j,p,F]),H=r=>{if(w||v||ae||R)return;const a=u.findIndex(o=>o.id===r);if(!(a===-1||["placeholder-colored","solved"].includes(u[a].status)))if(C===null)y.playSelect(),k(r),g(o=>o.map(l=>l.id===r?{...l,status:"selected"}:l));else if(C===r)y.playSelect(),k(null),g(o=>o.map(l=>l.id===r?{...l,status:"neutral"}:l));else{const o=u.findIndex(t=>t.id===C),l=u.findIndex(t=>t.id===r);if(o===-1||l===-1){k(null);return}y.playSelect(),g(t=>t.map(s=>s.id===r||s.id===C?{...s,status:"selected"}:s)),setTimeout(()=>{const t=M.current.get(C),s=M.current.get(r);if(t&&s){K(h=>h+1),G(!0),y.playSwap();const e=t.getBoundingClientRect(),d=s.getBoundingClientRect(),f=d.left-e.left,m=d.top-e.top,x=t.querySelector(".tile-text"),I=s.querySelector(".tile-text");x&&(x.style.transition="opacity 0.2s",x.style.opacity="0"),I&&(I.style.transition="opacity 0.2s",I.style.opacity="0"),t.style.transition="transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)",t.style.transform=`translate(${f}px, ${m}px) scale(1.1)`,t.style.zIndex="100",s.style.transition="transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)",s.style.transform=`translate(${-f}px, ${-m}px) scale(0.9)`,s.style.zIndex="90",setTimeout(()=>{t.style.transform="",s.style.transform="",t.style.zIndex="",s.style.zIndex="";const h=[...u],fe=h[o];h[o]={...h[l],status:"neutral"},h[l]={...fe,status:"neutral"},g(h),k(null),G(!1),B(h)},400)}else k(null)},120)}},P=()=>{v||(q(!0),re(ee[Math.floor(Math.random()*ee.length)]),g(r=>r.map(a=>({...a,status:"exiting"}))),setTimeout(()=>te({mode:"HIDDEN TILES",mistakes:0}),500))},Q=i.useMemo(()=>{if(!p.solvedColors.length)return"from-zinc-800 to-zinc-900";const r=p.solvedColors.map(a=>a.split(" ")[0].replace("bg-",""));return r.length>=3?`from-${r[0]} via-${r[1]} to-${r[2]}`:`from-${r[0]} to-${r[r.length-1]}`},[p]);return n.jsxs("div",{className:"flex flex-col h-full w-full max-w-4xl mx-auto px-2 relative select-none overflow-hidden",children:[n.jsx(ge,{ref:A}),n.jsxs("header",{className:"h-[12vh] flex items-center justify-between w-full shrink-0 z-[60] px-4",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("h2",{className:"text-xl font-black tracking-widest text-deco-gold uppercase font-oswald leading-none",children:"HIDDEN TILES"}),n.jsxs("span",{className:"text-[10px] opacity-70 font-oswald font-bold tracking-widest mt-1 uppercase",children:["LEVEL ",_]})]}),n.jsxs("div",{className:"flex flex-col items-center",children:[n.jsx("span",{className:"text-[8px] text-zinc-500 font-bold uppercase tracking-[0.2em] mb-0.5",children:"Rows Left"}),n.jsx("div",{className:"bg-zinc-900 border border-zinc-700 px-3 py-0.5 rounded-full text-neon-blue font-black font-oswald text-sm shadow-inner",children:ne})]}),n.jsxs("div",{className:"flex items-center gap-4",children:[(U||w&&b)&&n.jsx("button",{onClick:P,className:`px-4 py-1.5 bg-gradient-to-r ${Q} text-white font-black font-oswald text-xs rounded-full shadow-lg border-2 border-white animate-pop`,children:"NEXT"}),n.jsx("button",{onClick:()=>z==null?void 0:z(de),className:"p-2 rounded-full bg-zinc-800 border border-zinc-600 hover:border-white text-zinc-300 hover:text-white transition-all active:rotate-90",children:n.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})]}),n.jsx("div",{className:"flex-1 w-full flex flex-col gap-2 pb-2",children:Array.from({length:E}).map((r,a)=>{const o=u.slice(a*c,a*c+c);if(o.length===0)return null;const l=o.every(s=>s.status==="solved"),t=l&&o[0].color?o[0].color.split(" ")[0].replace("bg-","text-"):"text-white";return n.jsxs("div",{className:"w-full flex-1 relative min-h-0",children:[l&&n.jsx("div",{className:"absolute inset-0 z-0 animate-fade-in bg-black border-4 border-white rounded-medium"}),l&&n.jsx("div",{className:"absolute top-0 left-8 z-[100] transform",style:{transform:"translateY(calc(-100% + 4px))"},children:n.jsx("div",{className:`animate-pop px-3 py-1 rounded-t-lg text-[10px] md:text-xs font-bold uppercase tracking-widest border-x-4 border-t-4 border-white font-oswald bg-black ${t}`,children:o[0].categoryName})}),n.jsx("div",{className:`w-full h-full grid grid-cols-4 gap-2 relative z-10 transition-all duration-300 ${l?"p-3 drop-shadow-xl":""}`,children:o.map(s=>n.jsx("div",{className:"relative w-full h-full",children:n.jsx(he,{data:s,"data-tile-id":s.id,onClick:H,gradientClass:p.gradient,exitAnimation:le,ref:e=>{e&&M.current.set(s.id,e)}})},s.id))})]},a)})}),w&&!U&&!b&&n.jsxs("div",{className:"absolute inset-0 z-[120] flex flex-col items-center justify-center next-puzzle-overlay animate-fade-in",children:[n.jsx("button",{onClick:P,className:`px-12 py-6 rounded-full border-4 border-white bg-gradient-to-r ${Q} text-white font-black font-oswald text-4xl shadow-2xl hover:scale-110 active:scale-95 transition-all uppercase tracking-[0.2em] animate-gradient-shift`,children:"NEXT PUZZLE"}),n.jsx("button",{onClick:()=>X(!0),className:"mt-8 text-deco-gold font-oswald font-black text-xl uppercase tracking-widest hover:text-white transition-colors animate-pulse",children:"CLICK TO REVIEW PUZZLE"})]})]})};export{ke as default};
