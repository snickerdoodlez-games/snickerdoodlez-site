import{r,T as U,b as m,u as Y,a as ge,j as e,d as ve,E as Ne}from"./index-CdL25Luv.js";import{P as be,D as je,N as Se}from"./DebugMenu-BlYmMh_k.js";const Ce=({csvData:N,onComplete:ee,onExit:te,levelIndex:G,onThemeChange:P,hintsEnabled:Te,debugMode:se,onOpenAnimLab:Me,onOpenSettings:E})=>{const[p,h]=r.useState([]),[k,C]=r.useState([]),[re,b]=r.useState([]),[j,W]=r.useState([]),[R,H]=r.useState(!0),[g,z]=r.useState(!1),[ne,ae]=r.useState(U[0]),[S,L]=r.useState(0),[Ie,le]=r.useState(0),[A,v]=r.useState(!1),[V,$]=r.useState(!1),[ye,oe]=r.useState(""),[_,B]=r.useState(!1),[ie,X]=r.useState(0),[w,T]=r.useState(1),Z=90,[K,F]=r.useState(Z),x=r.useRef(null),q=r.useRef(Date.now()),d=r.useRef(!0),ce=r.useRef(Date.now()),[de,D]=r.useState([]),ue=r.useRef(null),J=5,M=3,I=5;r.useEffect(()=>(m.resume(),q.current=Date.now(),d.current=!0,()=>{d.current=!1}),[]),r.useEffect(()=>{if(g){const t=Date.now()-q.current;Y({levelsCompleted:1,totalTimeMs:t,totalMoves:ie})}},[g]),r.useEffect(()=>{if(R||g||V||A){x.current&&clearInterval(x.current);return}return x.current=setInterval(()=>{d.current&&F(t=>t<=1?(x.current&&clearInterval(x.current),fe(),0):t-1)},1e3),()=>{x.current&&clearInterval(x.current)}},[R,g,V,A]);const fe=()=>{m.playError(),L(I),v(!0),w<M?setTimeout(()=>{d.current&&(T(t=>t+1),y())},1200):(m.playWin(),z(!0))},y=(t=!1)=>{H(!0);const s=U[Math.floor(Math.random()*U.length)];if(ae(s),P&&P(s.solvedColors),!N||N.length===0)return;const a=ge(30,N),l=[],i=new Set,o=[];for(const n of a){if(o.length>=J)break;const u=n.words.filter(f=>!i.has(f));u.length>=4&&([...u].sort(()=>.5-Math.random()).slice(0,4).forEach(O=>{i.add(O),l.push({id:Math.random().toString(36).substr(2,9),word:O,categoryId:n.id,categoryName:n.name.includes(":")?n.name.split(":")[1].trim():n.name,status:"neutral"})}),o.push(n))}h(l.sort(()=>.5-Math.random())),le(0),C([]),b([]),W([]),D([]),$(!1),v(!1),F(Z),B(!1),H(!1),L(0),t&&(T(1),X(0)),ce.current=Date.now()};r.useEffect(()=>{y(!0)},[N,G]);const me=t=>{const s=new Set([...re,...j].map(o=>o.color)),a=ne.solvedColors,l=a.find(o=>!s.has(o))||a[Math.floor(Math.random()*a.length)],i={id:Math.random().toString(36),tileIds:t,color:l};h(o=>o.map(n=>t.includes(n.id)?{...n,status:"correct-preview",color:l}:n)),b(o=>{const n=[...o,i];return setTimeout(()=>{d.current&&pe(n)},500),n}),C([]),m.playSwap(),X(o=>o+1)},pe=t=>{v(!0);let s=!1,a=0;const l=[],i=[];let o=[...p];if(t.forEach(n=>{const u=p.filter(c=>n.tileIds.includes(c.id)),f=u[0].categoryId;u.every(c=>c.categoryId===f)?(a++,l.push(u[0].categoryName),i.push(f),W(c=>[...c,n]),o=o.map(c=>n.tileIds.includes(c.id)?{...c,status:"solved",color:n.color}:c)):(s=!0,o=o.map(c=>n.tileIds.includes(c.id)?{...c,status:"wrong"}:c))}),h(o),s){m.playError();const n=S+1;L(n),n>=I?w<M?setTimeout(()=>{d.current&&(T(u=>u+1),y())},1200):(m.playWin(),z(!0)):setTimeout(()=>{d.current&&(h(u=>u.map(f=>f.status==="wrong"?{...f,status:"neutral",color:void 0}:f)),b([]),v(!1))},1e3)}else m.playRowSolved(),b([]),v(!1),a>0&&Y({rowsSolved:a,solvedCategoryIds:i}),xe(l),j.length+a===J&&(w<M?setTimeout(()=>{d.current&&(m.playWin(),T(n=>n+1),y())},1200):(m.playWin(),z(!0)))},xe=t=>{t.forEach((s,a)=>{setTimeout(()=>{d.current&&(D([s]),setTimeout(()=>{d.current&&D(l=>l.filter(i=>i!==s))},2500))},a*1200)})},Q=()=>{$(!0),oe(Ne[0]),h(t=>t.map(s=>({...s,status:"exiting"}))),setTimeout(()=>{ee({mode:"MIND MATCH",mistakes:S})},500)},he=r.useMemo(()=>{const t=new Map;return p.forEach(s=>t.set(s.categoryName,s.status==="solved")),Array.from(t.entries()).map(([s,a])=>({name:s,isSolved:a}))},[p]),we=r.useMemo(()=>j.map(t=>{const s=p.find(a=>t.tileIds.includes(a.id));return{name:(s==null?void 0:s.categoryName)||"???",color:t.color}}),[j,p]);return R?e.jsxs("div",{className:"text-white text-center mt-20 animate-pulse font-righteous text-xl uppercase",children:["LOADING ROUND ",w,"..."]}):e.jsxs("div",{className:"flex flex-col items-center w-full max-w-4xl mx-auto h-full px-4 relative select-none overflow-hidden pb-1",children:[e.jsx(be,{ref:ue}),se&&e.jsx(je,{onMainMenu:te,onSolveOne:()=>{},onSolvePuzzle:()=>{},onUndo:()=>{}}),g&&!_&&e.jsx("div",{className:"absolute inset-0 z-[200] flex items-center justify-center animate-fade-in bg-black/80",children:e.jsxs("div",{className:"relative z-10 flex flex-col items-center min-w-[300px] text-center animate-celebrate",children:[e.jsx(Se,{onClick:Q,levelIndex:G}),e.jsx("div",{onClick:()=>B(!0),className:"mt-4 text-white font-oswald uppercase tracking-widest text-sm hover:text-cyan-400 cursor-pointer animate-pulse transition-colors uppercase",children:"TAP HERE TO REVIEW SOLVED PUZZLE"})]})}),e.jsxs("div",{className:"relative flex flex-col justify-center w-full items-end mb-1 py-1 shrink-0 z-[60] h-auto min-h-[50px] py-1 pr-4",children:[e.jsxs("div",{className:"flex items-center gap-3 relative",children:[e.jsx("h2",{className:"text-right pointer-events-none text-2xl md:text-4xl font-black tracking-widest text-deco-gold uppercase font-righteous drop-shadow-md leading-none",children:"MIND MATCH"}),_?e.jsx("button",{onClick:Q,className:"px-3 py-1 bg-neon-green text-black font-bold font-oswald uppercase rounded shadow-lg animate-pulse hover:scale-105 transition-transform uppercase",children:"NEXT LEVEL >>"}):e.jsx("button",{onClick:()=>E==null?void 0:E(he),className:"p-1 rounded-full bg-zinc-800 border border-zinc-600 hover:bg-zinc-700 active:animate-spin transition-all text-zinc-300 hover:text-white",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.592c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a7.75 7.75 0 0 1 0 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 0 1 0-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1 justify-end flex-wrap max-w-full",children:[e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-2 py-0.5 rounded-full flex items-center shadow-sm whitespace-nowrap",children:[e.jsx("span",{className:"text-zinc-500 font-oswald text-[9px] mr-1.5 tracking-wider uppercase",children:"TIMER"}),e.jsxs("span",{className:`font-bold font-oswald text-xs ${K<=15?"text-red-500 animate-pulse":"text-white"}`,children:["00:",K.toString().padStart(2,"0")]})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-2 py-0.5 rounded-full flex items-center shadow-sm whitespace-nowrap",children:[e.jsx("span",{className:"text-zinc-500 font-oswald text-[9px] mr-1.5 tracking-wider uppercase",children:"MISTAKES"}),e.jsxs("span",{className:`font-bold font-oswald text-xs ${S>=I-1?"text-red-500":"text-white"}`,children:[S,"/",I]})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-2 py-0.5 rounded-full flex items-center shadow-sm whitespace-nowrap",children:[e.jsx("span",{className:"text-zinc-500 font-oswald text-[9px] mr-1.5 tracking-wider uppercase",children:"ROUND"}),e.jsxs("span",{className:"text-white font-bold font-oswald text-xs",children:[w,"/",M]})]})]})]}),e.jsx("div",{className:"w-full flex-1 flex flex-col py-1 overflow-hidden min-h-0 relative z-10",children:e.jsx("div",{className:"w-full h-full grid grid-cols-4 grid-rows-5 gap-1.5",children:p.map(t=>e.jsx("div",{className:"relative w-full h-full",children:e.jsx(ve,{data:t,"data-tile-id":t.id,onClick:s=>{if(!_&&!A){const a=p.find(l=>l.id===s);a&&a.status!=="solved"&&(C(l=>l.includes(s)?l.filter(i=>i!==s):[...l,s].slice(0,4)),h(l=>l.map(i=>i.id===s?{...i,status:i.status==="selected"?"neutral":"selected"}:i)),k.length===3&&!k.includes(s)&&me([...k,s]))}}})},t.id))},`grid-round-${w}`)}),e.jsxs("div",{className:"w-full flex-shrink-0 flex flex-wrap items-center justify-center z-[70] min-h-[60px] pointer-events-none py-2 gap-1.5",children:[we.map((t,s)=>e.jsx("div",{className:"animate-pop origin-bottom",children:e.jsx("div",{className:`px-3 py-1 rounded-t-lg text-[9px] md:text-xs font-bold uppercase tracking-widest border-x-2 border-t-2 border-b-0 border-white shadow-[0_-12px_24px_rgba(0,0,0,0.8)] font-oswald text-white drop-shadow-[0_2px_4px_rgba(0,0,0,1)] ${t.color.split(" ")[0]}`,children:t.name})},t.name+s)),e.jsx("div",{className:"absolute inset-x-0 bottom-full flex flex-col-reverse items-center gap-1",children:de.map((t,s)=>e.jsx("div",{className:"animate-pop origin-center",children:e.jsx("span",{className:"text-deco-gold font-righteous text-2xl md:text-3xl uppercase tracking-wider drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]",children:t})},t+s))})]})]})};export{Ce as default};
