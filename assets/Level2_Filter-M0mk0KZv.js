import{r as s,T as y,b as g,u as ce,j as e,c as de,M as Z,f as ue,S as B,d as xe}from"./index-B1BpELOr.js";import{P as fe}from"./ParticleOverlay-BxzBYbW3.js";const je=({csvData:w,onExit:me,onComplete:R,onGameOver:C,levelIndex:L,onThemeChange:I,hintsEnabled:he,debugMode:pe,onOpenAnimLab:ge,onOpenSettings:b})=>{const[d,V]=s.useState(null),[u,f]=s.useState([]),[X,_]=s.useState(0),[A,K]=s.useState(0),[v,T]=s.useState(!1),[j,m]=s.useState(null),[i,q]=s.useState(!1),[h,Y]=s.useState(!1),[P,F]=s.useState(0),[J,Q]=s.useState(!1),[x,ee]=s.useState(y[0]),[U,W]=s.useState(0),[p,$]=s.useState(21),[we,te]=s.useState(0),[be,se]=s.useState(!1),[H,re]=s.useState(0),D=s.useRef(Date.now()),N=s.useRef(null),O=6,E=5;s.useEffect(()=>{g.resume(),D.current=Date.now()},[]),s.useEffect(()=>{if(v||i||!d)return;if(p<=0){ne();return}const t=setInterval(()=>{$(r=>r-1)},1e3);return()=>clearInterval(t)},[p,v,i,d]),s.useEffect(()=>{if(i){const t=Date.now()-D.current;ce({levelsCompleted:1,totalTimeMs:t,totalMoves:H})}},[i,H]);const ne=()=>{g.playError(),_(t=>{const r=t+1;return r>=E&&C(),r}),F(t=>t+1),m("TIME UP!"),setTimeout(()=>{m(null),k(!0)},1500)},k=(t=!1)=>{if(i)return;t||T(!0);const r=()=>{const M=y[Math.floor(Math.random()*y.length)];ee(M),I&&I(M.solvedColors),W(0),te(0),se(!1);const o=Math.max(10,21-A-Math.floor(L/3));$(o);const n=w.filter(l=>l.words.filter(ie=>ie.length<=Z).length>=6);if(n.length===0){Q(!0),T(!1);return}const a=n[Math.floor(Math.random()*n.length)];V(a);const c=ue(a,6),S=new Set(c),ae=[...w.filter(l=>l.id!==a.id).flatMap(l=>l.words).filter(l=>l.length<=Z&&!S.has(l))].sort(()=>.5-Math.random()).slice(0,6),le=[...c.map(l=>({id:Math.random().toString(36).substr(2,9),word:l,categoryId:a.id,categoryName:a.name,status:"neutral"})),...ae.map(l=>({id:Math.random().toString(36).substr(2,9),word:l,categoryId:"incorrect",categoryName:"Incorrect",status:"neutral"}))].sort(()=>.5-Math.random());f(le),T(!1)};t?r():setTimeout(r,400)};s.useEffect(()=>{k(!0)},[w]);const oe=t=>{if(v||i||j)return;const r=u.findIndex(o=>o.id===t);if(r===-1||u[r].status==="solved"||u[r].status==="wrong")return;if(re(o=>o+1),u[r].categoryId===(d==null?void 0:d.id)){g.playCorrect();const o=x.solvedColors[U%x.solvedColors.length];f(a=>a.map(c=>c.id===t?{...c,status:"solved",color:o}:c)),W(a=>{const c=a+1;return c===6&&(m(B[Math.floor(Math.random()*B.length)]),K(S=>{const z=S+1;return z>=O?setTimeout(()=>q(!0),1e3):setTimeout(()=>{m(null),k()},1200),z})),c});const n=document.querySelector(`[data-tile-id="${t}"]`);if(n&&N.current){const a=n.getBoundingClientRect();N.current.explode(a.left+a.width/2,a.top+a.height/2,xe(o))}}else g.playError(),f(o=>o.map(n=>n.id===t?{...n,status:"wrong"}:n)),_(o=>{const n=o+1;return n>=E&&C(),n}),F(o=>o+1),setTimeout(()=>{f(o=>o.map(n=>n.id===t?{...n,status:"neutral"}:n))},500)},G=s.useMemo(()=>{if(!x.solvedColors.length)return"from-zinc-800 to-zinc-900";const t=x.solvedColors.map(r=>r.split(" ")[0].replace("bg-",""));return t.length>=3?`from-${t[0]} via-${t[1]} to-${t[2]}`:`from-${t[0]} to-${t[t.length-1]}`},[x]);return J?e.jsx("div",{className:"text-white text-center mt-20 font-oswald uppercase",children:"FAILED TO START LEVEL."}):e.jsxs("div",{className:"flex flex-col items-center w-full max-w-4xl mx-auto h-full px-4 relative select-none overflow-hidden pb-4",children:[e.jsx(fe,{ref:N}),e.jsxs("header",{className:"h-[12vh] flex items-center justify-between w-full shrink-0 z-[60] px-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:"text-xl font-black tracking-widest text-deco-gold uppercase font-oswald leading-none",children:(d==null?void 0:d.name)||"TARGET FILTER"}),e.jsxs("span",{className:"text-[10px] opacity-70 font-oswald font-bold tracking-widest mt-1 uppercase",children:["LEVEL ",L]})]}),!h&&e.jsxs("div",{className:"flex items-center gap-2 font-bold uppercase font-oswald text-[8px] md:text-[10px]",children:[e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-2 py-1 rounded-full shadow-inner flex flex-col items-center",children:[e.jsx("span",{className:"text-zinc-500 text-[6px] leading-none mb-0.5",children:"TIMER"}),e.jsxs("span",{className:p<=5?"text-red-500 animate-pulse":"text-white",children:["00:",p.toString().padStart(2,"0")]})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-2 py-1 rounded-full shadow-inner flex flex-col items-center",children:[e.jsx("span",{className:"text-zinc-500 text-[6px] leading-none mb-0.5",children:"FOUND"}),e.jsxs("span",{className:"text-white",children:[U,"/6"]})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-2 py-1 rounded-full shadow-inner flex flex-col items-center",children:[e.jsx("span",{className:"text-zinc-500 text-[6px] leading-none mb-0.5",children:"ROUND"}),e.jsxs("span",{className:"text-white",children:[A+1,"/",O]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[(h||i)&&e.jsx("button",{onClick:()=>R({mode:"TARGET FILTER",mistakes:P}),className:`px-4 py-1.5 bg-gradient-to-r ${G} text-white font-black font-oswald text-xs rounded-full shadow-lg border-2 border-white animate-pop`,children:"NEXT"}),e.jsx("button",{onClick:()=>b==null?void 0:b(),className:"p-2 rounded-full bg-zinc-800 border border-zinc-600 hover:border-white text-zinc-300 hover:text-white transition-all active:rotate-90",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})]}),e.jsxs("div",{className:"w-full flex-1 grid grid-cols-3 grid-rows-4 gap-3 py-2 min-h-0 relative z-10",children:[u.map(t=>e.jsx("div",{className:"relative w-full h-full",children:e.jsx(de,{data:t,"data-tile-id":t.id,onClick:oe})},t.id)),j&&e.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"bg-black/90 border-4 border-white px-8 py-4 rounded-xl shadow-2xl animate-pop",children:e.jsx("span",{className:"text-white font-black font-oswald text-4xl uppercase tracking-tighter italic",children:j})})})]}),!i&&!h&&e.jsx("div",{className:"w-full h-[6vh] mt-2 bg-zinc-900/50 p-2 rounded-lg border border-zinc-800 flex justify-center items-center gap-1 shrink-0",children:Array.from({length:E}).map((t,r)=>e.jsx("div",{className:`w-3 h-3 rounded-full border-2 ${r<X?"bg-red-600 border-red-400 shadow-[0_0_10px_rgba(220,38,38,0.5)]":"bg-zinc-800 border-zinc-700"}`},r))}),i&&!h&&e.jsxs("div",{className:"absolute inset-0 z-[120] flex flex-col items-center justify-center next-puzzle-overlay animate-fade-in",children:[e.jsx("button",{onClick:()=>R({mode:"TARGET FILTER",mistakes:P}),className:`px-12 py-6 rounded-full border-4 border-white bg-gradient-to-r ${G} text-white font-black font-oswald text-4xl shadow-[0_0_50px_rgba(255,255,255,0.5)] hover:scale-110 active:scale-95 transition-all uppercase tracking-[0.2em] animate-gradient-shift`,children:"NEXT PUZZLE"}),e.jsx("button",{onClick:()=>Y(!0),className:"mt-8 text-deco-gold font-oswald font-black text-xl uppercase tracking-widest hover:text-white transition-colors animate-pulse",children:"CLICK TO REVIEW PUZZLE"})]})]})};export{je as default};
