import{r as c,T as J,f as Ie,u as z,b as y,j as a,E as oe,d as je}from"./index-CdL25Luv.js";import{P as Ee,D as Ce,N as ke}from"./DebugMenu-BlYmMh_k.js";const Re=({onComplete:ne,onExit:le,levelIndex:q,onThemeChange:R,hintsEnabled:G,debugMode:ae,onOpenAnimLab:Ne,onOpenSettings:A})=>{const[x,w]=c.useState([]),[D,j]=c.useState(null),[E,re]=c.useState(!0),[g,L]=c.useState(!1),[ie,H]=c.useState(!1),[b,ce]=c.useState(J[0]),[O,V]=c.useState(0),[_,I]=c.useState(!1),[C,X]=c.useState(!1),[de,ue]=c.useState(""),[Z,M]=c.useState(!1),[k,Y]=c.useState(!1),[fe,K]=c.useState(0),[xe,P]=c.useState(0),[Me,F]=c.useState(120),Q=c.useRef(Date.now()),[W,B]=c.useState([]),N=c.useRef(Date.now()),T=c.useRef(new Map),me=c.useRef(null),h=3,ee=5,he=c.useMemo(()=>{if(x.length===0)return[];const s=new Map;return x.forEach(l=>{if(!s.has(l.categoryId)){const o=x.filter(i=>i.categoryId===l.categoryId).every(i=>i.status==="solved"||i.status==="exiting");s.set(l.categoryId,{name:l.categoryName,isSolved:o})}}),Array.from(s.values()).sort((l,t)=>l.name.localeCompare(t.name))},[x]);c.useEffect(()=>{const s=J[Math.floor(Math.random()*J.length)];ce(s),R&&R(s.solvedColors);const t=[...Ie()].sort(()=>.5-Math.random()),o=[],i=new Set;let d=0;const u=7;for(const n of t){if(d>=u)break;const e=Array.from(new Set(n.words)).filter(p=>!i.has(p)),m=[...new Set(e)];m.length>=h&&([...m].sort(()=>.5-Math.random()).slice(0,h).forEach(f=>{i.add(f),o.push({id:Math.random().toString(36).substr(2,9),word:f,categoryId:n.id,categoryName:n.name,status:"neutral",isEmoji:!0})}),d++)}w(o.sort(()=>.5-Math.random())),B([]),L(!1),H(!1),X(!1),re(!1),V(0),I(!1),M(!1),Y(!1),K(0),P(0),F(120),N.current=Date.now(),Q.current=Date.now()},[q,R]),c.useEffect(()=>{if(g||C||E||k)return;const s=setInterval(()=>{F(l=>l<=1?(clearInterval(s),0):l-1)},1e3);return()=>clearInterval(s)},[g,C,E,k]),c.useEffect(()=>{if(!G||g||C||E||O>=1)return;const s=setInterval(()=>{Date.now()-N.current>9e4&&!_&&I(!0)},5e3);return()=>clearInterval(s)},[G,g,C,E,O,_]),c.useEffect(()=>{if(g){const s=Date.now()-Q.current;z({levelsCompleted:1,totalTimeMs:s,totalMoves:fe});const l=setTimeout(()=>{H(!0)},800);return()=>clearTimeout(l)}else H(!1)},[g]);const U=s=>{B(l=>[...l,JSON.parse(JSON.stringify(s))].slice(-10))},$=c.useCallback(s=>{var d,u,n;const l=Math.floor(s.length/h);let t=0;const o=[...s];let i=!1;for(let r=0;r<l;r++){const e=r*h,m=o.slice(e,e+h);if(!m[0]||((d=m[0])==null?void 0:d.status)==="solved"||((u=m[0])==null?void 0:u.status)==="exiting"){((n=m[0])==null?void 0:n.status)==="solved"&&t++;continue}const p=m[0].categoryId;if(m.every(v=>(v==null?void 0:v.categoryId)===p)){i=!0,t++,y.playRowSolved(),z({rowsSolved:1,solvedCategoryIds:[p]});const v=b.solvedColors[r%b.solvedColors.length];for(let S=e;S<e+h;S++)o[S]={...o[S],status:"solved",color:v}}}return i&&(w(o),N.current=Date.now(),I(!1)),t===l&&l>0&&(g||(y.playWin(),L(!0))),i},[g,b]),pe=s=>{if(!(g||C||Z||k||!x.find(t=>t.id===s)))if(N.current=Date.now(),I(!1),D===null)y.playSelect(),j(s),w(t=>t.map(o=>o.id===s?{...o,status:"selected"}:o));else if(D===s)y.playSelect(),j(null),w(t=>t.map(o=>o.id===s?{...o,status:"neutral"}:o));else{const t=x.findIndex(r=>r.id===D),o=x.findIndex(r=>r.id===s);if(t===-1||o===-1){j(null);return}U(x),K(r=>r+1);const i=x[t].id,d=x[o].id,u=T.current.get(i),n=T.current.get(d);if(M(!0),u&&n){y.playSwap();const r=u.getBoundingClientRect(),e=n.getBoundingClientRect(),m=e.left-r.left,p=e.top-r.top;u.style.transition="transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1), box-shadow 0.3s, z-index 0s",u.style.transform=`translate(${m}px, ${p}px) scale(1.15)`,u.style.zIndex="50",u.style.boxShadow="0 20px 25px -5px rgba(0, 0, 0, 0.5)",n.style.transition="transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1), box-shadow 0.3s, z-index 0s",n.style.transform=`translate(${-m}px, ${-p}px) scale(0.95)`,n.style.zIndex="40",setTimeout(()=>{u&&(u.style.transition="",u.style.transform="",u.style.zIndex="",u.style.boxShadow=""),n&&(n.style.transition="",n.style.transform="",n.style.zIndex="");const f=[...x];f[t]&&f[t].status!=="locked"&&(f[t]={...f[t],status:"neutral"}),f[o]&&f[o].status!=="locked"&&(f[o]={...f[o],status:"neutral"});const v=f[t];f[t]=f[o],f[o]=v,w(f),j(null),M(!1),$(f)||P(Se=>Math.min(ee,Se+1))},300)}else{const r=[...x],e=r[t];r[t]=r[o],r[o]=e,w(r),j(null),M(!1),$(r)||P(p=>Math.min(ee,p+1))}}},te=(s=!1)=>{if(!s&&(O>=1||Z))return;N.current=Date.now(),I(!1);const l=new Set;x.forEach(e=>{(e.status==="neutral"||e.status==="selected"||e.status==="locked")&&l.add(e.categoryId)});let t="";for(const e of Array.from(l))if(x.filter(p=>p.categoryId===e&&p.status!=="solved").length===h){t=e;break}if(!t)return;const o=Math.floor(x.length/h);let i=-1;for(let e=0;e<o;e++){const m=e*h;if(!x.slice(m,m+h).every(v=>v.status==="solved")){i=e;break}}if(i===-1)return;U(x);const d=[...x],u=[];for(let e=0;e<h;e++)u.push(i*h+e);const n=d.filter(e=>e.categoryId===t&&e.status!=="solved").map(e=>e.id);for(let e=0;e<h;e++){const m=u[e],p=d[m];if(n.includes(p.id))continue;const f=d.findIndex((v,S)=>n.includes(v.id)&&!u.includes(S));if(f!==-1){const v=d[m];d[m]=d[f],d[f]=v}}const r=b.solvedColors[i%b.solvedColors.length];u.forEach(e=>{d[e]={...d[e],status:"solved",color:r}}),w(d),y.playRowSolved(),s||(V(e=>e+1),z({hintsUsed:1,rowsSolved:1,solvedCategoryIds:[t]})),setTimeout(()=>$(d),200)},ve=()=>{I(!1),z({hintsRefused:1})},se=()=>{X(!0);let s=Math.floor(Math.random()*oe.length);const l=oe[s];ue(l),w(t=>t.map(o=>({...o,status:"exiting"}))),setTimeout(()=>{ne({mode:"EMOJI MATCH",mistakes:xe})},500)},we=()=>te(!0),ge=()=>{U(x);const s=x.map((l,t)=>{const o=Math.floor(t/h),i=b.solvedColors[o%b.solvedColors.length];return{...l,status:"solved",color:i}});w(s),y.playWin(),L(!0)},be=()=>{if(W.length>0){const s=W[W.length-1];w(s),B(l=>l.slice(0,l.length-1)),y.playSelect()}};if(E)return a.jsx("div",{className:"text-white text-center mt-20 animate-pulse font-oswald uppercase",children:"LOADING EMOJIS..."});const ye=()=>{const s=[],l=Math.floor(x.length/h);for(let t=0;t<l;t++){const o=t*h,i=x.slice(o,o+h);if(!i[0])continue;const d=i.every(n=>(n==null?void 0:n.status)==="solved"||(n==null?void 0:n.status)==="exiting"),u=d&&i[0].color?i[0].color.split(" ")[0]:"bg-zinc-800";s.push(a.jsx("div",{className:"w-full relative z-10 flex-1 flex flex-col justify-center transition-opacity duration-500 min-h-0",style:{zIndex:10+t},children:a.jsxs("div",{className:"relative w-full h-full p-1",children:[d&&a.jsx("div",{className:"absolute inset-0 z-0 animate-fade-in bg-black border-4 border-white rounded-xl"}),d&&a.jsx("div",{className:"absolute top-0 left-8 z-[100] transform",style:{transform:"translateY(calc(-100% + 4px))"},children:a.jsx("div",{className:`animate-pop px-3 py-1 rounded-t-lg text-[10px] md:text-xs font-bold uppercase tracking-widest leading-tight border-x-4 border-t-4 border-b-0 border-white shadow-[0_-12px_24px_rgba(0,0,0,0.8)] font-oswald text-white drop-shadow-md ${u}`,children:i[0].categoryName})}),a.jsx("div",{className:`grid grid-cols-3 gap-2 w-full h-full relative z-10 p-1 ${d?"drop-shadow-xl p-2":""}`,children:i.map(n=>n?a.jsx("div",{className:"relative w-full h-full",children:a.jsx(je,{data:n,"data-tile-id":n.id,onClick:r=>pe(r),gradientClass:b.gradient,exitAnimation:de,ref:r=>{r?T.current.set(n.id,r):T.current.delete(n.id)}})},n.id):null)})]})},t))}return s};return a.jsxs("div",{className:"flex flex-col items-center w-full max-w-4xl mx-auto h-full px-2 relative select-none overflow-hidden pb-1",children:[a.jsx(Ee,{ref:me}),ae&&a.jsx(Ce,{onMainMenu:le,onSolveOne:we,onSolvePuzzle:ge,onUndo:be}),_&&a.jsx("div",{className:"absolute inset-0 z-[90] flex items-center justify-center animate-fade-in bg-black/60",children:a.jsxs("div",{className:"bg-zinc-900 border-4 border-neon-blue rounded-2xl p-6 flex flex-col items-center gap-6 shadow-[0_0_40px_rgba(0,229,255,0.3)] animate-pop w-[90%] max-sm",children:[a.jsx("span",{className:"text-white font-black font-oswald text-2xl uppercase tracking-widest text-center drop-shadow-md",children:"NEED SOME HELP?"}),a.jsxs("div",{className:"flex gap-4 w-full",children:[a.jsx("button",{onClick:()=>te(!1),className:"flex-1 bg-neon-blue text-black hover:bg-white hover:scale-105 active:scale-95 transition-all py-3 rounded-xl font-black uppercase font-oswald text-xl shadow-lg",children:"YES"}),a.jsx("button",{onClick:ve,className:"flex-1 bg-zinc-800 border-2 border-zinc-600 text-zinc-400 hover:text-white hover:border-white hover:bg-zinc-700 hover:scale-105 active:scale-95 transition-all py-3 rounded-xl font-bold uppercase font-oswald text-xl",children:"NO"})]})]})}),ie&&!k&&a.jsx("div",{className:"absolute inset-0 z-[200] flex items-center justify-center animate-fade-in bg-black/80",children:a.jsxs("div",{className:"relative z-20 flex flex-col items-center min-w-[300px] text-center animate-celebrate",children:[a.jsx(ke,{onClick:se,levelIndex:q}),a.jsx("div",{onClick:()=>Y(!0),className:"mt-4 text-white font-oswald uppercase tracking-widest text-sm hover:text-cyan-400 cursor-pointer animate-pulse transition-colors uppercase",children:"TAP HERE TO REVIEW SOLVED PUZZLE"})]})}),a.jsx("div",{className:"relative flex flex-col justify-center w-full items-end mb-1 shrink-0 z-[60] h-auto min-h-[50px] py-1 pr-4",children:a.jsxs("div",{className:"flex items-center gap-3 relative",children:[a.jsx("h2",{className:"text-right pointer-events-none text-2xl md:text-4xl font-black tracking-widest text-deco-gold uppercase font-righteous drop-shadow-md leading-none",children:"EMOJI MATCH"}),k?a.jsx("button",{onClick:se,className:"px-3 py-1 bg-neon-green text-black font-bold font-oswald uppercase rounded shadow-lg animate-pulse hover:scale-105 transition-transform uppercase",children:"NEXT LEVEL >>"}):a.jsx("button",{onClick:()=>A==null?void 0:A(he),className:"p-1 rounded-full bg-zinc-800 border border-zinc-600 hover:bg-zinc-700 active:animate-spin transition-all text-zinc-300 hover:text-white",children:a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.592c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a7.75 7.75 0 0 1 0 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 0 1 0-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281Z"}),a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})}),a.jsx("div",{className:"w-full flex-1 flex flex-col animate-fade-in gap-1 min-h-0",style:{animationDelay:"0.1s"},children:ye()})]})};export{Re as default};
