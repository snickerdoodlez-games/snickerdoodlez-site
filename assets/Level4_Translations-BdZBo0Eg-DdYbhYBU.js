import{l as r,G as z,F as ue,a as G,U as x,f as o,u as fe,v as he,P as Z}from"./index-DZYk55dN.js";import{f as me,y as pe,h as xe}from"./DebugMenu-BlYmMh_k-BePBMNzk.js";const Se=({csvData:b,onComplete:F,onExit:H,levelIndex:R,onThemeChange:N,hintsEnabled:ge,onOpenSettings:A,debugMode:q})=>{const[d,m]=r.useState([]),[y,k]=r.useState(null),[J,K]=r.useState(!0),[w,C]=r.useState(!1),[Q,D]=r.useState(!1),[g,X]=r.useState(z[0]),[ve,Y]=r.useState(0),[we,ee]=r.useState(!1),[te,L]=r.useState(!1),[se,ae]=r.useState(""),[le,I]=r.useState(!1),[E,O]=r.useState(!1),[_,P]=r.useState(0),U=r.useRef(Date.now()),[M,S]=r.useState([]),W=r.useRef(Date.now()),$=r.useRef(!1),j=r.useRef(new Map),T=r.useRef(null),ne=r.useMemo(()=>{if(d.length===0)return[];const a=new Map;return d.forEach(l=>{if(!a.has(l.categoryId)){const e=d.filter(t=>t.categoryId===l.categoryId).every(t=>t.status==="solved"||t.status==="exiting");a.set(l.categoryId,{name:l.categoryName,isSolved:e})}}),Array.from(a.values()).sort((l,e)=>l.name.localeCompare(e.name))},[d]);r.useEffect(()=>{if($.current||!b||b.length===0)return;const a=z[Math.floor(Math.random()*z.length)];X(a),N&&N(a.solvedColors);const l=ue(15,b),e=[],t=new Set,i=[];for(const s of l){if(i.length>=7)break;const n=s.words.filter(c=>!t.has(c));n.length>=4&&([...n].sort(()=>.5-Math.random()).slice(0,4).forEach(c=>{t.add(c),e.push({id:Math.random().toString(36).substr(2,9),word:c,categoryId:s.id,categoryName:s.name.toUpperCase(),status:"neutral"})}),i.push(s))}m(e.sort(()=>.5-Math.random())),S([]),C(!1),D(!1),L(!1),K(!1),Y(0),ee(!1),I(!1),O(!1),P(0),W.current=Date.now(),U.current=Date.now(),$.current=!0},[b,R,N]),r.useEffect(()=>{if(w){const a=Date.now()-U.current;G({levelsCompleted:1,totalTimeMs:a,totalMoves:_}),setTimeout(()=>D(!0),800)}},[w,_]);const oe=(a,l)=>{if(!T.current)return;const e=he(l);a.forEach(t=>{var i;const s=j.current.get(t);if(s){const n=s.getBoundingClientRect(),c=n.left+n.width/2,u=n.top+n.height/2;(i=T.current)==null||i.explode(c,u,e)}})},B=r.useCallback(a=>{var l,e;const t=a.length/4;let i=0;const s=[...a];let n=!1;for(let c=0;c<t;c++){const u=c*4,f=s.slice(u,u+4);if(!f[0]||((l=f[0])==null?void 0:l.status)==="solved"){((e=f[0])==null?void 0:e.status)==="solved"&&i++;continue}const h=f[0].categoryId;if(f.every(p=>p&&p.categoryId===h)){n=!0,i++,x.playRowSolved(),G({rowsSolved:1,solvedCategoryIds:[h]});const p=g.solvedColors[c%g.solvedColors.length];oe(f.map(v=>v.id),p);for(let v=u;v<u+4;v++)s[v]={...s[v],status:"solved",color:p}}}n&&m(s),i===t&&t>0&&!w&&(x.playWin(),C(!0))},[w,g]),re=a=>{if(w||te||le||E)return;const l=d.find(e=>e.id===a);if(!(!l||l.status==="solved"))if(W.current=Date.now(),y===null)x.playSelect(),k(a),m(e=>e.map(t=>t.id===a?{...t,status:"selected"}:t));else if(y===a)x.playSelect(),k(null),m(e=>e.map(t=>t.id===a?{...t,status:"neutral"}:t));else{const e=d.findIndex(n=>n.id===y),t=d.findIndex(n=>n.id===a);S(n=>[...n,d]),P(n=>n+1),I(!0),x.playSwap();const i=j.current.get(y),s=j.current.get(a);if(i&&s){const n=i.getBoundingClientRect(),c=s.getBoundingClientRect(),u=c.left-n.left,f=c.top-n.top;i.style.transition="transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",i.style.transform=`translate(${u}px, ${f}px) scale(1.1)`,s.style.transition="transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)",s.style.transform=`translate(${-u}px, ${-f}px) scale(0.9)`,setTimeout(()=>{i.style.transform="",s.style.transform="";const h=[...d],p=h[e];h[e]={...h[t],status:"neutral"},h[t]={...p,status:"neutral"},m(h),k(null),I(!1),B(h)},300)}}},V=()=>{L(!0);const a=Z[Math.floor(Math.random()*Z.length)];ae(a),m(l=>l.map(e=>({...e,status:"exiting"}))),setTimeout(()=>{F()},500)},ie=()=>{const a=d.filter(s=>s.status==="neutral");if(a.length<4)return;const l=a[0].categoryId,e=[...d],t=Math.floor(d.findIndex(s=>s.status!=="solved")/4),i=[t*4,t*4+1,t*4+2,t*4+3];d.filter(s=>s.categoryId===l).map(s=>s.id).forEach((s,n)=>{const c=e.findIndex(h=>h.id===s),u=i[n],f=e[u];e[u]=e[c],e[u]=e[c],e[c]=f}),m(e),B(e)},ce=()=>{S(e=>[...e,d]);const a=new Map;d.forEach(e=>{const t=a.get(e.categoryId)||[];t.push(e),a.set(e.categoryId,t)});const l=[];Array.from(a.values()).forEach((e,t)=>{const i=g.solvedColors[t%g.solvedColors.length];e.forEach(s=>{l.push({...s,status:"solved",color:i})})}),m(l),C(!0),x.playWin()},de=()=>{if(M.length>0){const a=M[M.length-1];m(a),S(l=>l.slice(0,-1)),x.playSelect()}};return J?o.jsx("div",{className:"text-white text-center mt-20 animate-pulse font-righteous",children:"LOADING TRANSLATIONS..."}):o.jsxs("div",{className:"flex flex-col items-center w-full max-w-4xl mx-auto h-full px-2 relative select-none overflow-hidden pb-1",children:[o.jsx(me,{ref:T}),q&&o.jsx(pe,{onMainMenu:H,onSolveOne:ie,onSolvePuzzle:ce,onUndo:de}),Q&&!E&&o.jsx("div",{className:"absolute inset-0 z-[250] flex items-center justify-center animate-fade-in bg-black/80 backdrop-blur-sm",children:o.jsxs("div",{className:"relative z-10 flex flex-col items-center min-w-[300px] text-center animate-celebrate",children:[o.jsx(xe,{onClick:V,levelIndex:R}),o.jsx("div",{onClick:()=>O(!0),className:"mt-4 text-white font-oswald uppercase tracking-widest text-sm hover:text-cyan-400 cursor-pointer animate-pulse transition-colors uppercase",children:"TAP HERE TO REVIEW SOLVED PUZZLE"})]})}),o.jsx("div",{className:"relative flex flex-col justify-center w-full items-end mb-1 py-1 shrink-0 z-[60] h-auto min-h-[40px] pr-4",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("h2",{className:"text-right pointer-events-none text-2xl font-bold tracking-widest text-deco-gold uppercase font-righteous drop-shadow-md",children:"TRANSLATION"}),E?o.jsx("button",{onClick:V,className:"px-3 py-1 bg-neon-green text-black font-bold font-oswald uppercase rounded shadow-lg animate-pulse hover:scale-105 transition-transform uppercase",children:"NEXT LEVEL >>"}):o.jsx("button",{onClick:()=>A==null?void 0:A(ne),className:"p-1 rounded-full bg-zinc-800 border border-zinc-600 hover:bg-zinc-700 hover:border-white transition-all text-zinc-300 hover:text-white active:animate-spin",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.592c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a7.75 7.75 0 0 1 0 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 0 1 0-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281Z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})}),o.jsx("div",{className:"w-full flex-1 flex flex-col gap-1",children:Array.from({length:d.length/4}).map((a,l)=>{const e=d.slice(l*4,l*4+4),t=e.every(s=>s.status==="solved"||s.status==="exiting"),i=t&&e[0].color?e[0].color.split(" ")[0]:"bg-zinc-800";return o.jsx("div",{className:"w-full relative flex-1 flex flex-col justify-center min-h-0",children:o.jsxs("div",{className:"relative w-full h-full p-1",children:[t&&o.jsx("div",{className:"absolute inset-0 z-0 animate-fade-in bg-black border-4 border-white rounded-medium"}),t&&o.jsx("div",{className:"absolute top-0 left-8 z-[100] transform",style:{transform:"translateY(calc(-100% + 4px))"},children:o.jsx("div",{className:`animate-pop px-4 py-1 rounded-t-lg text-[10px] md:text-xs font-bold uppercase tracking-widest leading-tight border-x-4 border-t-4 border-b-0 border-white shadow-[0_-12px_24px_rgba(0,0,0,0.8)] font-oswald text-white drop-shadow-[0_2px_4px_rgba(0,0,0,1)] ${i}`,children:e[0].categoryName})}),o.jsx("div",{className:`grid grid-cols-4 gap-1.5 w-full h-full relative z-10 transition-all duration-300 ${t?"p-3 drop-shadow-xl":""}`,children:e.map(s=>o.jsx("div",{className:"relative w-full h-full",children:o.jsx(fe,{data:s,"data-tile-id":s.id,onClick:re,gradientClass:g.gradient,exitAnimation:se,ref:n=>{n&&j.current.set(s.id,n)}})},s.id))})]})},l)})})]})};export{Se as default};
