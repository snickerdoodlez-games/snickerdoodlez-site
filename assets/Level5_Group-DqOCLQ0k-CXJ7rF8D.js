import{l as a,G as $,U as p,a as Q,F as we,f as e,u as ge,P as ve}from"./index-DZYk55dN.js";import{f as be,y as je,h as Ne}from"./DebugMenu-BlYmMh_k-BePBMNzk.js";const ze=({csvData:b,onComplete:Y,onExit:ee,levelIndex:A,onThemeChange:W,hintsEnabled:ye,debugMode:te,onOpenAnimLab:Se,onOpenSettings:O})=>{const[m,h]=a.useState([]),[I,z]=a.useState([]),[se,j]=a.useState([]),[N,U]=a.useState([]),[E,H]=a.useState(!0),[g,C]=a.useState(!1),[ae,re]=a.useState($[0]),[y,D]=a.useState(0),[ke,le]=a.useState(0),[R,v]=a.useState(!1),[P,V]=a.useState(!1),[Me,ne]=a.useState(""),[L,Z]=a.useState(!1),[oe,F]=a.useState(0),[w,S]=a.useState(1),B=90,[G,K]=a.useState(B),f=a.useRef(null),X=a.useRef(Date.now()),u=a.useRef(!0),ie=a.useRef(Date.now()),[ce,_]=a.useState([]),de=a.useRef(null),q=5,k=3,M=5;a.useEffect(()=>(p.resume(),X.current=Date.now(),u.current=!0,()=>{u.current=!1}),[]),a.useEffect(()=>{if(g){const t=Date.now()-X.current;Q({levelsCompleted:1,totalTimeMs:t,totalMoves:oe})}},[g]),a.useEffect(()=>{if(E||g||P||R){f.current&&clearInterval(f.current);return}return f.current=setInterval(()=>{u.current&&K(t=>t<=1?(f.current&&clearInterval(f.current),ue(),0):t-1)},1e3),()=>{f.current&&clearInterval(f.current)}},[E,g,P,R]);const ue=()=>{p.playError(),D(M),v(!0),w<k?setTimeout(()=>{u.current&&(S(t=>t+1),T())},1200):(p.playWin(),C(!0))},T=(t=!1)=>{H(!0);const s=$[Math.floor(Math.random()*$.length)];if(re(s),W&&W(s.solvedColors),!b||b.length===0)return;const l=we(30,b),n=[],i=new Set,o=[];for(const r of l){if(o.length>=q)break;const x=r.words.filter(d=>!i.has(d));x.length>=4&&([...x].sort(()=>.5-Math.random()).slice(0,4).forEach(d=>{i.add(d),n.push({id:Math.random().toString(36).substr(2,9),word:d,categoryId:r.id,categoryName:r.name.includes(":")?r.name.split(":")[1].trim():r.name,status:"neutral"})}),o.push(r))}h(n.sort(()=>.5-Math.random())),le(0),z([]),j([]),U([]),_([]),V(!1),v(!1),K(B),Z(!1),H(!1),D(0),t&&(S(1),F(0)),ie.current=Date.now()};a.useEffect(()=>{T(!0)},[b,A]);const xe=t=>{const s=new Set([...se,...N].map(o=>o.color)),l=ae.solvedColors,n=l.find(o=>!s.has(o))||l[Math.floor(Math.random()*l.length)],i={id:Math.random().toString(36),tileIds:t,color:n};h(o=>o.map(r=>t.includes(r.id)?{...r,status:"correct-preview",color:n}:r)),j(o=>{const r=[...o,i];return setTimeout(()=>{u.current&&pe(r)},500),r}),z([]),p.playSwap(),F(o=>o+1)},pe=t=>{v(!0);let s=!1,l=0;const n=[],i=[];let o=[...m];if(t.forEach(r=>{const x=m.filter(c=>r.tileIds.includes(c.id)),d=x[0].categoryId;x.every(c=>c.categoryId===d)?(l++,n.push(x[0].categoryName),i.push(d),U(c=>[...c,r]),o=o.map(c=>r.tileIds.includes(c.id)?{...c,status:"solved",color:r.color}:c)):(s=!0,o=o.map(c=>r.tileIds.includes(c.id)?{...c,status:"wrong"}:c))}),h(o),s){p.playError();const r=y+1;D(r),r>=M?w<k?setTimeout(()=>{u.current&&(S(x=>x+1),T())},1200):(p.playWin(),C(!0)):setTimeout(()=>{u.current&&(h(x=>x.map(d=>d.status==="wrong"?{...d,status:"neutral",color:void 0}:d)),j([]),v(!1))},1e3)}else p.playRowSolved(),j([]),v(!1),l>0&&Q({rowsSolved:l,solvedCategoryIds:i}),me(n),N.length+l===q&&(w<k?setTimeout(()=>{u.current&&(p.playWin(),S(r=>r+1),T())},1200):(p.playWin(),C(!0)))},me=t=>{t.forEach((s,l)=>{setTimeout(()=>{u.current&&(_([s]),setTimeout(()=>{u.current&&_(n=>n.filter(i=>i!==s))},2500))},l*1200)})},J=()=>{V(!0),ne(ve[0]),h(t=>t.map(s=>({...s,status:"exiting"}))),setTimeout(()=>{Y({mode:"MIND MATCH",mistakes:y})},500)},fe=a.useMemo(()=>{const t=new Map;return m.forEach(s=>t.set(s.categoryName,s.status==="solved")),Array.from(t.entries()).map(([s,l])=>({name:s,isSolved:l}))},[m]),he=a.useMemo(()=>N.map(t=>{const s=m.find(l=>t.tileIds.includes(l.id));return{name:(s==null?void 0:s.categoryName)||"???",color:t.color}}),[N,m]);return E?e.jsxs("div",{className:"text-white text-center mt-20 animate-pulse font-righteous text-xl uppercase",children:["LOADING ROUND ",w,"..."]}):e.jsxs("div",{className:"flex flex-col items-center w-full max-w-4xl mx-auto h-full px-4 relative select-none overflow-hidden pb-1",children:[e.jsx(be,{ref:de}),te&&e.jsx(je,{onMainMenu:ee,onSolveOne:()=>{},onSolvePuzzle:()=>{},onUndo:()=>{}}),g&&!L&&e.jsx("div",{className:"absolute inset-0 z-[200] flex items-center justify-center animate-fade-in bg-black/80",children:e.jsxs("div",{className:"relative z-10 flex flex-col items-center min-w-[300px] text-center animate-celebrate",children:[e.jsx(Ne,{onClick:J,levelIndex:A}),e.jsx("div",{onClick:()=>Z(!0),className:"mt-4 text-white font-oswald uppercase tracking-widest text-sm hover:text-cyan-400 cursor-pointer animate-pulse transition-colors uppercase",children:"TAP HERE TO REVIEW SOLVED PUZZLE"})]})}),e.jsxs("div",{className:"relative flex flex-col justify-center w-full items-end mb-1 py-1 shrink-0 z-[60] h-auto min-h-[50px] py-1 pr-4",children:[e.jsxs("div",{className:"flex items-center gap-3 relative",children:[e.jsx("h2",{className:"text-right pointer-events-none text-2xl md:text-4xl font-black tracking-widest text-deco-gold uppercase font-righteous drop-shadow-md leading-none",children:"MIND MATCH"}),L?e.jsx("button",{onClick:J,className:"px-3 py-1 bg-neon-green text-black font-bold font-oswald uppercase rounded shadow-lg animate-pulse hover:scale-105 transition-transform uppercase",children:"NEXT LEVEL >>"}):e.jsx("button",{onClick:()=>O==null?void 0:O(fe),className:"p-1 rounded-full bg-zinc-800 border border-zinc-600 hover:bg-zinc-700 active:animate-spin transition-all text-zinc-300 hover:text-white",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.592c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a7.75 7.75 0 0 1 0 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 0 1 0-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281Z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1 justify-end flex-wrap max-w-full",children:[e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-2 py-0.5 rounded-full flex items-center shadow-sm whitespace-nowrap",children:[e.jsx("span",{className:"text-zinc-500 font-oswald text-[9px] mr-1.5 tracking-wider uppercase",children:"TIMER"}),e.jsxs("span",{className:`font-bold font-oswald text-xs ${G<=15?"text-red-500 animate-pulse":"text-white"}`,children:["00:",G.toString().padStart(2,"0")]})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-2 py-0.5 rounded-full flex items-center shadow-sm whitespace-nowrap",children:[e.jsx("span",{className:"text-zinc-500 font-oswald text-[9px] mr-1.5 tracking-wider uppercase",children:"MISTAKES"}),e.jsxs("span",{className:`font-bold font-oswald text-xs ${y>=M-1?"text-red-500":"text-white"}`,children:[y,"/",M]})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 px-2 py-0.5 rounded-full flex items-center shadow-sm whitespace-nowrap",children:[e.jsx("span",{className:"text-zinc-500 font-oswald text-[9px] mr-1.5 tracking-wider uppercase",children:"ROUND"}),e.jsxs("span",{className:"text-white font-bold font-oswald text-xs",children:[w,"/",k]})]})]})]}),e.jsx("div",{className:"w-full flex-1 flex flex-col py-1 overflow-hidden min-h-0 relative z-10",children:e.jsx("div",{className:"w-full h-full grid grid-cols-4 grid-rows-5 gap-1.5",children:m.map(t=>e.jsx("div",{className:"relative w-full h-full",children:e.jsx(ge,{data:t,"data-tile-id":t.id,onClick:s=>{if(!L&&!R){const l=m.find(n=>n.id===s);l&&l.status!=="solved"&&(z(n=>n.includes(s)?n.filter(i=>i!==s):[...n,s].slice(0,4)),h(n=>n.map(i=>i.id===s?{...i,status:i.status==="selected"?"neutral":"selected"}:i)),I.length===3&&!I.includes(s)&&xe([...I,s]))}}})},t.id))},`grid-round-${w}`)}),e.jsxs("div",{className:"w-full flex-shrink-0 flex flex-wrap items-center justify-center z-[70] min-h-[60px] pointer-events-none py-2 gap-1.5",children:[he.map((t,s)=>e.jsx("div",{className:"animate-pop origin-bottom",children:e.jsx("div",{className:`px-3 py-1 rounded-t-lg text-[9px] md:text-xs font-bold uppercase tracking-widest border-x-2 border-t-2 border-b-0 border-white shadow-[0_-12px_24px_rgba(0,0,0,0.8)] font-oswald text-white drop-shadow-[0_2px_4px_rgba(0,0,0,1)] ${t.color.split(" ")[0]}`,children:t.name})},t.name+s)),e.jsx("div",{className:"absolute inset-x-0 bottom-full flex flex-col-reverse items-center gap-1",children:ce.map((t,s)=>e.jsx("div",{className:"animate-pop origin-center",children:e.jsx("span",{className:"text-deco-gold font-righteous text-2xl md:text-3xl uppercase tracking-wider drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]",children:t})},t+s))})]})]})};export{ze as default};
