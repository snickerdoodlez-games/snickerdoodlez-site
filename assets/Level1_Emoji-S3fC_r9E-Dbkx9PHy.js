import{l as r,G as H,o as Se,a as C,U as y,f as o,P as se,u as je}from"./index-DZYk55dN.js";import{f as ke,y as Ne,h as Ie}from"./DebugMenu-BlYmMh_k-BePBMNzk.js";const Te=({onComplete:le,onExit:ae,levelIndex:J,onThemeChange:T,hintsEnabled:B,debugMode:ne,onOpenAnimLab:Me,onOpenSettings:V})=>{const[c,p]=r.useState([]),[D,j]=r.useState(null),[k,oe]=r.useState(!0),[w,O]=r.useState(!1),[re,L]=r.useState(!1),[b,ie]=r.useState(H[0]),[R,Z]=r.useState(0),[$,S]=r.useState(!1),[N,Y]=r.useState(!1),[ce,de]=r.useState(""),[G,z]=r.useState(!1),[I,X]=r.useState(!1),[ue,F]=r.useState(0),[fe,A]=r.useState(0),[ze,K]=r.useState(120),Q=r.useRef(Date.now()),[P,_]=r.useState([]),M=r.useRef(Date.now()),E=r.useRef(new Map),xe=r.useRef(null),m=3,q=5,he=r.useMemo(()=>{if(c.length===0)return[];const l=new Map;return c.forEach(e=>{if(!l.has(e.categoryId)){const s=c.filter(u=>u.categoryId===e.categoryId).every(u=>u.status==="solved"||u.status==="exiting");l.set(e.categoryId,{name:e.categoryName,isSolved:s})}}),Array.from(l.values()).sort((e,s)=>e.name.localeCompare(s.name))},[c]);r.useEffect(()=>{const l=H[Math.floor(Math.random()*H.length)];ie(l),T&&T(l.solvedColors);const e=[...Se()].sort(()=>.5-Math.random()),s=[],u=new Set;let d=0;const n=7;for(const i of e){if(d>=n)break;const a=Array.from(new Set(i.words)).filter(t=>!u.has(t)),x=[...new Set(a)];x.length>=m&&([...x].sort(()=>.5-Math.random()).slice(0,m).forEach(t=>{u.add(t),s.push({id:Math.random().toString(36).substr(2,9),word:t,categoryId:i.id,categoryName:i.name,status:"neutral",isEmoji:!0})}),d++)}p(s.sort(()=>.5-Math.random())),_([]),O(!1),L(!1),Y(!1),oe(!1),Z(0),S(!1),z(!1),X(!1),F(0),A(0),K(120),M.current=Date.now(),Q.current=Date.now()},[J,T]),r.useEffect(()=>{if(w||N||k||I)return;const l=setInterval(()=>{K(e=>e<=1?(clearInterval(l),0):e-1)},1e3);return()=>clearInterval(l)},[w,N,k,I]),r.useEffect(()=>{if(!B||w||N||k||R>=1)return;const l=setInterval(()=>{Date.now()-M.current>9e4&&!$&&S(!0)},5e3);return()=>clearInterval(l)},[B,w,N,k,R,$]),r.useEffect(()=>{if(w){const l=Date.now()-Q.current;C({levelsCompleted:1,totalTimeMs:l,totalMoves:ue});const e=setTimeout(()=>{L(!0)},800);return()=>clearTimeout(e)}else L(!1)},[w]);const U=l=>{_(e=>[...e,JSON.parse(JSON.stringify(l))].slice(-10))},W=r.useCallback(l=>{var e,s,u;const d=Math.floor(l.length/m);let n=0;const i=[...l];let a=!1;for(let x=0;x<d;x++){const t=x*m,h=i.slice(t,t+m);if(!h[0]||((e=h[0])==null?void 0:e.status)==="solved"||((s=h[0])==null?void 0:s.status)==="exiting"){((u=h[0])==null?void 0:u.status)==="solved"&&n++;continue}const f=h[0].categoryId;if(h.every(v=>(v==null?void 0:v.categoryId)===f)){a=!0,n++,y.playRowSolved(),C({rowsSolved:1,solvedCategoryIds:[f]});const v=b.solvedColors[x%b.solvedColors.length];for(let g=t;g<t+m;g++)i[g]={...i[g],status:"solved",color:v}}}return a&&(p(i),M.current=Date.now(),S(!1)),n===d&&d>0&&(w||(y.playWin(),O(!0))),a},[w,b]),me=l=>{if(!(w||N||G||I||!c.find(e=>e.id===l)))if(M.current=Date.now(),S(!1),D===null)y.playSelect(),j(l),p(e=>e.map(s=>s.id===l?{...s,status:"selected"}:s));else if(D===l)y.playSelect(),j(null),p(e=>e.map(s=>s.id===l?{...s,status:"neutral"}:s));else{const e=c.findIndex(a=>a.id===D),s=c.findIndex(a=>a.id===l);if(e===-1||s===-1){j(null);return}U(c),F(a=>a+1);const u=c[e].id,d=c[s].id,n=E.current.get(u),i=E.current.get(d);if(z(!0),n&&i){y.playSwap();const a=n.getBoundingClientRect(),x=i.getBoundingClientRect(),t=x.left-a.left,h=x.top-a.top;n.style.transition="transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1), box-shadow 0.3s, z-index 0s",n.style.transform=`translate(${t}px, ${h}px) scale(1.15)`,n.style.zIndex="50",n.style.boxShadow="0 20px 25px -5px rgba(0, 0, 0, 0.5)",i.style.transition="transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1), box-shadow 0.3s, z-index 0s",i.style.transform=`translate(${-t}px, ${-h}px) scale(0.95)`,i.style.zIndex="40",setTimeout(()=>{n&&(n.style.transition="",n.style.transform="",n.style.zIndex="",n.style.boxShadow=""),i&&(i.style.transition="",i.style.transform="",i.style.zIndex="");const f=[...c];f[e]&&f[e].status!=="locked"&&(f[e]={...f[e],status:"neutral"}),f[s]&&f[s].status!=="locked"&&(f[s]={...f[s],status:"neutral"});const v=f[e];f[e]=f[s],f[s]=v,p(f),j(null),z(!1),W(f)||A(g=>Math.min(q,g+1))},300)}else{const a=[...c],x=a[e];a[e]=a[s],a[s]=x,p(a),j(null),z(!1),W(a)||A(t=>Math.min(q,t+1))}}},ee=(l=!1)=>{if(!l&&(R>=1||G))return;M.current=Date.now(),S(!1);const e=new Set;c.forEach(t=>{(t.status==="neutral"||t.status==="selected"||t.status==="locked")&&e.add(t.categoryId)});let s="";for(const t of Array.from(e))if(c.filter(h=>h.categoryId===t&&h.status!=="solved").length===m){s=t;break}if(!s)return;const u=Math.floor(c.length/m);let d=-1;for(let t=0;t<u;t++){const h=t*m;if(!c.slice(h,h+m).every(f=>f.status==="solved")){d=t;break}}if(d===-1)return;U(c);const n=[...c],i=[];for(let t=0;t<m;t++)i.push(d*m+t);const a=n.filter(t=>t.categoryId===s&&t.status!=="solved").map(t=>t.id);for(let t=0;t<m;t++){const h=i[t],f=n[h];if(a.includes(f.id))continue;const v=n.findIndex((g,ye)=>a.includes(g.id)&&!i.includes(ye));if(v!==-1){const g=n[h];n[h]=n[v],n[v]=g}}const x=b.solvedColors[d%b.solvedColors.length];i.forEach(t=>{n[t]={...n[t],status:"solved",color:x}}),p(n),y.playRowSolved(),l||(Z(t=>t+1),C({hintsUsed:1,rowsSolved:1,solvedCategoryIds:[s]})),setTimeout(()=>W(n),200)},pe=()=>{S(!1),C({hintsRefused:1})},te=()=>{Y(!0);let l=Math.floor(Math.random()*se.length);const e=se[l];de(e),p(s=>s.map(u=>({...u,status:"exiting"}))),setTimeout(()=>{le({mode:"EMOJI MATCH",mistakes:fe})},500)},ve=()=>ee(!0),ge=()=>{U(c);const l=c.map((e,s)=>{const u=Math.floor(s/m),d=b.solvedColors[u%b.solvedColors.length];return{...e,status:"solved",color:d}});p(l),y.playWin(),O(!0)},we=()=>{if(P.length>0){const l=P[P.length-1];p(l),_(e=>e.slice(0,e.length-1)),y.playSelect()}};if(k)return o.jsx("div",{className:"text-white text-center mt-20 animate-pulse font-oswald uppercase",children:"LOADING EMOJIS..."});const be=()=>{const l=[],e=Math.floor(c.length/m);for(let s=0;s<e;s++){const u=s*m,d=c.slice(u,u+m);if(!d[0])continue;const n=d.every(a=>(a==null?void 0:a.status)==="solved"||(a==null?void 0:a.status)==="exiting"),i=n&&d[0].color?d[0].color.split(" ")[0]:"bg-zinc-800";l.push(o.jsx("div",{className:"w-full relative z-10 flex-1 flex flex-col justify-center transition-opacity duration-500 min-h-0",style:{zIndex:10+s},children:o.jsxs("div",{className:"relative w-full h-full p-1",children:[n&&o.jsx("div",{className:"absolute inset-0 z-0 animate-fade-in bg-black border-4 border-white rounded-xl"}),n&&o.jsx("div",{className:"absolute top-0 left-8 z-[100] transform",style:{transform:"translateY(calc(-100% + 4px))"},children:o.jsx("div",{className:`animate-pop px-3 py-1 rounded-t-lg text-[10px] md:text-xs font-bold uppercase tracking-widest leading-tight border-x-4 border-t-4 border-b-0 border-white shadow-[0_-12px_24px_rgba(0,0,0,0.8)] font-oswald text-white drop-shadow-md ${i}`,children:d[0].categoryName})}),o.jsx("div",{className:`grid grid-cols-3 gap-2 w-full h-full relative z-10 p-1 ${n?"drop-shadow-xl p-2":""}`,children:d.map(a=>a?o.jsx("div",{className:"relative w-full h-full",children:o.jsx(je,{data:a,"data-tile-id":a.id,onClick:x=>me(x),gradientClass:b.gradient,exitAnimation:ce,ref:x=>{x?E.current.set(a.id,x):E.current.delete(a.id)}})},a.id):null)})]})},s))}return l};return o.jsxs("div",{className:"flex flex-col items-center w-full max-w-4xl mx-auto h-full px-2 relative select-none overflow-hidden pb-1",children:[o.jsx(ke,{ref:xe}),ne&&o.jsx(Ne,{onMainMenu:ae,onSolveOne:ve,onSolvePuzzle:ge,onUndo:we}),$&&o.jsx("div",{className:"absolute inset-0 z-[90] flex items-center justify-center animate-fade-in bg-black/60",children:o.jsxs("div",{className:"bg-zinc-900 border-4 border-neon-blue rounded-2xl p-6 flex flex-col items-center gap-6 shadow-[0_0_40px_rgba(0,229,255,0.3)] animate-pop w-[90%] max-sm",children:[o.jsx("span",{className:"text-white font-black font-oswald text-2xl uppercase tracking-widest text-center drop-shadow-md",children:"NEED SOME HELP?"}),o.jsxs("div",{className:"flex gap-4 w-full",children:[o.jsx("button",{onClick:()=>ee(!1),className:"flex-1 bg-neon-blue text-black hover:bg-white hover:scale-105 active:scale-95 transition-all py-3 rounded-xl font-black uppercase font-oswald text-xl shadow-lg",children:"YES"}),o.jsx("button",{onClick:pe,className:"flex-1 bg-zinc-800 border-2 border-zinc-600 text-zinc-400 hover:text-white hover:border-white hover:bg-zinc-700 hover:scale-105 active:scale-95 transition-all py-3 rounded-xl font-bold uppercase font-oswald text-xl",children:"NO"})]})]})}),re&&!I&&o.jsx("div",{className:"absolute inset-0 z-[200] flex items-center justify-center animate-fade-in bg-black/80",children:o.jsxs("div",{className:"relative z-20 flex flex-col items-center min-w-[300px] text-center animate-celebrate",children:[o.jsx(Ie,{onClick:te,levelIndex:J}),o.jsx("div",{onClick:()=>X(!0),className:"mt-4 text-white font-oswald uppercase tracking-widest text-sm hover:text-cyan-400 cursor-pointer animate-pulse transition-colors uppercase",children:"TAP HERE TO REVIEW SOLVED PUZZLE"})]})}),o.jsx("div",{className:"relative flex flex-col justify-center w-full items-end mb-1 shrink-0 z-[60] h-auto min-h-[50px] py-1 pr-4",children:o.jsxs("div",{className:"flex items-center gap-3 relative",children:[o.jsx("h2",{className:"text-right pointer-events-none text-2xl md:text-4xl font-black tracking-widest text-deco-gold uppercase font-righteous drop-shadow-md leading-none",children:"EMOJI MATCH"}),I?o.jsx("button",{onClick:te,className:"px-3 py-1 bg-neon-green text-black font-bold font-oswald uppercase rounded shadow-lg animate-pulse hover:scale-105 transition-transform uppercase",children:"NEXT LEVEL >>"}):o.jsx("button",{onClick:()=>V==null?void 0:V(he),className:"p-1 rounded-full bg-zinc-800 border border-zinc-600 hover:bg-zinc-700 active:animate-spin transition-all text-zinc-300 hover:text-white",children:o.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.592c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a7.75 7.75 0 0 1 0 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 0 1 0-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281Z"}),o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})}),o.jsx("div",{className:"w-full flex-1 flex flex-col animate-fade-in gap-1 min-h-0",style:{animationDelay:"0.1s"},children:be()})]})};export{Te as default};
